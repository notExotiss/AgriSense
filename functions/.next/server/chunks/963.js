exports.id=963,exports.ids=[963],exports.modules={6897:(e,t,r)=>{"use strict";r.a(e,async(e,n)=>{try{r.d(t,{Z:()=>s});var l=r(997);r(6689);var i=r(4045),a=e([i]);function o(e){let t=3*e.row+e.col+1;return`P${t}`}function s({bbox:e,cells:t,cellFootprints:r,selectedCell:n,onSelectCell:a,visible:s=!0}){if(!s||!e)return null;let u=function(e){if(Array.isArray(e)&&e.length)return e;let t=[];for(let e=0;e<3;e++)for(let r=0;r<3;r++)t.push({cellId:`${e}-${r}`,row:e,col:r,mean:0,min:0,max:0,validPixelRatio:0,stressLevel:"unknown"});return t}(t);return l.jsx(l.Fragment,{children:u.map(t=>{var s;let u=n===t.cellId,c=Array.isArray(r)?r.find(e=>e.cellId===t.cellId):null,d=function(e){let t=e?.polygon?.coordinates?.[0];if(!Array.isArray(t)||t.length<4)return null;let r=t.map(e=>{let t=Number(e?.[0]),r=Number(e?.[1]);return Number.isFinite(t)&&Number.isFinite(r)?[r,t]:null}).filter(e=>Array.isArray(e)&&2===e.length);return r.length>=4?r:null}(c),p={color:(s=t.stressLevel,u?"#22d3ee":"high"===s?"#dc2626":"moderate"===s?"#d97706":"low"===s?"#15803d":"#64748b"),weight:u?3.2:1.7,opacity:u?.95:.75,fill:!1,fillOpacity:0};return d?l.jsx(i.Polygon,{positions:d,pathOptions:p,eventHandlers:{click:()=>a?.(t.cellId)},children:(0,l.jsxs)(i.Tooltip,{children:["Plot Point ",o(t)," | mean ",t.mean.toFixed(3)," | ",t.stressLevel,"number"==typeof c?.coverage?` | coverage ${(100*c.coverage).toFixed(1)}%`:""]})},`grid-map-poly-${t.cellId}`):l.jsx(i.Rectangle,{bounds:function(e,t,r){let n=e[0],l=e[1],i=e[2],a=e[3],o=(i-n)/3,s=(a-l)/3;return[[a-s*(t+1),n+o*r],[a-s*t,n+o*(r+1)]]}(e,t.row,t.col),pathOptions:p,eventHandlers:{click:()=>a?.(t.cellId)},children:(0,l.jsxs)(i.Tooltip,{children:["Plot Point ",o(t)," | mean ",t.mean.toFixed(3)," | ",t.stressLevel]})},`grid-map-${t.cellId}`)})})}i=(a.then?(await a)():a)[0],n()}catch(e){n(e)}})},9963:(e,t,r)=>{"use strict";r.a(e,async(e,n)=>{try{r.r(t),r.d(t,{default:()=>g});var l=r(997),i=r(4045);r(9637),r(3601),r(2136);var a=r(5194),o=r.n(a),s=r(6689),u=r(6897),c=e([i,u]);function d(e,t,r){return Math.max(t,Math.min(r,e))}function p({enabled:e,metricGrid:t,alignmentBbox:r,onHover:n}){return(0,i.useMapEvents)({mousemove(l){if(!e)return;let i=Number(l.latlng?.lat),a=Number(l.latlng?.lng);if(!Number.isFinite(i)||!Number.isFinite(a)){n(null);return}let o=function(e,t,r,n){if(!e||!t||!e.width||!e.height||!Array.isArray(e.values))return{pixelX:-1,pixelY:-1,value:null};let[l,i,a,o]=t,s=d((n-l)/Math.max(1e-9,a-l),0,1),u=d((o-r)/Math.max(1e-9,o-i),0,1),c=d(Math.round(s*(e.width-1)),0,e.width-1),p=d(Math.round(u*(e.height-1)),0,e.height-1),m=p*e.width+c,g=Number(e.values[m]);return{pixelX:c,pixelY:p,value:Number.isFinite(g)?g:null}}(t,r,i,a);n({lat:i,lon:a,pixelX:o.pixelX,pixelY:o.pixelY,value:o.value})},mouseout(){n(null)}}),null}function m({onReady:e}){let t=(0,i.useMap)();return(0,s.useEffect)(()=>{e(t)},[t,e]),null}function g({bbox:e,onBboxChange:t,polygon:r,onPolygonChange:n,ndviPng:a,ndviBounds:c,hotspots:d,processedOverlayUrl:g,smoothOverlay:f=!0,overlayOpacity:h=.85,grid3x3:x,cellFootprints:y,selectedCell:b,onSelectCell:v,showGrid:w=!0,debugMode:j=!1,debugMetricGrid:F,debugAlignmentBbox:N,debugResolutionMeters:A,debugCoverage:E,clearAoiSignal:L=0}){let O=(0,s.useRef)(null),I=(0,s.useRef)(null),M=(0,s.useRef)(null),R=(0,s.useRef)(t),k=(0,s.useRef)(n),[C,B]=(0,s.useState)(!1),[S,P]=(0,s.useState)(null);(0,s.useEffect)(()=>{R.current=t},[t]),(0,s.useEffect)(()=>{k.current=n},[n]),(0,s.useEffect)(()=>{let e=O.current;if(!e||!C||I.current||M.current)return;let t=new(o()).FeatureGroup;I.current=t,e.addLayer(t);let r=new(o()).Control.Draw({draw:{polygon:{shapeOptions:{color:"#16a34a",weight:2,opacity:.95,fill:!1,fillOpacity:0}},rectangle:{shapeOptions:{color:"#16a34a",weight:2,opacity:.95,fill:!1,fillOpacity:0}},polyline:!1,circle:!1,marker:!1,circlemarker:!1},edit:{featureGroup:t}});M.current=r,e.addControl(M.current);let n=e=>{let r=e.layer;if(t.clearLayers(),"function"==typeof r?.setStyle&&r.setStyle({color:"#16a34a",weight:2,opacity:.95,fill:!1,fillOpacity:0}),t.addLayer(r),r.getBounds){let e=r.getBounds(),t=e.getWest(),n=e.getSouth(),l=e.getEast(),i=e.getNorth();R.current&&R.current([t,n,l,i])}if(r.getLatLngs){let e=r.getLatLngs()[0]||[];k.current&&k.current(e)}};return e.on(o().Draw.Event.CREATED,n),()=>{e.off(o().Draw.Event.CREATED,n),M.current&&e.removeControl(M.current),I.current&&e.removeLayer(I.current),M.current=null,I.current=null}},[C]),(0,s.useEffect)(()=>{C&&I.current&&(I.current.clearLayers(),k.current&&k.current([]),P(null))},[L,C]),(0,s.useEffect)(()=>{let t=O.current;if(t)try{if(c&&Array.isArray(c)&&4===c.length){let e=o().latLngBounds([c[1],c[0]],[c[3],c[2]]);t.fitBounds(e,{padding:[20,20]});return}if(e&&Array.isArray(e)&&4===e.length){let r=o().latLngBounds([e[1],e[0]],[e[3],e[2]]);t.fitBounds(r,{padding:[20,20]});return}if(r&&r.length){let e=o().latLngBounds(r);t.fitBounds(e,{padding:[20,20]})}}catch{}},[JSON.stringify(c),JSON.stringify(e),JSON.stringify(r)]);let z=i.MapContainer,D=i.ImageOverlay,$=i.TileLayer,T=(0,s.useMemo)(()=>g&&g.length?g:a&&a.length?`data:image/png;base64,${a}`:null,[g,a]);(0,s.useEffect)(()=>{let e="leaflet-image-overlay-css";if(document.getElementById(e))return;let t=document.createElement("style");return t.id=e,t.textContent=`
      .leaflet-image-smooth {
        image-rendering: auto !important;
        -ms-interpolation-mode: bicubic !important;
        image-rendering: -webkit-optimize-contrast !important;
        will-change: transform;
      }
      .leaflet-image-precision {
        image-rendering: pixelated !important;
        image-rendering: crisp-edges !important;
        -ms-interpolation-mode: nearest-neighbor !important;
        will-change: transform;
      }
    `,document.head.appendChild(t),()=>{}},[]);let U=c&&4===c.length?[[c[1],c[0]],[c[3],c[2]]]:null,X=T&&U?l.jsx(D,{url:T,bounds:U,opacity:h,crossOrigin:"anonymous",className:f?"leaflet-image-smooth":"leaflet-image-precision",style:{imageRendering:f?"auto":"pixelated",transform:"translateZ(0)"}}):null,Y=(0,s.useCallback)(e=>{O.current=e,B(!0)},[]);return(0,l.jsxs)("div",{className:"relative h-full w-full",children:[(0,l.jsxs)(z,{ref:O,center:[40,-95],zoom:5,style:{height:"100%",width:"100%",borderRadius:12,overflow:"hidden",zIndex:0},children:[l.jsx(m,{onReady:Y}),l.jsx($,{attribution:"\xa9 OpenStreetMap contributors",url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),l.jsx(p,{enabled:!!j,metricGrid:F,alignmentBbox:N||c||e||null,onHover:P}),X,l.jsx(u.Z,{bbox:c||e,cells:x,cellFootprints:y,selectedCell:b,onSelectCell:v,visible:!!(w&&(c||e))}),r&&r.length>0&&l.jsx(i.Polygon,{positions:r,pathOptions:{color:"#16a34a",weight:2}}),(d||[]).map((e,t)=>l.jsx(i.Marker,{position:e.position,children:l.jsx(i.Popup,{children:e.label})},t))]}),j&&l.jsx("div",{className:"pointer-events-none absolute left-3 top-3 z-[500] rounded-lg border border-zinc-300/80 bg-white/90 px-2 py-1 text-[11px] font-medium text-zinc-800 shadow-sm backdrop-blur-sm",children:S?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("p",{children:["lat/lon: ",S.lat.toFixed(6),", ",S.lon.toFixed(6)]}),(0,l.jsxs)("p",{children:["px: ",S.pixelX,", ",S.pixelY]}),(0,l.jsxs)("p",{children:["value:"," ","number"==typeof S.value&&Number.isFinite(S.value)?S.value.toFixed(4):"n/a"]}),"number"==typeof A&&Number.isFinite(A)&&(0,l.jsxs)("p",{children:["resolution: ~",A.toFixed(2),"m/pixel"]}),"number"==typeof E&&Number.isFinite(E)&&(0,l.jsxs)("p",{children:["AOI coverage: ",(100*E).toFixed(1),"%"]})]}):l.jsx("p",{children:"Move cursor to inspect raster sample"})})]})}[i,u]=c.then?(await c)():c,delete o().Icon.Default.prototype._getIconUrl,o().Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png"}),n()}catch(e){n(e)}})},3601:()=>{},9637:()=>{}};