"use strict";(()=>{var e={};e.id=511,e.ids=[511],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},9047:(e,t,r)=>{r.r(t),r.d(t,{config:()=>u,default:()=>c,routeModule:()=>d});var n={};r.r(n),r.d(n,{default:()=>l});var o=r(1802),i=r(7153),s=r(6249);async function a(e){try{let t=await fetch(`https://planetarycomputer.microsoft.com/api/sas/v1/sign?href=${encodeURIComponent(e)}`);if(!t.ok)return e;let r=await t.json();return r?.href||r?.signedHref||e}catch(t){return console.warn("signIfPlanetary failed, using original url",t),e}}async function l(e,t){if("POST"!==e.method)return t.status(405).end();try{let{bbox:r,date:n}=e.body||{};if(!r||!Array.isArray(r)||4!==r.length)return t.status(400).json({error:"bbox_required",message:"Bounding box [minx,miny,maxx,maxy] is required"});console.log("Processing lightweight ingest for bbox:",r),console.log("Performing STAC search for bbox:",r);let o=await fetch("https://planetarycomputer.microsoft.com/api/stac/v1/search",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({bbox:r,datetime:n,collections:["sentinel-2-l2a"],limit:1,sortby:[{field:"eo:cloud_cover",direction:"asc"}]})});if(!o.ok)throw console.error("STAC search failed:",o.status,o.statusText),Error("STAC search failed");let i=await o.json(),s=i.features?.[0];if(!s)throw Error("No imagery found in STAC search");console.log("Found imagery:",s.id);let l=await a(s.assets.B04.href),c=await a(s.assets.B08.href),u={ndviStats:null,width:null,height:null,pixels:null,ndviPng:null,bbox:r,imagery:{id:s.id,date:s.properties?.datetime,cloudCover:s.properties?.["eo:cloud_cover"],platform:s.properties?.platform},assets:{b04:l,b08:c},message:"Imagery URLs provided for client-side processing"};return console.log("Returning imagery URLs for client-side processing"),t.status(200).json(u)}catch(e){return console.error("ingest/fetch error",e?.message||e,{stack:e?.stack}),t.status(500).json({error:"ingest_failed",message:String(e?.message||e)})}}let c=(0,s.l)(n,"default"),u=(0,s.l)(n,"config"),d=new o.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/ingest/fetch",pathname:"/api/ingest/fetch",bundlePath:"",filename:""},userland:n})},7153:(e,t)=>{var r;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},1802:(e,t,r)=>{e.exports=r(145)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var r=t(t.s=9047);module.exports=r})();