"use strict";(()=>{var e={};e.id=607,e.ids=[607],e.modules={2509:e=>{e.exports=require("firebase-admin")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,r)=>{Object.defineProperty(r,"l",{enumerable:!0,get:function(){return function e(r,t){return t in r?r[t]:"then"in r&&"function"==typeof r.then?r.then(r=>e(r,t)):"function"==typeof r&&"default"===t?r:void 0}}})},8623:(e,r,t)=>{t.r(r),t.d(r,{config:()=>l,default:()=>c,routeModule:()=>f});var n={};t.r(n),t.d(n,{default:()=>d});var i=t(1802),a=t(7153),s=t(6249),o=t(535);function u(e){return String(e||"")}async function d(e,r){if("DELETE"!==e.method)return r.status(405).end();try{let t=(0,o._)(),n=(0,o.D)(),{id:i}=e.query;if(!i||"string"!=typeof i)return r.status(400).json({error:"id required"});let a=(e.headers.authorization||"").replace("Bearer ","");if(!a)return r.status(401).json({error:"auth_required"});let s=(await n.verifyIdToken(a)).uid,u=t.collection("plots").doc(i),d=await u.get();if(!d.exists)return r.status(404).json({error:"not_found"});if(d.data()?.ownerUid!==s)return r.status(403).json({error:"forbidden"});return await u.delete(),r.status(204).end()}catch(e){if(console.error("plot delete",e?.message||e),"firebase_admin_misconfigured"===u(e?.code)||"FirebaseAdminConfigError"===u(e?.name))return r.status(503).json({error:"firebase_admin_misconfigured",message:"Server Firebase Admin credentials are not configured correctly.",hint:e?.hint||"Set FIREBASE_SERVICE_ACCOUNT_JSON with a valid private key and escaped newlines."});if(u(e?.message).toLowerCase().includes("token")||u(e?.code).includes("auth"))return r.status(401).json({error:"invalid_auth"});return r.status(500).json({error:"internal"})}}let c=(0,s.l)(n,"default"),l=(0,s.l)(n,"config"),f=new i.PagesAPIRouteModule({definition:{kind:a.x.PAGES_API,page:"/api/plots/[id]",pathname:"/api/plots/[id]",bundlePath:"",filename:""},userland:n})},535:(e,r,t)=>{t.d(r,{D:()=>c,_:()=>d});var n=t(2509),i=t.n(n);class a extends Error{constructor(e,r){super(e),this.name="FirebaseAdminConfigError",this.code="firebase_admin_misconfigured",this.hint=r}}let s="idle",o=null;function u(){if("ready"!==s){if("failed"===s&&o)throw o;try{if(!i().apps.length){let e=process.env.FIREBASE_SERVICE_ACCOUNT_JSON;if(e){let r=function(e){let r;try{r=JSON.parse(e)}catch{throw new a("FIREBASE_SERVICE_ACCOUNT_JSON is not valid JSON.","Use a single-line JSON string from your Firebase service account key.")}if(!r||"object"!=typeof r)throw new a("FIREBASE_SERVICE_ACCOUNT_JSON is missing or invalid.","Set FIREBASE_SERVICE_ACCOUNT_JSON to the full service account JSON.");let t=String(r.private_key||"").replace(/\\n/g,"\n").trim();if(!(t.startsWith("-----BEGIN PRIVATE KEY-----")&&t.endsWith("-----END PRIVATE KEY-----")))throw new a("Firebase private key is not in valid PEM format.","Ensure private_key contains BEGIN/END markers and escaped newlines (\\\\n) in .env.");return{...r,private_key:t}}(e);i().initializeApp({credential:i().credential.cert(r),projectId:r.project_id||"brightbite-81e92"})}else i().initializeApp()}s="ready",o=null}catch(e){throw s="failed",o=function(e){if(e instanceof a)return e;let r=String(e?.message||e||"Unknown Firebase Admin error"),t=r.toLowerCase();return t.includes("pem")||t.includes("private key")||t.includes("credential")?new a(r,"Rotate and re-add FIREBASE_SERVICE_ACCOUNT_JSON. Ensure private_key newline escaping is correct."):e instanceof Error?e:Error(r)}(e)}}}function d(){return u(),i().firestore()}function c(){return u(),i().auth()}},7153:(e,r)=>{var t;Object.defineProperty(r,"x",{enumerable:!0,get:function(){return t}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(t||(t={}))},1802:(e,r,t)=>{e.exports=t(145)}};var r=require("../../../webpack-api-runtime.js");r.C(e);var t=r(r.s=8623);module.exports=t})();