"use strict";(()=>{var e={};e.id=735,e.ids=[735],e.modules={2509:e=>{e.exports=require("firebase-admin")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},1253:e=>{e.exports=require("pngjs")},6113:e=>{e.exports=require("crypto")},7851:(e,t,a)=>{a.r(t),a.d(t,{config:()=>u,default:()=>l,routeModule:()=>m});var i={};a.r(i),a.d(i,{config:()=>d,default:()=>c});var r=a(1802),n=a(7153),s=a(6249),o=a(9685);let d={api:{bodyParser:{sizeLimit:"2mb"}}};async function c(e,t){if("POST"!==e.method)return t.status(405).end();try{let a=e.body||{},i={irrigationDelta:Number(a?.scenario?.irrigationDelta??0),waterBudget:Number(a?.scenario?.waterBudget??.5),targetRisk:Number(a?.scenario?.targetRisk??.35),fertilizerDelta:Number(a?.scenario?.fertilizerDelta??0)},r=await (0,o.Cb)({prompt:"simulate scenario",objective:a?.objective||"balanced",ndviData:a?.ndviData,weatherData:a?.weatherData,soilData:a?.soilData,etData:a?.etData,timeSeriesData:a?.timeSeriesData,context:a?.context,providersTried:a?.providersTried,selectedCell:a?.selectedCell||a?.context?.selectedCell||null}),n=(0,o.ge)(r.featureVector,i);return t.status(200).json({success:!0,scenario:n,baseline:{confidence:r.confidence,objective:r.objective,recommendations:r.recommendations.map(e=>e.title)}})}catch(r){let a=e.body||{},i=Number(a?.ndviData?.stats?.mean||a?.context?.ndviStats?.mean||.4);return t.status(200).json({success:!0,scenario:function(e=.4,t){let a=Number(t?.irrigationDelta||0),i=Math.max(.08,Math.min(.92,(.45-e)*.9+.3)),r=Math.max(-.2,Math.min(.95,e)),n=Math.max(-.2,Math.min(.95,e+.08*a));return{baselineRisk7d:Number(i.toFixed(4)),scenarioRisk7d:Number(Math.max(.06,Math.min(.95,i-.22*a)).toFixed(4)),baselineNdvi30d:Number(r.toFixed(4)),scenarioNdvi30d:Number(n.toFixed(4)),waterUseDeltaPct:Number((100*a).toFixed(1)),yieldProxyDeltaPct:Number(((n-r)*70).toFixed(1)),recommendation:"Use this scenario as a conservative baseline; rerun after fresh ingest.",confidence:.42}}(i,a?.scenario),baseline:{confidence:.42,objective:String(a?.objective||"balanced"),recommendations:["Refresh analysis inputs and rerun what-if simulation."]},warnings:[String(r?.message||"Scenario simulation degraded mode active.")]})}}let l=(0,s.l)(i,"default"),u=(0,s.l)(i,"config"),m=new r.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/ai/simulate",pathname:"/api/ai/simulate",bundlePath:"",filename:""},userland:i})}};var t=require("../../../webpack-api-runtime.js");t.C(e);var a=e=>t(t.s=e),i=t.X(0,[490],()=>a(7851));module.exports=i})();