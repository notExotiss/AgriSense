"use strict";(()=>{var e={};e.id=41,e.ids=[41],e.modules={2509:e=>{e.exports=require("firebase-admin")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},1253:e=>{e.exports=require("pngjs")},6113:e=>{e.exports=require("crypto")},1091:(e,t,a)=>{a.r(t),a.d(t,{config:()=>l,default:()=>o,routeModule:()=>u});var i={};a.r(i),a.d(i,{default:()=>c});var r=a(1802),n=a(7153),s=a(6249),d=a(4917);async function c(e,t){if("POST"!==e.method)return t.status(405).end();try{let a=e.body||{},i=String(a?.prompt||"").trim(),r=await (0,d.d7)({prompt:i||"Provide a farm health summary.",ndviData:a?.ndviData,weatherData:a?.weatherData,soilData:a?.soilData,etData:a?.etData,timeSeriesData:a?.timeSeriesData,context:a?.context,objective:a?.objective||"balanced",mode:a?.mode,selectedCell:a?.selectedCell||a?.context?.selectedCell||null,providersTried:a?.providersTried,history:Array.isArray(a?.history)?a.history.slice(-8).map(e=>({role:e?.role==="assistant"?"assistant":"user",text:String(e?.text||"").slice(0,400)})):[]});return t.status(200).json({answer:r.chat.answer,sections:r.chat.sections,output:r.chat.text,assistantBackend:r.chat.backend||"deterministic",engine:r.inference.engine,confidence:r.inference.confidence,dataQuality:r.inference.dataQuality,inference:r.inference,mode:r.chat.mode,evidence:r.chat.evidence,tasks:r.chat.tasks,selectedCell:a?.selectedCell||a?.context?.selectedCell||null,scenarioUsed:!1,confidenceBreakdown:{model:r.inference.confidence,dataQuality:r.inference.dataQuality?.score}})}catch(a){let e=String(a?.message||"Unexpected inference error");return t.status(200).json({output:"AI Assistant fallback mode is active. Use current NDVI trend, anomaly score, and selected-cell stress to prioritize irrigation and scouting. Re-run analysis after refreshing data providers.",engine:"agrisense-ml-fallback",confidence:.42,dataQuality:{completeness:.5,providerQuality:.5,score:.42,isSimulatedInputs:!0,warnings:[e]},degraded:!0,warnings:[e]})}}let o=(0,s.l)(i,"default"),l=(0,s.l)(i,"config"),u=new r.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/ai",pathname:"/api/ai",bundlePath:"",filename:""},userland:i})}};var t=require("../../webpack-api-runtime.js");t.C(e);var a=e=>t(t.s=e),i=t.X(0,[281],()=>a(1091));module.exports=i})();