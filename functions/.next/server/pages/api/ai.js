"use strict";(()=>{var e={};e.id=41,e.ids=[41],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},3023:e=>{e.exports=import("@google/generative-ai")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},7121:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.r(t),r.d(t,{config:()=>c,default:()=>d,routeModule:()=>l});var a=r(1802),i=r(7153),o=r(6249),s=r(1108),u=e([s]);s=(u.then?(await u)():u)[0];let d=(0,o.l)(s,"default"),c=(0,o.l)(s,"config"),l=new a.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/ai",pathname:"/api/ai",bundlePath:"",filename:""},userland:s});n()}catch(e){n(e)}})},7719:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.d(t,{e:()=>u});var a=r(3023),i=e([a]);a=(i.then?(await i)():i)[0];let d=process.env.GEMINI_API_KEY||"",c=d?new a.GoogleGenerativeAI(d):null;function o(e){if(!e)return!1;if(429===e.status||429===e.statusCode)return!0;let t=String(e.message||e).toLowerCase();return!!(t.includes("429")||t.includes("rate limit")||t.includes("quota exceeded")||t.includes("resource exhausted"))}async function s(e,t=3,r=1e3){let n;for(let a=0;a<=t;a++)try{return await e()}catch(e){if(n=e,o(e)&&a<t){let e=r*Math.pow(2,a);console.warn(`Rate limit hit (429). Retrying in ${e}ms... (attempt ${a+1}/${t})`),await function(e){return new Promise(t=>setTimeout(t,e))}(e);continue}throw e}throw n}async function u(e){if(!c){let t=e.match(/min=([-.\d]+).*max=([-.\d]+).*mean=([-.\d]+)/i);if(!t)return"No NDVI provided.";let r=parseFloat(t[3]);return r>.4?"Mostly healthy vegetation.\n- Continue routine monitoring.\n- Scout minor dips.\n- Ground-truth sample.":r>.2?"Moderate vegetation.\n- Check irrigation.\n- Scout low-NDVI edges.\n- Consider soil test.":"Stressed or sparse vegetation.\n- Inspect low-NDVI zones in-field.\n- Verify water delivery.\n- Check for pests/disease."}let t=c.getGenerativeModel({model:"gemini-1.5-flash"});try{let r=await s(async()=>await t.generateContent(e),3,1e3);return r?.response?.text?r.response.text():r?.candidates?.[0]?.content?.[0]?.text||""}catch(e){if(o(e))throw console.error("Rate limit exceeded after retries:",e),Error("API rate limit exceeded. Please wait a moment and try again.");throw e}}n()}catch(e){n(e)}})},1108:(e,t,r)=>{r.a(e,async(e,n)=>{try{r.r(t),r.d(t,{default:()=>o});var a=r(7719),i=e([a]);async function o(e,t){if("POST"!==e.method)return t.status(405).end();try{let{prompt:r}=e.body||{},n=await (0,a.e)(String(r||""));t.status(200).json({output:n})}catch(r){console.error("AI API error:",r);let e=String(r?.message||r).toLowerCase();if(e.includes("rate limit")||e.includes("429"))return t.status(429).json({error:"rate_limit_exceeded",message:"API rate limit exceeded. Please wait a moment and try again.",retryAfter:60});t.status(500).json({error:"AI request failed",message:r?.message||"An unexpected error occurred"})}}a=(i.then?(await i)():i)[0],n()}catch(e){n(e)}})},7153:(e,t)=>{var r;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},1802:(e,t,r)=>{e.exports=r(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var r=t(t.s=7121);module.exports=r})();