"use strict";(()=>{var e={};e.id=230,e.ids=[230],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,a){return a in t?t[a]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,a)):"function"==typeof t&&"default"===a?t:void 0}}})},8689:(e,t,a)=>{a.r(t),a.d(t,{config:()=>c,default:()=>l,routeModule:()=>p});var r={};a.r(r),a.d(r,{default:()=>m});var i=a(1802),n=a(7153),s=a(6249);async function o(e,t=15e3){let a=new AbortController,r=setTimeout(()=>a.abort(),t);try{let t=await fetch(e,{signal:a.signal});if(!t.ok)throw Error(`http_${t.status}`);return await t.json()}finally{clearTimeout(r)}}function u(e,t,a){let r;let i=(r=Math.abs(Math.round((17*t[0]+31*t[1]+13*t[2]+29*t[3])*1e5)||9001),()=>(r=(1103515245*r+12345)%2147483648)/2147483648),n=Array(65536),s=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY,u=0;for(let t=0;t<256;t++)for(let r=0;r<256;r++){let d=256*t+r,m=Math.max(.2,Math.min(12,e+(.18*Math.sin(r/256*Math.PI*2)+.12*Math.cos(t/256*Math.PI*2))+(i()-.5)*("et"===a?.7:1.2)));n[d]=Number(m.toFixed(4)),s=Math.min(s,m),o=Math.max(o,m),u+=m}let d={type:"evapotranspiration",width:256,height:256,data:n,stats:{min:Number(s.toFixed(4)),max:Number(o.toFixed(4)),mean:Number((u/n.length).toFixed(4))}};return{encoded:Buffer.from(JSON.stringify(d)).toString("base64"),stats:d.stats}}async function d(e,t){let a=new URL("https://api.open-meteo.com/v1/forecast");a.searchParams.set("latitude",String(e)),a.searchParams.set("longitude",String(t)),a.searchParams.set("timezone","auto"),a.searchParams.set("past_days","7"),a.searchParams.set("forecast_days","1"),a.searchParams.set("daily","et0_fao_evapotranspiration");let r=await o(a.toString()),i=r?.daily||{},n=Array.isArray(i.et0_fao_evapotranspiration)?i.et0_fao_evapotranspiration.filter(e=>"number"==typeof e&&Number.isFinite(e)):[];if(!n.length)throw Error("no_et_values");return Math.max(.2,Math.min(12,Number(n[n.length-1])))}async function m(e,t){if("POST"!==e.method)return t.status(405).end();try{let{bbox:a}=e.body||{};if(!Array.isArray(a)||4!==a.length)return t.status(400).json({error:"bbox_required",message:"Bounding box [minx,miny,maxx,maxy] is required"});let r=a.map(Number),i=(r[1]+r[3])/2,n=(r[0]+r[2])/2;try{let e=await d(i,n),a=u(e,r,"et");return t.status(200).json({success:!0,source:"Open-Meteo",isSimulated:!1,cacheHit:!1,warnings:[],providersTried:[{provider:"open-meteo-et",ok:!0}],data:{evapotranspiration:a.encoded,stats:a.stats,bbox:r,source:"Open-Meteo ET0 (AOI-derived grid)",isSimulated:!1,units:"mm/day",timestamp:new Date().toISOString()}})}catch(a){let e=u(3.6,r,"fallback");return t.status(200).json({success:!0,source:"Simulated fallback (Open-Meteo unavailable)",isSimulated:!0,cacheHit:!1,warnings:[a?.message||"et_provider_failed"],providersTried:[{provider:"open-meteo-et",ok:!1,reason:a?.message||"et_provider_failed"}],data:{evapotranspiration:e.encoded,stats:e.stats,bbox:r,source:"Simulated",isSimulated:!0,units:"mm/day",timestamp:new Date().toISOString()}})}}catch(e){return t.status(500).json({error:"et_fetch_failed",message:String(e?.message||e)})}}let l=(0,s.l)(r,"default"),c=(0,s.l)(r,"config"),p=new i.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/et",pathname:"/api/et",bundlePath:"",filename:""},userland:r})},7153:(e,t)=>{var a;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return a}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(a||(a={}))},1802:(e,t,a)=>{e.exports=a(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var a=t(t.s=8689);module.exports=a})();