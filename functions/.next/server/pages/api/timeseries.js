"use strict";(()=>{var e={};e.id=61,e.ids=[61],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,n){return n in t?t[n]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,n)):"function"==typeof t&&"default"===n?t:void 0}}})},4969:(e,t,n)=>{n.r(t),n.d(t,{config:()=>u,default:()=>l,routeModule:()=>d});var r={};n.r(r),n.d(r,{default:()=>s});var a=n(1802),i=n(7153),o=n(6249);async function s(e,t){if("POST"!==e.method)return t.status(405).end();try{let{bbox:n,startDate:r,endDate:a,interval:i="monthly"}=e.body||{};if(!n||!Array.isArray(n)||4!==n.length)return t.status(400).json({error:"bbox_required",message:"Bounding box [minx,miny,maxx,maxy] is required"});console.log("Generating time series data for bbox:",n);let o=function(e,t,n,r="monthly"){let a=new Date(t||"2024-01-01"),i=n?new Date(n):new Date,o=[],s=new Date(a),l=.4+.3*Math.random();for(;s<=i;){let e=.8+.4*Math.sin(s.getMonth()/12*2*Math.PI-Math.PI/2),t=Math.max(0,Math.min(1,l*e+(Math.random()-.5)*.1+function(e){let t=e.getFullYear(),n=e.getMonth();return 2024===t&&n>=5&&n<=8?-.1:n>=2&&n<=5?.05:0}(s)));o.push({date:s.toISOString().split("T")[0],ndvi:parseFloat(t.toFixed(3)),confidence:.85+.1*Math.random(),cloudCover:30*Math.random(),source:"Sentinel-2",quality:t>.5?"high":t>.3?"medium":"low"}),"daily"===r?s.setDate(s.getDate()+1):"weekly"===r?s.setDate(s.getDate()+7):"monthly"===r&&s.setMonth(s.getMonth()+1)}return o}(0,r,a,i);return t.status(200).json({success:!0,data:{timeSeries:o,bbox:n,interval:i,startDate:r||"2024-01-01",endDate:a||new Date().toISOString().split("T")[0],summary:{totalPoints:o.length,averageNDVI:o.reduce((e,t)=>e+t.ndvi,0)/o.length,trend:function(e){if(e.length<2)return"insufficient_data";let t=e.slice(0,Math.floor(e.length/2)),n=e.slice(Math.floor(e.length/2)),r=t.reduce((e,t)=>e+t.ndvi,0)/t.length,a=n.reduce((e,t)=>e+t.ndvi,0)/n.length-r;return a>.05?"improving":a<-.05?"declining":"stable"}(o),seasonality:function(e){if(e.length<12)return{detected:!1};let t={};e.forEach(e=>{let n=new Date(e.date).getMonth();t[n]||(t[n]=[]),t[n].push(e.ndvi)});let n=[];for(let e=0;e<12;e++)t[e]?n[e]=t[e].reduce((e,t)=>e+t,0)/t[e].length:n[e]=0;let r=Math.max(...n),a=Math.min(...n),i=n.indexOf(r);return{detected:!0,peakMonth:i,lowMonth:n.indexOf(a),amplitude:r-a,peakNDVI:r,lowNDVI:a}}(o)}}})}catch(e){return console.error("timeseries API error",e?.message||e),t.status(500).json({error:"timeseries_failed",message:String(e?.message||e)})}}let l=(0,o.l)(r,"default"),u=(0,o.l)(r,"config"),d=new a.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/timeseries",pathname:"/api/timeseries",bundlePath:"",filename:""},userland:r})},7153:(e,t)=>{var n;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return n}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(n||(n={}))},1802:(e,t,n)=>{e.exports=n(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var n=t(t.s=4969);module.exports=n})();