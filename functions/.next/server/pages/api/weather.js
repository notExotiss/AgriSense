"use strict";(()=>{var e={};e.id=743,e.ids=[743],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,i){return i in t?t[i]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,i)):"function"==typeof t&&"default"===i?t:void 0}}})},1784:(e,t,i)=>{i.r(t),i.d(t,{config:()=>h,default:()=>l,routeModule:()=>_});var n={};i.r(n),i.d(n,{default:()=>p});var r=i(1802),o=i(7153),a=i(6249);let d={0:{condition:"Clear",description:"clear sky",icon:"01d"},1:{condition:"Clouds",description:"mainly clear",icon:"02d"},2:{condition:"Clouds",description:"partly cloudy",icon:"03d"},3:{condition:"Clouds",description:"overcast",icon:"04d"},45:{condition:"Mist",description:"fog",icon:"50d"},48:{condition:"Mist",description:"rime fog",icon:"50d"},51:{condition:"Drizzle",description:"light drizzle",icon:"09d"},53:{condition:"Drizzle",description:"drizzle",icon:"09d"},55:{condition:"Drizzle",description:"dense drizzle",icon:"09d"},61:{condition:"Rain",description:"slight rain",icon:"10d"},63:{condition:"Rain",description:"rain",icon:"10d"},65:{condition:"Rain",description:"heavy rain",icon:"10d"},66:{condition:"Rain",description:"freezing rain",icon:"13d"},67:{condition:"Rain",description:"heavy freezing rain",icon:"13d"},71:{condition:"Snow",description:"slight snow",icon:"13d"},73:{condition:"Snow",description:"snow",icon:"13d"},75:{condition:"Snow",description:"heavy snow",icon:"13d"},80:{condition:"Rain",description:"rain showers",icon:"09d"},81:{condition:"Rain",description:"rain showers",icon:"09d"},82:{condition:"Rain",description:"violent rain showers",icon:"09d"},95:{condition:"Thunderstorm",description:"thunderstorm",icon:"11d"},96:{condition:"Thunderstorm",description:"thunderstorm with hail",icon:"11d"},99:{condition:"Thunderstorm",description:"thunderstorm with heavy hail",icon:"11d"}};async function s(e,t=15e3){let i=new AbortController,n=setTimeout(()=>i.abort(),t);try{let t=await fetch(e,{signal:i.signal});if(!t.ok)throw Error(`http_${t.status}`);return await t.json()}finally{clearTimeout(n)}}function c(e){return"number"!=typeof e?d[0]:d[e]||d[0]}async function u(e,t){let i=`https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${e}&lon=${t}`;try{let n=new AbortController,r=setTimeout(()=>n.abort(),12e3),o=await fetch(i,{signal:n.signal,headers:{"User-Agent":"AgriSense/1.0 (agrisense.app)"}}).finally(()=>clearTimeout(r));if(!o.ok)throw Error(`http_${o.status}`);let a=await o.json(),d=a?.address||{};return{name:d.city||d.town||d.village||d.hamlet||d.county||a?.name||`Location (${e.toFixed(2)}, ${t.toFixed(2)})`,country:d.country_code?String(d.country_code).toUpperCase():"",state:d.state||""}}catch{return{name:`Location (${e.toFixed(2)}, ${t.toFixed(2)})`,country:"",state:""}}}async function m(e,t){let i=new URL("https://api.open-meteo.com/v1/forecast");i.searchParams.set("latitude",String(e)),i.searchParams.set("longitude",String(t)),i.searchParams.set("timezone","auto"),i.searchParams.set("forecast_days","7"),i.searchParams.set("temperature_unit","fahrenheit"),i.searchParams.set("wind_speed_unit","mph"),i.searchParams.set("current","temperature_2m,relative_humidity_2m,apparent_temperature,surface_pressure,wind_speed_10m,weather_code,precipitation"),i.searchParams.set("daily","weather_code,temperature_2m_max,temperature_2m_min,precipitation_sum,wind_speed_10m_max,et0_fao_evapotranspiration,uv_index_max");let[n,r]=await Promise.all([s(i.toString()),u(e,t)]),o=n.current||{},a=n.daily||{},d=c(o.weather_code),m=Array.isArray(a.time)?a.time.map((e,t)=>{let i=c(a.weather_code?.[t]);return{date:e,temp_max:Math.round(a.temperature_2m_max?.[t]??0),temp_min:Math.round(a.temperature_2m_min?.[t]??0),condition:i.condition,description:i.description,precipitation:Number((a.precipitation_sum?.[t]??0).toFixed(1)),humidity:Number(o.relative_humidity_2m??0),windSpeed:Math.round(a.wind_speed_10m_max?.[t]??o.wind_speed_10m??0),icon:i.icon}}):[];return{location:{lat:Number(e.toFixed(4)),lon:Number(t.toFixed(4)),name:r.name,country:r.country,state:r.state},current:{temperature:Math.round(o.temperature_2m??0),humidity:Math.round(o.relative_humidity_2m??0),windSpeed:Math.round(o.wind_speed_10m??0),condition:d.condition,description:d.description,precipitation:Number((o.precipitation??0).toFixed(1)),uvIndex:Math.round((a.uv_index_max?.[0]??0)||0),feelsLike:Math.round(o.apparent_temperature??o.temperature_2m??0),pressure:Math.round(o.surface_pressure??0),visibility:10,icon:d.icon},forecast:m}}async function p(e,t){if("POST"!==e.method)return t.status(405).end();try{let i,n;let{bbox:r,location:o}=e.body||{};if(o&&"number"==typeof o.lat&&"number"==typeof o.lon)i=o.lat,n=o.lon;else{if(!Array.isArray(r)||4!==r.length)return t.status(400).json({error:"location_required",message:"Either bbox [minx,miny,maxx,maxy] or location { lat, lon } is required."});i=(Number(r[1])+Number(r[3]))/2,n=(Number(r[0])+Number(r[2]))/2}try{let e=await m(i,n);return t.status(200).json({success:!0,source:"Open-Meteo",isSimulated:!1,cacheHit:!1,warnings:[],providersTried:[{provider:"open-meteo-weather",ok:!0}],data:e})}catch(r){let e=function(e,t){let i=new Date,n=Array.from({length:7}).map((e,t)=>({date:new Date(i.getTime()+864e5*t).toISOString().slice(0,10),temp_max:69+t%3,temp_min:55+t%2,condition:t%3==0?"Clouds":t%4==0?"Rain":"Clear",description:t%3==0?"partly cloudy":t%4==0?"showers":"clear sky",precipitation:t%4==0?4.1:.4,humidity:65+t%2*4,windSpeed:9+t%3,icon:t%3==0?"03d":t%4==0?"10d":"01d"}));return{location:{lat:Number(e.toFixed(4)),lon:Number(t.toFixed(4)),name:`Location (${e.toFixed(2)}, ${t.toFixed(2)})`,country:"",state:""},current:{temperature:62,humidity:66,windSpeed:10,condition:"Clouds",description:"partly cloudy",precipitation:.4,uvIndex:4,feelsLike:62,pressure:1014,visibility:8,icon:"03d"},forecast:n}}(i,n);return t.status(200).json({success:!0,source:"Simulated fallback (Open-Meteo unavailable)",isSimulated:!0,cacheHit:!1,warnings:[r?.message||"weather_provider_failed"],providersTried:[{provider:"open-meteo-weather",ok:!1,reason:r?.message||"weather_provider_failed"}],data:e})}}catch(e){return t.status(500).json({error:"weather_fetch_failed",message:e?.message||"Unknown weather error"})}}let l=(0,a.l)(n,"default"),h=(0,a.l)(n,"config"),_=new r.PagesAPIRouteModule({definition:{kind:o.x.PAGES_API,page:"/api/weather",pathname:"/api/weather",bundlePath:"",filename:""},userland:n})},7153:(e,t)=>{var i;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return i}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(i||(i={}))},1802:(e,t,i)=>{e.exports=i(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var i=t(t.s=1784);module.exports=i})();