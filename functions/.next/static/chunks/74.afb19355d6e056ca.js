"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[74],{8074:function(e,t,o){o.r(t);var r=o(5893),n=o(7294),l=o(4250),i=o(9477);t.default=e=>{let{ndviData:t,bbox:o,onViewStateChange:a=()=>{},show3D:s=!1,layerType:d="scatter",location:c}=e,x=(0,n.useRef)(null),h=(0,n.useRef)(null),p=(0,n.useRef)(null),u=(0,n.useRef)(null),g=(0,n.useRef)([]),m=(0,n.useRef)(!1),f=(0,n.useRef)({x:0,y:0}),[b,v]=(0,n.useState)("scatter"),[M,y]=(0,n.useState)(s),[w,j]=(0,n.useState)([]),[S,k]=(0,n.useState)({x:.5,y:0}),[R,D]=(0,n.useState)(1),[z,E]=(0,n.useState)(!1),[I,C]=(0,n.useState)({lat:40,lon:-95,name:"Selected Location"});(0,n.useEffect)(()=>{let e=()=>E(document.documentElement.classList.contains("dark"));e();let t=new MutationObserver(e);return t.observe(document.documentElement,{attributes:!0,attributeFilter:["class"]}),()=>t.disconnect()},[]),(0,n.useEffect)(()=>{(null==c?void 0:c.lat)&&(null==c?void 0:c.lon)&&C({lat:c.lat,lon:c.lon,name:c.name||"Selected Location"})},[null==c?void 0:c.lat,null==c?void 0:c.lon,null==c?void 0:c.name]),(0,n.useEffect)(()=>{B()},[I.lat,I.lon]);let B=()=>{let e=[];for(let t=0;t<60;t++)for(let o=0;o<60;o++){I.lat,I.lon;let r=.3+Math.sqrt(Math.pow(t-30,2)+Math.pow(o-30,2))/30*.5;r+=(Math.random()-.5)*.15+(Math.sin(.2*t)*Math.cos(.2*o)*.15+Math.sin(.1*t)*Math.cos(.15*o)*.1+Math.sin(.05*t)*Math.cos(.05*o)*.08),r=Math.max(-.2,Math.min(1,r)),.05>Math.random()&&(r=.6>Math.random()?.85:-.15),e.push({x:(t-30)*2,y:(o-30)*2,ndvi:r,elevation:25*r,color:L(r),cityName:I.name})}j(e),k({x:.5,y:0}),D(1)},L=e=>{let t=Math.max(-1,Math.min(1,e));if(t<-.1){let e=(t+1)/.9;return[Math.floor(40+60*e),Math.floor(80+100*e),Math.floor(140+80*e)]}if(t<.05){let e=(t+.1)/.15;return[Math.floor(100+80*e),Math.floor(180+50*e),Math.floor(220-30*e)]}if(t<.15){let e=(t-.05)/.1;return[Math.floor(180+30*e),Math.floor(230-30*e),Math.floor(190-50*e)]}if(t<.3){let e=(t-.15)/.15;return[Math.floor(210-50*e),Math.floor(200-20*e),Math.floor(140-50*e)]}if(t<.5){let e=(t-.3)/.2;return[Math.floor(160-30*e),Math.floor(180+30*e),Math.floor(90-10*e)]}if(t<.7){let e=(t-.5)/.2;return[Math.floor(130-70*e),Math.floor(210-60*e),Math.floor(80+20*e)]}{let e=(t-.7)/.3;return[Math.floor(60+80*e),Math.floor(150-30*e),Math.floor(100-40*e)]}};(0,n.useEffect)(()=>{if(!x.current||0===w.length)return;let e=new l.xsS;e.background=new l.Ilk(z?1710618:15266037),h.current=e;let t=new l.cPb(60,x.current.clientWidth/x.current.clientHeight,.1,1e3);t.position.set(0,60,100),t.lookAt(0,0,0),p.current=t;let o=new i.CP7({antialias:!0});o.setSize(x.current.clientWidth,x.current.clientHeight),x.current.innerHTML="",x.current.appendChild(o.domElement),u.current=o;let r=new l.Mig(16777215,z?.5:.75);e.add(r);let n=new l.Ox3(16777215,z?.6:.5);n.position.set(50,80,50),e.add(n);let a=new l.Ox3(16777215,z?.3:.25);a.position.set(-50,40,-50),e.add(a);let s=new l._12(100,100),d=new l.xoR({color:z?855309:14215408,side:l.ehD,transparent:!0,opacity:z?.6:.4}),c=new l.Kj0(s,d);c.rotation.x=-Math.PI/2,e.add(c);let g=new l.VLJ(100,20,z?4473924:11587808,z?2763306:13164784);g.material.opacity=z?.4:.3,g.material.transparent=!0,e.add(g),W(e);let m=()=>{requestAnimationFrame(m),h.current&&(h.current.rotation.x=S.x,h.current.rotation.y=S.y,p.current&&(p.current.position.set(0,60/R,100/R),p.current.lookAt(0,0,0))),o.render(e,t)};m();let f=()=>{if(x.current&&p.current&&u.current){let e=x.current.clientWidth,t=x.current.clientHeight;p.current.aspect=e/t,p.current.updateProjectionMatrix(),u.current.setSize(e,t)}};return window.addEventListener("resize",f),()=>{window.removeEventListener("resize",f),x.current&&o.domElement&&x.current.removeChild(o.domElement),o.dispose()}},[w,b,M,S,R,z]);let W=e=>{g.current.forEach(t=>e.remove(t)),g.current=[];let t=Math.sqrt(w.length);if("heatmap"===b||"scatter"===b){let o=new l._12(2*t,2*t,t-1,t-1),r=o.attributes.position.array,n=[];for(let e=0;e<w.length;e++){let t=w[e];r[3*e+2]=M?1.5*t.elevation:.6*t.elevation,n.push(t.color[0]/255,t.color[1]/255,t.color[2]/255)}o.setAttribute("color",new l.a$l(n,3)),o.computeVertexNormals();let i=new l.xoR({vertexColors:!0,side:l.ehD,flatShading:!1,shininess:z?15:20,specular:new l.Ilk(z?2236962:3355443),emissive:new l.Ilk(0),emissiveIntensity:0,reflectivity:.3}),a=new l.Kj0(o,i);a.rotation.x=-Math.PI/2,e.add(a),g.current.push(a),F(e,o,w,t)}else w.forEach(t=>{if("column"===b){let o=new l.Ilk(t.color[0]/255,t.color[1]/255,t.color[2]/255),r=M?Math.max(t.elevation,1):1,n=new l.fHI(.4,.4,r,12),i=new l.xoR({color:o}),a=new l.Kj0(n,i);a.position.set(t.x,r/2,t.y),e.add(a),g.current.push(a)}})},F=(e,t,o,r)=>{let n=t.attributes.position;[-.1,0,.1,.2,.3,.4,.5,.6,.7,.8].forEach(t=>{let i=[];for(let e=0;e<r-1;e++)for(let a=0;a<r-1;a++){let s=e*r+a,d=o[s],c=o[s+1],x=o[s+r];if(o[s+r+1],(d.ndvi-t)*(c.ndvi-t)<0){let e=(t-d.ndvi)/(c.ndvi-d.ndvi),o=n.getX(s),r=n.getY(s),a=n.getZ(s),x=n.getX(s+1),h=n.getY(s+1),p=n.getZ(s+1);i.push(new l.Pa4(o+(x-o)*e,r+(h-r)*e,a+(p-a)*e+.1))}if((d.ndvi-t)*(x.ndvi-t)<0){let e=(t-d.ndvi)/(x.ndvi-d.ndvi),o=n.getX(s),a=n.getY(s),c=n.getZ(s),h=n.getX(s+r),p=n.getY(s+r),u=n.getZ(s+r);i.push(new l.Pa4(o+(h-o)*e,a+(p-a)*e,c+(u-c)*e+.1))}}if(i.length>1){let t=new l.u9r().setFromPoints(i),o=new l.nls({color:z?5592405:0,opacity:z?.25:.18,transparent:!0,linewidth:1}),r=new l.ejS(t,o);r.rotation.x=-Math.PI/2,e.add(r),g.current.push(r)}})},P=()=>{m.current=!1},T=w.length>0?w[0].cityName:(null==c?void 0:c.name)||"Selected Location",V=w.map(e=>e.ndvi),N=V.length>0?Math.min(...V):0,Y=V.length>0?Math.max(...V):0,X=V.length>0?V.reduce((e,t)=>e+t,0)/V.length:0;return(0,r.jsxs)("div",{style:{height:"600px",width:"100%",position:"relative"},children:[(0,r.jsx)("div",{ref:x,onMouseDown:e=>{m.current=!0,f.current={x:e.clientX,y:e.clientY}},onMouseMove:e=>{if(!m.current)return;let t=e.clientX-f.current.x,o=e.clientY-f.current.y;k(e=>({x:e.x+.01*o,y:e.y+.01*t})),f.current={x:e.clientX,y:e.clientY}},onMouseUp:P,onMouseLeave:P,onWheel:e=>{e.preventDefault();let t=e.deltaY>0?.9:1.1;D(e=>Math.max(.5,Math.min(3,e*t)))},style:{width:"100%",height:"100%",cursor:m.current?"grabbing":"grab",borderRadius:"8px",overflow:"hidden"}}),(0,r.jsxs)("div",{style:{position:"absolute",top:"10px",right:"10px",background:z?"rgba(17, 24, 39, 0.95)":"rgba(255, 255, 255, 0.95)",padding:"15px",borderRadius:"8px",boxShadow:"0 2px 12px rgba(0,0,0,0.15)",minWidth:"200px",backdropFilter:"blur(10px)",color:z?"#e5e7eb":"#333"},children:[(0,r.jsx)("div",{style:{marginBottom:"12px",fontWeight:"bold",fontSize:"16px"},children:"Map Controls"}),(0,r.jsx)("div",{style:{marginBottom:"8px",fontSize:"13px",color:z?"#94a3b8":"#666"},children:"Layer Type:"}),(0,r.jsxs)("select",{value:b,onChange:e=>v(e.target.value),style:{marginBottom:"12px",width:"100%",padding:"8px",borderRadius:"4px",border:z?"1px solid #555":"1px solid #ddd",fontSize:"13px",background:z?"#1f2937":"white",color:z?"#e5e7eb":"#333"},children:[(0,r.jsx)("option",{value:"heatmap",children:"Topographic Map"}),(0,r.jsx)("option",{value:"scatter",children:"Scatter Points"}),(0,r.jsx)("option",{value:"column",children:"3D Columns"})]}),(0,r.jsxs)("label",{style:{display:"flex",alignItems:"center",fontSize:"13px",marginBottom:"12px"},children:[(0,r.jsx)("input",{type:"checkbox",checked:M,onChange:e=>y(e.target.checked),style:{marginRight:"8px"}}),"Full Height (Toggle for more/less depth)"]}),(0,r.jsxs)("div",{style:{marginTop:"12px",paddingTop:"12px",borderTop:z?"1px solid #444":"1px solid #ddd"},children:[(0,r.jsxs)("div",{style:{fontSize:"12px",color:z?"#94a3b8":"#666",marginBottom:"4px"},children:["Zoom: ",R.toFixed(2),"x"]}),(0,r.jsx)("button",{onClick:()=>k({x:.5,y:0}),style:{padding:"6px 10px",fontSize:"12px",background:"#6c757d",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",width:"100%",marginTop:"4px"},children:"Reset View"})]})]}),(0,r.jsxs)("div",{style:{position:"absolute",top:"10px",left:"10px",background:z?"rgba(17, 24, 39, 0.95)":"rgba(255, 255, 255, 0.95)",padding:"15px",borderRadius:"8px",fontSize:"13px",maxWidth:"250px",boxShadow:"0 2px 12px rgba(0,0,0,0.15)",backdropFilter:"blur(10px)",color:z?"#e5e7eb":"#333"},children:[(0,r.jsxs)("div",{style:{fontWeight:"bold",marginBottom:"8px",fontSize:"16px"},children:[T," - NDVI Analysis"]}),(0,r.jsxs)("div",{style:{marginBottom:"4px"},children:[(0,r.jsx)("strong",{children:"Layer:"})," ","column"===b?"3D Columns":"scatter"===b?"Scatter Points":"Topographic Map"]}),(0,r.jsxs)("div",{style:{marginBottom:"4px"},children:[(0,r.jsx)("strong",{children:"3D Mode:"})," ",M?"On":"Off"]}),(0,r.jsxs)("div",{style:{marginBottom:"4px"},children:[(0,r.jsx)("strong",{children:"Data Points:"})," ",w.length.toLocaleString()]}),(0,r.jsx)("hr",{style:{margin:"8px 0",border:"none",borderTop:z?"1px solid #444":"1px solid #ddd"}}),(0,r.jsxs)("div",{style:{marginBottom:"4px"},children:[(0,r.jsx)("strong",{children:"Min NDVI:"})," ",N.toFixed(3)]}),(0,r.jsxs)("div",{style:{marginBottom:"4px"},children:[(0,r.jsx)("strong",{children:"Max NDVI:"})," ",Y.toFixed(3)]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("strong",{children:"Mean NDVI:"})," ",X.toFixed(3)]})]}),(0,r.jsxs)("div",{style:{position:"absolute",bottom:"10px",right:"10px",background:z?"rgba(17, 24, 39, 0.95)":"rgba(255, 255, 255, 0.95)",padding:"12px",borderRadius:"8px",fontSize:"12px",boxShadow:"0 2px 12px rgba(0,0,0,0.15)",backdropFilter:"blur(10px)",color:z?"#e5e7eb":"#333"},children:[(0,r.jsx)("div",{style:{fontWeight:"bold",marginBottom:"8px",fontSize:"13px"},children:"NDVI Legend"}),[{color:[40,80,140],label:"Deep Water (<-0.1)"},{color:[100,180,220],label:"Shallow Water (0)"},{color:[180,230,190],label:"Coastal (0.05)"},{color:[210,200,140],label:"Low Veg (0.15)"},{color:[130,180,90],label:"Moderate (0.5)"},{color:[60,150,100],label:"Dense Veg (0.7)"},{color:[140,120,60],label:"Very Dense (>0.8)"}].map((e,t)=>(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",marginBottom:"4px"},children:[(0,r.jsx)("div",{style:{width:"16px",height:"16px",background:"rgb(".concat(e.color[0],", ").concat(e.color[1],", ").concat(e.color[2],")"),marginRight:"8px",borderRadius:"2px",border:z?"1px solid #555":"1px solid #ddd"}}),(0,r.jsx)("span",{children:e.label})]},t))]}),(0,r.jsxs)("div",{style:{position:"absolute",bottom:"10px",left:"10px",background:z?"rgba(17, 24, 39, 0.95)":"rgba(255, 255, 255, 0.95)",padding:"10px",borderRadius:"8px",fontSize:"11px",boxShadow:"0 2px 12px rgba(0,0,0,0.15)",backdropFilter:"blur(10px)",maxWidth:"200px",color:z?"#e5e7eb":"#333"},children:[(0,r.jsx)("div",{style:{fontWeight:"bold",marginBottom:"4px"},children:"Controls:"}),(0,r.jsx)("div",{children:"• Click + drag to rotate"}),(0,r.jsx)("div",{children:"• Scroll to zoom"}),(0,r.jsx)("div",{children:"• Toggle 3D for elevation"}),(0,r.jsx)("div",{children:"• Reset view button available"})]})]})}}}]);