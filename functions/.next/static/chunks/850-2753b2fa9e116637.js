"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[850],{3945:function(e,t,r){r.d(t,{Z:function(){return b}});var n=r(5893),a=r(7294),i=r(1664),o=r.n(i),s=r(7716),l=r(6789),d=r(1352),c=r(7232),u=r(7497),f=r(1571),h=r(8532),m=r(250);function x(){let[e,t]=(0,a.useState)(!1),{theme:r,setTheme:i}=(0,f.F)();if((0,a.useEffect)(()=>{t(!0)},[]),!e)return(0,n.jsx)(u.z,{variant:"ghost",size:"icon","aria-label":"Toggle theme",children:(0,n.jsx)(h.Z,{className:"h-4 w-4"})});let o="dark"===r;return(0,n.jsx)(u.z,{variant:"ghost",size:"icon","aria-label":"Toggle theme",onClick:()=>i(o?"light":"dark"),children:o?(0,n.jsx)(h.Z,{className:"h-4 w-4"}):(0,n.jsx)(m.Z,{className:"h-4 w-4"})})}let p=[{href:"/",label:"Home"},{href:"/dashboard",label:"Dashboard"},{href:"/plots",label:"Plots"},{href:"/account",label:"Account"}],g=/^\/(dashboard|plots|account|ingest)(\/|$)/;function v(e){return g.test(e)?"/api/session/enter?next=".concat(encodeURIComponent(e)):e}function b(){let[e,t]=a.useState([]),[r,i]=a.useState(!1),[f,h]=a.useState(!1);a.useEffect(()=>{let e=e=>{t(Array.isArray(e.detail)?e.detail:[])};return window.addEventListener("agrisense:alerts",e),()=>window.removeEventListener("agrisense:alerts",e)},[]);let m=e.filter(e=>"critical"===e.type).length;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("header",{className:"liquid-glass sticky top-0 z-40 border-b border-border bg-background/95 backdrop-blur",children:[(0,n.jsxs)("div",{className:"mx-auto flex h-16 w-full max-w-7xl items-center justify-between px-4 sm:px-6",children:[(0,n.jsxs)(o(),{href:"/",className:"inline-flex items-center gap-2",children:[(0,n.jsx)("span",{className:"inline-flex h-9 w-9 items-center justify-center rounded-xl bg-primary text-primary-foreground",children:(0,n.jsx)(s.Z,{className:"h-5 w-5"})}),(0,n.jsxs)("span",{children:[(0,n.jsx)("span",{className:"block text-sm font-semibold leading-none text-foreground",children:"AgriSense"}),(0,n.jsx)("span",{className:"block text-[11px] uppercase tracking-[0.16em] text-muted-foreground",children:"Field Ops"})]})]}),(0,n.jsx)("nav",{className:"hidden items-center gap-5 md:flex",children:p.map(e=>(0,n.jsx)(o(),{href:v(e.href),className:"text-sm font-medium text-muted-foreground transition hover:text-primary",children:e.label},e.href))}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsxs)("button",{onClick:()=>h(e=>!e),className:"relative inline-flex h-10 w-10 items-center justify-center rounded-xl border border-border bg-card text-muted-foreground hover:border-primary/40 hover:text-foreground","aria-label":"Open alerts",children:[(0,n.jsx)(l.Z,{className:"h-4 w-4"}),e.length>0&&(0,n.jsx)("span",{className:"absolute -right-1 -top-1 rounded-full bg-rose-600 px-1.5 py-0.5 text-[10px] font-semibold text-white",children:m||e.length})]}),(0,n.jsx)(x,{}),(0,n.jsx)(u.z,{variant:"outline",size:"icon",className:"md:hidden",onClick:()=>i(e=>!e),children:r?(0,n.jsx)(d.Z,{className:"h-4 w-4"}):(0,n.jsx)(c.Z,{className:"h-4 w-4"})})]})]}),r&&(0,n.jsx)("nav",{className:"border-t border-border bg-background px-4 py-3 md:hidden",children:(0,n.jsxs)("div",{className:"space-y-2",children:[p.map(e=>(0,n.jsx)(o(),{href:v(e.href),onClick:()=>i(!1),className:"block rounded-lg px-3 py-2 text-sm font-medium text-muted-foreground hover:bg-muted hover:text-primary",children:e.label},e.href)),(0,n.jsx)("div",{className:"pt-2",children:(0,n.jsx)(x,{})})]})})]}),f&&(0,n.jsxs)("aside",{className:"liquid-glass fixed right-4 top-20 z-50 w-[min(95vw,26rem)] rounded-2xl border border-border bg-card shadow-xl",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between border-b border-border px-4 py-3",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-sm font-semibold text-foreground",children:"Alert Center"}),(0,n.jsx)("p",{className:"text-xs text-muted-foreground",children:"Active agronomy and system alerts"})]}),(0,n.jsx)("button",{onClick:()=>h(!1),className:"text-muted-foreground hover:text-foreground",children:(0,n.jsx)(d.Z,{className:"h-4 w-4"})})]}),(0,n.jsxs)("div",{className:"max-h-80 space-y-2 overflow-auto p-3",children:[!e.length&&(0,n.jsx)("p",{className:"rounded-lg bg-muted p-3 text-sm text-muted-foreground",children:"No active alerts."}),e.map((e,t)=>(0,n.jsxs)("article",{className:"critical"===e.type?"alert-card alert-card-critical":"alert-card alert-card-warning",children:[(0,n.jsx)("p",{className:"alert-title",children:e.message||"Alert"}),(0,n.jsx)("p",{className:"alert-copy",children:e.details||"No additional details provided."}),e.plotName&&(0,n.jsx)("p",{className:"alert-meta",children:e.plotName})]},"".concat(e.id||t)))]})]})]})}},5133:function(e,t,r){var n=r(5893),a=r(7294);t.Z=e=>{let{data:t,title:r="NDVI Time Series",height:i=300,showConfidence:o=!1,showCloudCover:s=!1}=e,l=(0,a.useRef)(null);return(0,a.useEffect)(()=>{if(!l.current||!t.length)return;let e=l.current,n=e.getContext("2d");if(!n)return;e.width=e.offsetWidth*window.devicePixelRatio,e.height=i*window.devicePixelRatio,n.scale(window.devicePixelRatio,window.devicePixelRatio),n.clearRect(0,0,e.offsetWidth,i);let a={top:20,right:40,bottom:40,left:60},d=e.offsetWidth-a.left-a.right,c=i-a.top-a.bottom,u=t.map(e=>new Date(e.date)),f=t.map(e=>e.ndvi),h=new Date(Math.min(...u.map(e=>e.getTime()))),m=new Date(Math.max(...u.map(e=>e.getTime()))),x=Math.min(...f),p=Math.max(...f),g=p-x,v=x-.1*g,b=p+.1*g,y=e=>a.left+(e.getTime()-h.getTime())/(m.getTime()-h.getTime())*d,w=e=>a.top+c-(e-v)/(b-v)*c;n.strokeStyle="#e0e0e0",n.lineWidth=1;for(let e=0;e<=5;e++){let t=a.top+c/5*e;n.beginPath(),n.moveTo(a.left,t),n.lineTo(a.left+d,t),n.stroke()}for(let e=0;e<=5;e++){let t=a.left+d/5*e;n.beginPath(),n.moveTo(t,a.top),n.lineTo(t,a.top+c),n.stroke()}if(o&&t.some(e=>e.confidence)){n.fillStyle="rgba(0, 123, 255, 0.1)",n.beginPath(),t.forEach((e,t)=>{let r=y(new Date(e.date)),a=e.confidence||.9,i=w(e.ndvi+(1-a)*.1);0===t?n.moveTo(r,i):n.lineTo(r,i)});for(let e=t.length-1;e>=0;e--){let r=t[e],a=y(new Date(r.date)),i=r.confidence||.9,o=w(r.ndvi-(1-i)*.1);n.lineTo(a,o)}n.closePath(),n.fill()}n.strokeStyle="#007bff",n.lineWidth=2,n.beginPath(),t.forEach((e,t)=>{let r=y(new Date(e.date)),a=w(e.ndvi);0===t?n.moveTo(r,a):n.lineTo(r,a)}),n.stroke(),n.fillStyle="#007bff",t.forEach(e=>{let t=y(new Date(e.date)),r=w(e.ndvi);n.beginPath(),n.arc(t,r,3,0,2*Math.PI),n.fill()}),n.strokeStyle="#333",n.lineWidth=2,n.beginPath(),n.moveTo(a.left,a.top+c),n.lineTo(a.left+d,a.top+c),n.stroke(),n.beginPath(),n.moveTo(a.left,a.top),n.lineTo(a.left,a.top+c),n.stroke(),n.fillStyle="#333",n.font="12px Arial",n.textAlign="center";for(let e=0;e<=5;e++){let t=new Date(h.getTime()+(m.getTime()-h.getTime())*(e/5)),r=a.left+d/5*e;n.fillText(t.toLocaleDateString(),r,a.top+c+20)}n.textAlign="right";for(let e=0;e<=5;e++){let t=v+e/5*(b-v),r=a.top+c-c/5*e;n.fillText(t.toFixed(2),a.left-10,r+4)}n.textAlign="center",n.font="bold 16px Arial",n.fillText(r,e.offsetWidth/2,20),s&&(n.font="12px Arial",n.textAlign="left",n.fillText("Cloud Cover:",a.left+d+10,a.top+20),t.forEach((e,t)=>{if(void 0!==e.cloudCover){let t=y(new Date(e.date)),r=w(e.ndvi),a=1-e.cloudCover/100;n.fillStyle="rgba(255, 0, 0, ".concat(a,")"),n.beginPath(),n.arc(t,r,5,0,2*Math.PI),n.fill()}}))},[t,i,o,s,r]),(0,n.jsx)("div",{className:"w-full",children:(0,n.jsx)("canvas",{ref:l,style:{width:"100%",height:"".concat(i,"px")},className:"border rounded"})})}},7497:function(e,t,r){r.d(t,{z:function(){return l}});var n=r(5893),a=r(7294),i=r(2003),o=r(1966);let s=(0,i.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:opacity-90",secondary:"bg-secondary text-secondary-foreground hover:opacity-90",outline:"border bg-transparent hover:bg-accent hover:text-accent-foreground",ghost:"hover:bg-accent hover:text-accent-foreground",destructive:"bg-destructive text-destructive-foreground hover:opacity-90"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),l=a.forwardRef((e,t)=>{let{className:r,variant:a,size:i,...l}=e;return(0,n.jsx)("button",{className:(0,o.cn)(s({variant:a,size:i,className:r})),ref:t,...l})});l.displayName="Button"},1966:function(e,t,r){r.d(t,{cn:function(){return i}});var n=r(512),a=r(8388);function i(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,a.m6)((0,n.W)(t))}},8704:function(e,t,r){r.d(t,{$D:function(){return o},GY:function(){return n},eR:function(){return d},k1:function(){return s},pb:function(){return l}});class n extends Error{constructor(e,t,r){super(e),this.name="ApiClientError",this.code=t,this.status=r}}async function a(e){try{return await e.json()}catch(e){return{}}}async function i(e,t){let r=await fetch(e,t),i=await a(r);if(!r.ok)throw new n((null==i?void 0:i.message)||(null==i?void 0:i.error)||"Request failed (".concat(r.status,")"),(null==i?void 0:i.error)||"request_failed",r.status);return i}function o(e){return e instanceof n?"invalid_auth"===e.code?"Authentication token is invalid or expired. Sign in again and retry.":401===e.status?"Sign-in expired. Please sign in again.":403===e.status?"You do not have access to this plot.":408===e.status?"Request timed out. Retry in a few seconds.":413===e.status||"plot_payload_too_large"===e.code?"Plot snapshot is too large to save. Re-run analysis and retry.":"invalid_geometry"===e.code?"Selected area geometry is invalid. Redraw the AOI and retry.":"invalid_payload"===e.code?"Plot payload contains unsupported values.":503===e.status||"firebase_admin_misconfigured"===e.code?"Server save service is misconfigured. Check Firebase Admin credentials.":"validation_failed"===e.code?"Some required fields are missing.":e.message||"Save failed. Please retry.":"Network issue. Check connection and retry."}async function s(e){let t=await i("/api/items",{method:"GET",headers:{Authorization:"Bearer ".concat(e)}});return Array.isArray(t.items)?t.items:[]}async function l(e,t){return await i("/api/items",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify(t)})}async function d(e,t){await i("/api/plots/".concat(t),{method:"DELETE",headers:{Authorization:"Bearer ".concat(e)}})}},6394:function(e,t,r){r.d(t,{I8:function(){return c},oy:function(){return u}});var n=r(3977),a=r(2370),i=r(3454);let o={apiKey:i.env.NEXT_PUBLIC_FIREBASE_API_KEY,authDomain:i.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,projectId:i.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,storageBucket:i.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,messagingSenderId:i.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,appId:i.env.NEXT_PUBLIC_FIREBASE_APP_ID},s=Object.values(o).every(e=>"string"==typeof e&&e.length>0);function l(){return s?(0,n.C6)().length?(0,n.Mq)():(0,n.ZF)(o):null}let d=null;l();let c=function(){if(!s)return null;if(d)return d;let e=l();return e?d=(0,a.v0)(e):null}(),u=s}}]);