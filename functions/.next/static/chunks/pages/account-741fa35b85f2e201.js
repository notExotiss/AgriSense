(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[966],{682:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/account",function(){return r(1854)}])},3945:function(e,t,r){"use strict";r.d(t,{Z:function(){return y}});var n=r(5893),a=r(7294),s=r(1664),i=r.n(s),o=r(7716),c=r(6789),l=r(1352),d=r(7232),u=r(7497),h=r(1571),m=r(8532),x=r(250);function p(){let[e,t]=(0,a.useState)(!1),{theme:r,setTheme:s}=(0,h.F)();if((0,a.useEffect)(()=>{t(!0)},[]),!e)return(0,n.jsx)(u.z,{variant:"ghost",size:"icon","aria-label":"Toggle theme",children:(0,n.jsx)(m.Z,{className:"h-4 w-4"})});let i="dark"===r;return(0,n.jsx)(u.z,{variant:"ghost",size:"icon","aria-label":"Toggle theme",onClick:()=>s(i?"light":"dark"),children:i?(0,n.jsx)(m.Z,{className:"h-4 w-4"}):(0,n.jsx)(x.Z,{className:"h-4 w-4"})})}let f=[{href:"/",label:"Home"},{href:"/dashboard",label:"Dashboard"},{href:"/plots",label:"Plots"},{href:"/account",label:"Account"}],g=/^\/(dashboard|plots|account|ingest)(\/|$)/;function b(e){return g.test(e)?"/api/session/enter?next=".concat(encodeURIComponent(e)):e}function y(){let[e,t]=a.useState([]),[r,s]=a.useState(!1),[h,m]=a.useState(!1);a.useEffect(()=>{let e=e=>{t(Array.isArray(e.detail)?e.detail:[])};return window.addEventListener("agrisense:alerts",e),()=>window.removeEventListener("agrisense:alerts",e)},[]);let x=e.filter(e=>"critical"===e.type).length;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("header",{className:"liquid-glass sticky top-0 z-40 border-b border-border bg-background/95 backdrop-blur",children:[(0,n.jsxs)("div",{className:"mx-auto flex h-16 w-full max-w-7xl items-center justify-between px-4 sm:px-6",children:[(0,n.jsxs)(i(),{href:"/",className:"inline-flex items-center gap-2",children:[(0,n.jsx)("span",{className:"inline-flex h-9 w-9 items-center justify-center rounded-xl bg-primary text-primary-foreground",children:(0,n.jsx)(o.Z,{className:"h-5 w-5"})}),(0,n.jsxs)("span",{children:[(0,n.jsx)("span",{className:"block text-sm font-semibold leading-none text-foreground",children:"AgriSense"}),(0,n.jsx)("span",{className:"block text-[11px] uppercase tracking-[0.16em] text-muted-foreground",children:"Field Ops"})]})]}),(0,n.jsx)("nav",{className:"hidden items-center gap-5 md:flex",children:f.map(e=>(0,n.jsx)(i(),{href:b(e.href),className:"text-sm font-medium text-muted-foreground transition hover:text-primary",children:e.label},e.href))}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsxs)("button",{onClick:()=>m(e=>!e),className:"relative inline-flex h-10 w-10 items-center justify-center rounded-xl border border-border bg-card text-muted-foreground hover:border-primary/40 hover:text-foreground","aria-label":"Open alerts",children:[(0,n.jsx)(c.Z,{className:"h-4 w-4"}),e.length>0&&(0,n.jsx)("span",{className:"absolute -right-1 -top-1 rounded-full bg-rose-600 px-1.5 py-0.5 text-[10px] font-semibold text-white",children:x||e.length})]}),(0,n.jsx)(p,{}),(0,n.jsx)(u.z,{variant:"outline",size:"icon",className:"md:hidden",onClick:()=>s(e=>!e),children:r?(0,n.jsx)(l.Z,{className:"h-4 w-4"}):(0,n.jsx)(d.Z,{className:"h-4 w-4"})})]})]}),r&&(0,n.jsx)("nav",{className:"border-t border-border bg-background px-4 py-3 md:hidden",children:(0,n.jsxs)("div",{className:"space-y-2",children:[f.map(e=>(0,n.jsx)(i(),{href:b(e.href),onClick:()=>s(!1),className:"block rounded-lg px-3 py-2 text-sm font-medium text-muted-foreground hover:bg-muted hover:text-primary",children:e.label},e.href)),(0,n.jsx)("div",{className:"pt-2",children:(0,n.jsx)(p,{})})]})})]}),h&&(0,n.jsxs)("aside",{className:"liquid-glass fixed right-4 top-20 z-50 w-[min(95vw,26rem)] rounded-2xl border border-border bg-card shadow-xl",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between border-b border-border px-4 py-3",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-sm font-semibold text-foreground",children:"Alert Center"}),(0,n.jsx)("p",{className:"text-xs text-muted-foreground",children:"Active agronomy and system alerts"})]}),(0,n.jsx)("button",{onClick:()=>m(!1),className:"text-muted-foreground hover:text-foreground",children:(0,n.jsx)(l.Z,{className:"h-4 w-4"})})]}),(0,n.jsxs)("div",{className:"max-h-80 space-y-2 overflow-auto p-3",children:[!e.length&&(0,n.jsx)("p",{className:"rounded-lg bg-muted p-3 text-sm text-muted-foreground",children:"No active alerts."}),e.map((e,t)=>(0,n.jsxs)("article",{className:"critical"===e.type?"alert-card alert-card-critical":"alert-card alert-card-warning",children:[(0,n.jsx)("p",{className:"alert-title",children:e.message||"Alert"}),(0,n.jsx)("p",{className:"alert-copy",children:e.details||"No additional details provided."}),e.plotName&&(0,n.jsx)("p",{className:"alert-meta",children:e.plotName})]},"".concat(e.id||t)))]})]})]})}},7497:function(e,t,r){"use strict";r.d(t,{z:function(){return c}});var n=r(5893),a=r(7294),s=r(2003),i=r(1966);let o=(0,s.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:opacity-90",secondary:"bg-secondary text-secondary-foreground hover:opacity-90",outline:"border bg-transparent hover:bg-accent hover:text-accent-foreground",ghost:"hover:bg-accent hover:text-accent-foreground",destructive:"bg-destructive text-destructive-foreground hover:opacity-90"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),c=a.forwardRef((e,t)=>{let{className:r,variant:a,size:s,...c}=e;return(0,n.jsx)("button",{className:(0,i.cn)(o({variant:a,size:s,className:r})),ref:t,...c})});c.displayName="Button"},1966:function(e,t,r){"use strict";r.d(t,{cn:function(){return s}});var n=r(512),a=r(8388);function s(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,a.m6)((0,n.W)(t))}},8704:function(e,t,r){"use strict";r.d(t,{$D:function(){return i},GY:function(){return n},eR:function(){return l},k1:function(){return o},pb:function(){return c}});class n extends Error{constructor(e,t,r){super(e),this.name="ApiClientError",this.code=t,this.status=r}}async function a(e){try{return await e.json()}catch(e){return{}}}async function s(e,t){let r=await fetch(e,t),s=await a(r);if(!r.ok)throw new n((null==s?void 0:s.message)||(null==s?void 0:s.error)||"Request failed (".concat(r.status,")"),(null==s?void 0:s.error)||"request_failed",r.status);return s}function i(e){return e instanceof n?"invalid_auth"===e.code?"Authentication token is invalid or expired. Sign in again and retry.":401===e.status?"Sign-in expired. Please sign in again.":403===e.status?"You do not have access to this plot.":408===e.status?"Request timed out. Retry in a few seconds.":413===e.status||"plot_payload_too_large"===e.code?"Plot snapshot is too large to save. Re-run analysis and retry.":"invalid_geometry"===e.code?"Selected area geometry is invalid. Redraw the AOI and retry.":"invalid_payload"===e.code?"Plot payload contains unsupported values.":503===e.status||"firebase_admin_misconfigured"===e.code?"Server save service is misconfigured. Check Firebase Admin credentials.":"validation_failed"===e.code?"Some required fields are missing.":e.message||"Save failed. Please retry.":"Network issue. Check connection and retry."}async function o(e){let t=await s("/api/items",{method:"GET",headers:{Authorization:"Bearer ".concat(e)}});return Array.isArray(t.items)?t.items:[]}async function c(e,t){return await s("/api/items",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify(t)})}async function l(e,t){await s("/api/plots/".concat(t),{method:"DELETE",headers:{Authorization:"Bearer ".concat(e)}})}},2355:function(e,t,r){"use strict";r.d(t,{q:function(){return a},x:function(){return s}});var n=r(2370);async function a(e){if(e.currentUser)return e.currentUser;let t=new n.hJ;t.setCustomParameters({prompt:"select_account"}),await (0,n.Fb)(e,n.a$).catch(()=>{});try{return(await (0,n.rh)(e,t)).user}catch(a){var r;if("auth/popup-blocked"===(r=String((null==a?void 0:a.code)||""))||"auth/popup-closed-by-user"===r||"auth/cancelled-popup-request"===r||"auth/operation-not-supported-in-this-environment"===r)return await (0,n.F6)(e,t),null;throw a}}function s(e){let t=String((null==e?void 0:e.code)||"");return"auth/unauthorized-domain"===t?"Google sign-in failed: add this app domain to Firebase Auth Authorized domains.":"auth/configuration-not-found"===t?"Google sign-in failed: enable Google provider in Firebase Auth.":"auth/operation-not-allowed"===t?"Google sign-in failed: Google provider is disabled in Firebase Auth.":"auth/network-request-failed"===t?"Google sign-in failed due to a network error. Try again.":(null==e?void 0:e.message)||"Google sign-in failed."}},6394:function(e,t,r){"use strict";r.d(t,{I8:function(){return l},oy:function(){return d}});var n=r(3977),a=r(2370);let s={apiKey:"AIzaSyBkGPzwLd_hQj-yPB7mxNijPW89iDXym2A",authDomain:"brightbite-81e92.firebaseapp.com",projectId:"brightbite-81e92",storageBucket:"brightbite-81e92.firebasestorage.app",messagingSenderId:"273197668689",appId:"1:273197668689:web:fc5eee2714d4bb89365b70"},i=Object.values(s).every(e=>"string"==typeof e&&e.length>0);function o(){return i?(0,n.C6)().length?(0,n.Mq)():(0,n.ZF)(s):null}let c=null;o();let l=function(){if(!i)return null;if(c)return c;let e=o();return e?c=(0,a.v0)(e):null}(),d=i},1854:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return f}});var n=r(5893),a=r(7294),s=r(1664),i=r.n(s),o=r(2370),c=r(6316);let l=(0,r(1373).Z)("circle-user-round",[["path",{d:"M18 20a6 6 0 0 0-12 0",key:"1qehca"}],["circle",{cx:"12",cy:"10",r:"4",key:"1h16sb"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);var d=r(3945),u=r(7497),h=r(6394),m=r(2355),x=r(8704),p=r(4712);function f(){let e=h.oy,[t,r]=(0,a.useState)(null),[s,f]=(0,a.useState)(0),[g,b]=(0,a.useState)(!0);async function y(){if(e&&h.I8)try{await (0,m.q)(h.I8)}catch(e){p.toast.error((0,m.x)(e))}}async function v(){e&&h.I8&&(await (0,o.w7)(h.I8),f(0))}return(0,a.useEffect)(()=>{if(!e||!h.I8){b(!1);return}return(0,o.Aj)(h.I8,async e=>{if(r(e),!e){f(0),b(!1);return}try{let t;let r=await e.getIdToken(!0);try{t=await (0,x.k1)(r)}catch(r){if(r instanceof x.GY&&401===r.status){let r=await e.getIdToken(!0);t=await (0,x.k1)(r)}else throw r}f(t.length)}catch(e){if(e instanceof x.GY&&401===e.status){p.toast.error("Session expired. Sign in again to load account data.");return}p.toast.error((0,x.$D)(e))}finally{b(!1)}})},[e]),(0,n.jsxs)("div",{className:"min-h-screen",children:[(0,n.jsx)(d.Z,{}),(0,n.jsx)("main",{className:"app-shell py-6",children:(0,n.jsxs)("section",{className:"surface-card p-5",children:[(0,n.jsx)("h1",{className:"text-2xl font-semibold text-zinc-900",children:"Account"}),(0,n.jsx)("p",{className:"mt-1 text-sm text-zinc-600",children:"Identity, ownership, and persistence status."}),!e&&(0,n.jsx)("div",{className:"mt-4 rounded-xl border border-zinc-200 bg-zinc-50 p-4 text-sm text-zinc-600",children:"Firebase Auth is not configured. Add `NEXT_PUBLIC_FIREBASE_*` and `FIREBASE_SERVICE_ACCOUNT_JSON` in Vercel."}),e&&g&&(0,n.jsxs)("div",{className:"mt-4 inline-flex items-center gap-2 rounded-xl border border-zinc-200 bg-zinc-50 px-4 py-3 text-sm text-zinc-600",children:[(0,n.jsx)(c.Z,{className:"h-4 w-4 animate-spin"}),"Loading account"]}),e&&!g&&!t&&(0,n.jsxs)("div",{className:"mt-4 rounded-xl border border-zinc-200 bg-zinc-50 p-4",children:[(0,n.jsx)("p",{className:"text-sm text-zinc-600",children:"Sign in to save plots and access your analysis history."}),(0,n.jsx)(u.z,{className:"mt-3",onClick:y,children:"Sign in with Google"})]}),e&&t&&!g&&(0,n.jsxs)("div",{className:"mt-4 grid gap-4 md:grid-cols-2",children:[(0,n.jsxs)("article",{className:"rounded-2xl border border-zinc-200 bg-white p-4",children:[(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)(l,{className:"h-10 w-10 text-emerald-800"}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-sm font-semibold text-zinc-900",children:t.displayName||t.email||"AgriSense User"}),(0,n.jsx)("p",{className:"text-xs text-zinc-500",children:t.email||"No email available"})]})]}),(0,n.jsxs)("p",{className:"mt-3 text-xs text-zinc-500",children:["UID: ",t.uid]}),(0,n.jsx)(u.z,{className:"mt-3",variant:"outline",onClick:v,children:"Sign out"})]}),(0,n.jsxs)("article",{className:"rounded-2xl border border-zinc-200 bg-white p-4",children:[(0,n.jsx)("p",{className:"text-xs uppercase tracking-wide text-zinc-500",children:"Saved plots"}),(0,n.jsx)("p",{className:"mt-2 text-3xl font-semibold text-zinc-900",children:s}),(0,n.jsx)("p",{className:"mt-1 text-sm text-zinc-600",children:"All saved plots are scoped to your authenticated account."}),(0,n.jsx)(i(),{href:"/plots",className:"mt-3 inline-block",children:(0,n.jsx)(u.z,{children:"Open plot library"})})]})]})]})})]})}}},function(e){e.O(0,[551,23,712,500,888,774,179],function(){return e(e.s=682)}),_N_E=e.O()}]);