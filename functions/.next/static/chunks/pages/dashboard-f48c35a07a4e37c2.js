(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[26],{116:function(e,i,t){"use strict";t.d(i,{Z:function(){return l}});let l=(0,t(1373).Z)("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},528:function(e,i,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard",function(){return t(535)}])},2355:function(e,i,t){"use strict";t.d(i,{q:function(){return n},x:function(){return a}});var l=t(2370);async function n(e){if(e.currentUser)return e.currentUser;let i=new l.hJ;i.setCustomParameters({prompt:"select_account"}),await (0,l.Fb)(e,l.a$).catch(()=>{});try{return(await (0,l.rh)(e,i)).user}catch(n){var t;if("auth/popup-blocked"===(t=String((null==n?void 0:n.code)||""))||"auth/popup-closed-by-user"===t||"auth/cancelled-popup-request"===t||"auth/operation-not-supported-in-this-environment"===t)return await (0,l.F6)(e,i),null;throw n}}function a(e){let i=String((null==e?void 0:e.code)||"");return"auth/unauthorized-domain"===i?"Google sign-in failed: add this app domain to Firebase Auth Authorized domains.":"auth/configuration-not-found"===i?"Google sign-in failed: enable Google provider in Firebase Auth.":"auth/operation-not-allowed"===i?"Google sign-in failed: Google provider is disabled in Firebase Auth.":"auth/network-request-failed"===i?"Google sign-in failed due to a network error. Try again.":(null==e?void 0:e.message)||"Google sign-in failed."}},8625:function(e,i,t){"use strict";t.d(i,{a8:function(){return n},dL:function(){return a}});var l=t(6506);function n(e){let{metric:i,grid:t,outputWidth:n=t.width,outputHeight:a=t.height,contours:r=!1}=e;if("undefined"==typeof document)throw Error("metric_canvas_requires_dom");if(!t||!t.width||!t.height||!t.values||t.values.length<t.width*t.height)throw Error("metric_grid_missing");let{min:s,max:o,range:d}=function(e,i,t){let l=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY;for(let i=0;i<e.length;i++){let t=Number(e[i]);Number.isFinite(t)&&(t<l&&(l=t),t>n&&(n=t))}let a=Number.isFinite(i)&&Number.isFinite(t)&&Number(t)>Number(i),r=a?Number(i):l,s=a?Number(t):n;return Number.isFinite(r)&&Number.isFinite(s)&&!(s<=r)||(r=0,s=1),{min:r,max:s,range:Math.max(1e-6,s-r)}}(t.values,t.min,t.max),c=Math.max(1,Math.floor(n)),u=Math.max(1,Math.floor(a)),m=document.createElement("canvas");m.width=c,m.height=u;let v=m.getContext("2d");if(!v)throw Error("metric_canvas_context_failed");let x=v.createImageData(c,u),h=x.data;for(let e=0;e<u;e++)for(let n=0;n<c;n++){let a=4*(e*c+n),o=n/Math.max(1,c-1)*(t.width-1),m=e/Math.max(1,u-1)*(t.height-1),v=function(e,i,t,n,a){let r=(0,l.uZ)(n,0,i-1),s=(0,l.uZ)(a,0,t-1),o=Math.floor(r),d=Math.floor(s),c=Math.min(i-1,o+1),u=Math.min(t-1,d+1),m=r-o,v=(0,l.t7)(Number(e[d*i+o]||0),Number(e[d*i+c]||0),m),x=(0,l.t7)(Number(e[u*i+o]||0),Number(e[u*i+c]||0),m);return(0,l.t7)(v,x,s-d)}(t.values,t.width,t.height,o,m),x=(0,l.uZ)((v-s)/d,0,1),[p,b,g]=(0,l.TU)(i,x),f=p,y=b,N=g;if(r){let e=16*x,i=Math.abs(e-Math.round(e));if(i<.014){let e=i<.006?.22:.12;f=Math.round((0,l.t7)(f,26,e)),y=Math.round((0,l.t7)(y,40,e)),N=Math.round((0,l.t7)(N,64,e))}}h[a]=f,h[a+1]=y,h[a+2]=N,h[a+3]=255}return v.putImageData(x,0,0),{canvas:m,range:{min:s,max:o}}}function a(e){return e.toDataURL("image/png").replace(/^data:image\/png;base64,/,"")}},6506:function(e,i,t){"use strict";t.d(i,{CS:function(){return l},G5:function(){return s},TU:function(){return r},t7:function(){return a},uZ:function(){return n}});let l={ndvi:[{stop:0,color:[93,123,223]},{stop:.16,color:[110,177,236]},{stop:.32,color:[106,219,226]},{stop:.5,color:[129,216,156]},{stop:.68,color:[232,220,124]},{stop:.84,color:[242,176,114]},{stop:1,color:[226,126,134]}],soil:[{stop:0,color:[106,128,214]},{stop:.2,color:[122,182,232]},{stop:.4,color:[121,219,196]},{stop:.58,color:[152,214,149]},{stop:.76,color:[236,204,126]},{stop:1,color:[214,139,102]}],et:[{stop:0,color:[98,120,218]},{stop:.2,color:[109,165,232]},{stop:.4,color:[114,217,223]},{stop:.6,color:[146,214,149]},{stop:.78,color:[241,197,116]},{stop:1,color:[226,126,110]}]};function n(e,i,t){return Math.max(i,Math.min(t,e))}function a(e,i,t){return e+(i-e)*t}function r(e,i){let t=l[e],a=n(i,0,1);for(let e=0;e<t.length-1;e++){let i=t[e],l=t[e+1];if(a<=l.stop){var r,s,o;let e=(a-i.stop)/Math.max(1e-6,l.stop-i.stop);return[Math.round((r=i.color[0])+(l.color[0]-r)*e),Math.round((s=i.color[1])+(l.color[1]-s)*e),Math.round((o=i.color[2])+(l.color[2]-o)*e)]}}return t[t.length-1].color}function s(e){return"linear-gradient(90deg, ".concat(l[e].map(e=>"rgb(".concat(e.color[0],", ").concat(e.color[1],", ").concat(e.color[2],") ").concat(Math.round(100*e.stop),"%")).join(", "),")")}},535:function(e,i,t){"use strict";t.r(i),t.d(i,{default:function(){return U}});var l=t(5893),n=t(7294),a=t(5152),r=t.n(a),s=t(6316),o=t(1373);let d=(0,o.Z)("activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]),c=(0,o.Z)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]),u=(0,o.Z)("database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]),m=(0,o.Z)("shield-check",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);var v=t(116);let x=(0,o.Z)("leaf",[["path",{d:"M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z",key:"nnexq3"}],["path",{d:"M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12",key:"mt58a7"}]]),h=(0,o.Z)("droplets",[["path",{d:"M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z",key:"1ptgy4"}],["path",{d:"M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97",key:"1sl1rz"}]]),p=(0,o.Z)("waves",[["path",{d:"M2 6c.6.5 1.2 1 2.5 1C7 7 7 5 9.5 5c2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1",key:"knzxuh"}],["path",{d:"M2 12c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1",key:"2jd2cc"}],["path",{d:"M2 18c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1",key:"rd2r6e"}]]),b=(0,o.Z)("cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]);var g=t(4093),f=t(4712),y=t(3945);let N=(0,o.Z)("message-circle",[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]]),j=(0,o.Z)("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);function w(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,t=Number(e);return Number.isFinite(t)?t:i}function z(e){return e&&"object"==typeof e?{min:w(e.min),max:w(e.max),mean:w(e.mean)}:null}function S(e){let{context:i,objective:t="balanced"}=e,[a,r]=(0,n.useState)(!1),[o,d]=(0,n.useState)(""),[c,u]=(0,n.useState)([]),[m,x]=(0,n.useState)("idle"),[h,p]=(0,n.useState)("unavailable"),[b,g]=(0,n.useState)(null),[f,y]=(0,n.useState)({model:null,retries:0,degraded:!1,attempted:[]}),S=(0,n.useRef)(null),k=(0,n.useMemo)(()=>!!((null==i?void 0:i.ndviStats)||(null==i?void 0:i.weather)||(null==i?void 0:i.timeSeries)),[i]);async function M(e,l){let n=(e||o).trim();if(n){u(e=>[...e,{role:"user",text:n}]),e||d(""),x("loading");try{let e=function(e){var i,t,l,n,a,r,s,o,d,c,u,m,v,x,h,p,b,g,f,y,N,j,S,k,M,A,I,C,F,T,D,P,E,O,G,_,R,V,L,Z;let W=e||{};return{ndviStats:z(W.ndviStats),soilStats:z(W.soilStats),etStats:z(W.etStats),weather:{source:(null==W?void 0:null===(i=W.weather)||void 0===i?void 0:i.source)||(null==W?void 0:null===(l=W.weather)||void 0===l?void 0:null===(t=l.data)||void 0===t?void 0:t.source)||void 0,isSimulated:!!(null==W?void 0:null===(n=W.weather)||void 0===n?void 0:n.isSimulated),current:{temperature:w(null!==(R=null==W?void 0:null===(s=W.weather)||void 0===s?void 0:null===(r=s.data)||void 0===r?void 0:null===(a=r.current)||void 0===a?void 0:a.temperature)&&void 0!==R?R:null==W?void 0:null===(d=W.weather)||void 0===d?void 0:null===(o=d.current)||void 0===o?void 0:o.temperature),humidity:w(null!==(V=null==W?void 0:null===(m=W.weather)||void 0===m?void 0:null===(u=m.data)||void 0===u?void 0:null===(c=u.current)||void 0===c?void 0:c.humidity)&&void 0!==V?V:null==W?void 0:null===(x=W.weather)||void 0===x?void 0:null===(v=x.current)||void 0===v?void 0:v.humidity),precipitation:w(null!==(L=null==W?void 0:null===(b=W.weather)||void 0===b?void 0:null===(p=b.data)||void 0===p?void 0:null===(h=p.current)||void 0===h?void 0:h.precipitation)&&void 0!==L?L:null==W?void 0:null===(f=W.weather)||void 0===f?void 0:null===(g=f.current)||void 0===g?void 0:g.precipitation),windSpeed:w(null!==(Z=null==W?void 0:null===(j=W.weather)||void 0===j?void 0:null===(N=j.data)||void 0===N?void 0:null===(y=N.current)||void 0===y?void 0:y.windSpeed)&&void 0!==Z?Z:null==W?void 0:null===(k=W.weather)||void 0===k?void 0:null===(S=k.current)||void 0===S?void 0:S.windSpeed)}},timeSeries:{source:(null==W?void 0:null===(M=W.timeSeries)||void 0===M?void 0:M.source)||(null==W?void 0:null===(I=W.timeSeries)||void 0===I?void 0:null===(A=I.data)||void 0===A?void 0:A.source)||void 0,isSimulated:!!(null==W?void 0:null===(C=W.timeSeries)||void 0===C?void 0:C.isSimulated),summary:(null==W?void 0:null===(T=W.timeSeries)||void 0===T?void 0:null===(F=T.data)||void 0===F?void 0:F.summary)||(null==W?void 0:null===(D=W.timeSeries)||void 0===D?void 0:D.summary)||null},inference:{confidence:w(null==W?void 0:null===(P=W.inference)||void 0===P?void 0:P.confidence),anomalyLevel:(null==W?void 0:null===(O=W.inference)||void 0===O?void 0:null===(E=O.anomaly)||void 0===E?void 0:E.level)||null,trend:(null==W?void 0:null===(_=W.inference)||void 0===_?void 0:null===(G=_.forecast)||void 0===G?void 0:G.trend)||null},grid3x3:Array.isArray(null==W?void 0:W.grid3x3)?W.grid3x3.slice(0,9):[],selectedCell:"string"==typeof(null==W?void 0:W.selectedCell)?W.selectedCell:null,warnings:Array.isArray(null==W?void 0:W.warnings)?W.warnings.slice(0,8):[],providersTried:Array.isArray(null==W?void 0:W.providersTried)?W.providersTried.slice(0,8).map(e=>({provider:null==e?void 0:e.provider,ok:!!(null==e?void 0:e.ok),reason:(null==e?void 0:e.reason)||void 0})):[]}}(i),a={prompt:n,context:e,objective:t,analysisType:"chat",mode:l,history:c.slice(-8).map(e=>({role:e.role,text:e.text}))};JSON.stringify(a).length>12e4&&(a={...a,context:{...e,providersTried:[],warnings:[]}});let r=await fetch("/api/gemini",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),s=await r.json().catch(()=>({}));if(!r.ok){let e=String((null==s?void 0:s.error)||r.statusText||"analysis_failed"),i=(null==s?void 0:s.message)||"Analysis unavailable right now.";x(e.includes("provider")?"provider-outage":"partial-data"),u(e=>[...e,{role:"assistant",text:i}]);return}let o=function(e){let i=String(e||"").trim();if(!i)return"";let t=i.match(/```(?:json)?\s*([\s\S]*?)```/i);(null==t?void 0:t[1])&&(i=t[1].trim());try{let e=JSON.parse(i);if("string"==typeof e)return e.trim();if(e&&"object"==typeof e){let i=e.answer||e.response||e.text;if("string"==typeof i&&i.trim())return i.trim()}}catch(t){let e=i.match(/"answer"\s*:\s*"([\s\S]*?)"/i);(null==e?void 0:e[1])&&(i=e[1].replace(/\\n/g,"\n").trim())}return i.replace(/^["'`{[]+/,"").replace(/["'`\]}]+$/,"").trim()}((null==s?void 0:s.answer)||(null==s?void 0:s.suggestion)||(null==s?void 0:s.output))||"No recommendation generated.",d=(null==s?void 0:s.assistantBackend)==="llm-gemini"?"llm-gemini":"unavailable",m=!!(null==s?void 0:s.unavailable)||"unavailable"===d;p(d);let v=Array.isArray(null==s?void 0:s.warnings)&&s.warnings.length>0?String(s.warnings[0]):null;g(v),y({model:"string"==typeof(null==s?void 0:s.llmFinalModel)?s.llmFinalModel:null,retries:Number((null==s?void 0:s.llmRetries)||0),degraded:!!(null==s?void 0:s.llmDegraded),attempted:Array.isArray(null==s?void 0:s.llmAttemptedModels)?s.llmAttemptedModels.slice(0,4):[]});let h={sections:(null==s?void 0:s.sections)||void 0,evidence:Array.isArray(null==s?void 0:s.evidence)?s.evidence.slice(0,5):[],tasks:Array.isArray(null==s?void 0:s.tasks)?s.tasks.slice(0,4):[],renderModel:null==s?void 0:s.renderModel},b=!!(null==s?void 0:s.isSimulatedInputs);x(m?"unavailable":b?"partial-data":"idle"),u(e=>[...e,{role:"assistant",text:o,detail:h}])}catch(e){p("unavailable"),g("network_unreachable"),x("unavailable"),u(e=>[...e,{role:"assistant",text:"Gemini could not be reached right now. Retry in a few seconds."}])}}}return(0,n.useEffect)(()=>{var e;null===(e=S.current)||void 0===e||e.scrollTo({top:1e7,behavior:"smooth"})},[c,m]),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("button",{onClick:()=>r(e=>!e),className:"fixed bottom-5 right-5 z-50 flex h-14 w-14 items-center justify-center rounded-2xl border border-zinc-700/20 bg-zinc-950 text-zinc-50 shadow-lg shadow-black/25","aria-label":"Open AI Assistant",children:(0,l.jsx)(N,{className:"h-6 w-6"})}),a&&(0,l.jsxs)("section",{className:"liquid-glass fixed bottom-24 right-5 z-50 w-[min(96vw,25rem)] overflow-hidden rounded-2xl border border-zinc-200 bg-white shadow-2xl shadow-black/15",children:[(0,l.jsxs)("header",{className:"border-b border-zinc-200 bg-zinc-950 px-4 py-3 text-zinc-50",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-sm font-semibold tracking-wide",children:"AI Assistant"}),(0,l.jsx)("p",{className:"text-xs text-zinc-300",children:"Question-first agronomy guidance"})]}),(0,l.jsxs)("div",{className:"flex items-center gap-1",children:[(0,l.jsx)("span",{className:"rounded-full border border-zinc-600 px-2 py-0.5 text-[11px]",children:"llm-gemini"===h?"Gemini online":"Gemini unavailable"}),(0,l.jsx)("span",{className:"rounded-full border border-zinc-600 px-2 py-0.5 text-[11px]",children:"loading"===m?"Analyzing":"partial-data"===m?"Partial data":"provider-outage"===m?"Provider outage":"unavailable"===m?"Gemini unavailable":"offline"===m?"Offline fallback":"Ready"})]})]}),(0,l.jsxs)("p",{className:"mt-2 text-[11px] text-zinc-300",children:[f.model?"Model: ".concat(f.model):"Model: n/a",f.attempted.length>0?" | attempted: ".concat(f.attempted.join(", ")):"",f.retries>0?" | retries ".concat(f.retries):"",f.degraded?" | degraded":""]}),b&&"llm-gemini"!==h&&(0,l.jsxs)("p",{className:"mt-1 text-[11px] text-amber-300",children:["Reason: ",b]})]}),(0,l.jsxs)("div",{ref:S,className:"max-h-80 space-y-3 overflow-auto bg-zinc-50 px-4 py-4 text-sm",children:[!c.length&&(0,l.jsx)("div",{className:"rounded-xl border border-dashed border-zinc-300 bg-white p-3 text-zinc-600",children:k?"Ask direct questions like: Why is P5 stressed? What should I do tomorrow?":"Run an analysis first to provide data-aware recommendations."}),(0,l.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,l.jsx)("button",{onClick:()=>void M("Why is this selected plot point stressed right now?","stress-debug"),className:"rounded-full border border-zinc-300 bg-white px-2 py-1 text-[11px] text-zinc-700 hover:bg-zinc-100",children:"Explain anomaly"}),(0,l.jsx)("button",{onClick:()=>void M("Give me a water-saving plan for tomorrow.","irrigation-plan"),className:"rounded-full border border-zinc-300 bg-white px-2 py-1 text-[11px] text-zinc-700 hover:bg-zinc-100",children:"Water-saving plan"}),(0,l.jsx)("button",{onClick:()=>void M("What should I do next to protect yield?","next-actions"),className:"rounded-full border border-zinc-300 bg-white px-2 py-1 text-[11px] text-zinc-700 hover:bg-zinc-100",children:"Yield-priority plan"}),(0,l.jsx)("button",{onClick:()=>void M("Run through a what-if setup for irrigation and risk.","what-if-explainer"),className:"rounded-full border border-zinc-300 bg-white px-2 py-1 text-[11px] text-zinc-700 hover:bg-zinc-100",children:"Run what-if"})]}),c.map((e,i)=>{var t,n,a,r,s,o;let d="assistant"===e.role?function(e){var i,t;let l=[...Array.isArray(null==e?void 0:null===(i=e.sections)||void 0===i?void 0:i.actions)&&(null==e?void 0:null===(t=e.sections)||void 0===t?void 0:t.actions)||[],...Array.isArray(null==e?void 0:e.tasks)?e.tasks.map(e=>"string"==typeof e?e:(null==e?void 0:e.title)||"").filter(Boolean):[]],n=new Set,a=[];for(let e of l){let i=e.trim().toLowerCase();if(!(!i||n.has(i))&&(n.add(i),a.push(e.trim()),a.length>=4))break}return a}(e.detail):[],c="assistant"===e.role&&Array.isArray(null===(t=e.detail)||void 0===t?void 0:t.evidence)&&(null===(n=e.detail)||void 0===n?void 0:n.evidence)||[];return(0,l.jsxs)("div",{className:"user"===e.role?"ml-auto w-fit max-w-[85%] rounded-2xl rounded-br-sm bg-emerald-900 px-3 py-2 text-emerald-50":"w-fit max-w-[92%] rounded-2xl rounded-bl-sm border border-zinc-200 bg-white px-3 py-2 text-zinc-800",children:[(0,l.jsx)("p",{className:"assistant"===e.role?"whitespace-pre-wrap":"",children:e.text}),"assistant"===e.role&&(null===(r=e.detail)||void 0===r?void 0:null===(a=r.sections)||void 0===a?void 0:a.rationale)&&(0,l.jsxs)("p",{className:"mt-2 text-xs text-zinc-600",children:[(0,l.jsx)("span",{className:"font-semibold text-zinc-700",children:"Why:"})," ",e.detail.sections.rationale]}),"assistant"===e.role&&(null===(o=e.detail)||void 0===o?void 0:null===(s=o.sections)||void 0===s?void 0:s.forecast)&&(0,l.jsxs)("p",{className:"mt-2 text-xs text-zinc-600",children:[(0,l.jsx)("span",{className:"font-semibold text-zinc-700",children:"Forecast:"})," ",e.detail.sections.forecast]}),"assistant"===e.role&&d.length>0&&(0,l.jsxs)("div",{className:"mt-2",children:[(0,l.jsx)("p",{className:"text-xs font-semibold text-zinc-700",children:"Suggested actions"}),(0,l.jsx)("ul",{className:"mt-1 list-disc space-y-0.5 pl-4 text-xs text-zinc-600",children:d.map((e,i)=>(0,l.jsx)("li",{children:e},"".concat(i,"-").concat(e)))})]}),"assistant"===e.role&&c.length>0&&(0,l.jsxs)("div",{className:"mt-2",children:[(0,l.jsx)("p",{className:"text-xs font-semibold text-zinc-700",children:"Evidence"}),(0,l.jsx)("ul",{className:"mt-1 list-disc space-y-0.5 pl-4 text-xs text-zinc-600",children:c.map((e,i)=>(0,l.jsx)("li",{children:e},"".concat(i,"-").concat(e)))})]})]},"".concat(e.role,"-").concat(i))}),"loading"===m&&(0,l.jsxs)("div",{className:"inline-flex items-center gap-2 rounded-xl border border-zinc-200 bg-white px-3 py-2 text-zinc-600",children:[(0,l.jsx)(s.Z,{className:"h-4 w-4 animate-spin"}),"Building recommendation"]}),("partial-data"===m||"provider-outage"===m)&&(0,l.jsxs)("div",{className:"inline-flex items-center gap-2 rounded-xl border border-amber-200 bg-amber-50 px-3 py-2 text-amber-800",children:[(0,l.jsx)(v.Z,{className:"h-4 w-4"}),"Some providers are degraded. Guidance is conservative."]}),"unavailable"===m&&(0,l.jsxs)("div",{className:"inline-flex items-center gap-2 rounded-xl border border-rose-200 bg-rose-50 px-3 py-2 text-rose-800",children:[(0,l.jsx)(v.Z,{className:"h-4 w-4"}),"Gemini unavailable right now. Retry in a few seconds."]})]}),(0,l.jsx)("footer",{className:"border-t border-zinc-200 bg-white p-3",children:(0,l.jsxs)("div",{className:"flex items-end gap-2",children:[(0,l.jsx)("textarea",{value:o,onChange:e=>d(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),M())},rows:2,placeholder:"Ask a direct field question...",className:"min-h-[2.5rem] flex-1 resize-none rounded-xl border border-zinc-300 px-3 py-2 text-sm outline-none transition focus:border-emerald-700 focus:ring-2 focus:ring-emerald-200"}),(0,l.jsx)("button",{onClick:()=>void M(),disabled:"loading"===m||!o.trim(),className:"inline-flex h-10 w-10 items-center justify-center rounded-xl bg-emerald-900 text-emerald-50 disabled:cursor-not-allowed disabled:bg-zinc-300","aria-label":"Send",children:(0,l.jsx)(j,{className:"h-4 w-4"})})]})})]})]})}var k=t(5133);function M(e){let i=3*e.row+e.col+1;return"P".concat(i)}function A(e){let{cells:i,selectedCell:t,onSelectCell:n,visible:a=!0,frame:r}=e;if(!a)return null;let s=function(e){if(Array.isArray(e)&&e.length)return e;let i=[];for(let e=0;e<3;e++)for(let t=0;t<3;t++)i.push({cellId:"".concat(e,"-").concat(t),row:e,col:t,mean:0,min:0,max:0,validPixelRatio:0,stressLevel:"unknown"});return i}(i);return(0,l.jsx)("div",{className:"pointer-events-none absolute grid grid-cols-3 grid-rows-3 overflow-hidden",style:r?{left:Math.max(0,Math.round(r.left)),top:Math.max(0,Math.round(r.top)),width:Math.max(1,Math.floor(r.width)),height:Math.max(1,Math.floor(r.height)),boxSizing:"border-box"}:{inset:0},children:s.map(e=>{var i;let a=t===e.cellId,r=(i=e.stressLevel,a?"#22d3ee":"high"===i?"#dc2626":"moderate"===i?"#d97706":"low"===i?"#15803d":"#64748b");return(0,l.jsx)("button",{type:"button",onClick:()=>null==n?void 0:n(e.cellId),className:"pointer-events-auto relative border transition-colors",style:{borderColor:a?"#67e8f9":"".concat(r),borderWidth:a?2:1,backgroundColor:a?"".concat(r,"3b"):"".concat(r,"14"),boxShadow:a?"inset 0 0 0 1px rgba(254,240,138,0.92)":"inset 0 0 0 1px rgba(226,232,240,0.18)"},"aria-label":"Select plot point ".concat(M(e)),children:(0,l.jsx)("span",{className:"absolute left-1 top-1 rounded bg-black/55 px-1.5 py-0.5 text-[10px] text-white",children:M(e)})},"grid-image-".concat(e.cellId))})})}var I=t(7497),C=t(2003),F=t(1966);let T=(0,C.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:opacity-90",secondary:"border-transparent bg-secondary text-secondary-foreground",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function D(e){let{className:i,variant:t,...n}=e;return(0,l.jsx)("div",{className:(0,F.cn)(T({variant:t}),i),...n})}var P=t(6394),E=t(2355),O=t(8704),G=t(8625);let _=r()(()=>Promise.all([t.e(269),t.e(165),t.e(99)]).then(t.bind(t,4246)),{loadableGenerated:{webpack:()=>[4246]},ssr:!1}),R=r()(()=>Promise.all([t.e(934),t.e(737),t.e(365),t.e(808)]).then(t.bind(t,7808)),{loadableGenerated:{webpack:()=>[7808]},ssr:!1});function V(e){let i=e.split(",").map(e=>Number(e.trim()));return 4!==i.length||i.some(e=>Number.isNaN(e))?null:i}function L(e){var i,t,l;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{min:0,max:0,mean:0};return{min:Number(null!==(i=null==e?void 0:e.min)&&void 0!==i?i:n.min),max:Number(null!==(t=null==e?void 0:e.max)&&void 0!==t?t:n.max),mean:Number(null!==(l=null==e?void 0:e.mean)&&void 0!==l?l:n.mean)}}function Z(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,t=Number(e);return Number.isFinite(t)?t:i}function W(e){return e?{source:(null==e?void 0:e.source)||null,isSimulated:!!(null==e?void 0:e.isSimulated),stats:L(null==e?void 0:e.stats)}:null}function Y(e){let{label:i,isSimulated:t}=e;return(0,l.jsx)("span",{className:t?"status-chip border-amber-300 bg-amber-50 text-amber-800":"status-chip border-emerald-300 bg-emerald-50 text-emerald-800",children:i})}function U(){var e,i,t,a,r,o,N,j,w,z,M,C,F,T,U,q,H,J,B,Q,$,K,X,ee,ei,et,el,en,ea,er,es,eo,ed,ec,eu,em,ev,ex,eh,ep,eb;let eg=P.oy,[ef,ey]=(0,n.useState)("Edison, New Jersey"),[eN,ej]=(0,n.useState)([]),[ew,ez]=(0,n.useState)("-74.49,40.45,-74.33,40.59"),[eS,ek]=(0,n.useState)([]),[eM,eA]=(0,n.useState)("2025-12-01/2026-01-30"),[eI,eC]=(0,n.useState)("balanced"),[eF,eT]=(0,n.useState)("ndvi"),[eD,eP]=(0,n.useState)(!1),[eE,eO]=(0,n.useState)(!1),[eG,e_]=(0,n.useState)(!1),[eR,eV]=(0,n.useState)(!0),[eL,eZ]=(0,n.useState)(null),[eW,eY]=(0,n.useState)(!1),eU=(0,n.useRef)(null),eq=(0,n.useRef)(null),[eH,eJ]=(0,n.useState)(null),[eB,eQ]=(0,n.useState)(null),[e$,eK]=(0,n.useState)(null),[eX,e0]=(0,n.useState)(null),[e1,e2]=(0,n.useState)(null),[e3,e5]=(0,n.useState)(null),[e4,e6]=(0,n.useState)(null),[e9,e7]=(0,n.useState)(!1),[e8,ie]=(0,n.useState)({irrigationDelta:0,waterBudget:.5,targetRisk:.35,fertilizerDelta:0}),[ii,it]=(0,n.useState)(null),[il,ia]=(0,n.useState)([]),[ir,is]=(0,n.useState)([]),[io,id]=(0,n.useState)({criticalNdvi:.28,warningNdvi:.42,highAnomaly:.66}),ic=(0,n.useMemo)(()=>{var e;return L(null==eB?void 0:null===(e=eB.ndvi)||void 0===e?void 0:e.stats)},[eB]),iu=(0,n.useMemo)(()=>L(null==eX?void 0:eX.stats),[eX]),im=(0,n.useMemo)(()=>L(null==e1?void 0:e1.stats),[e1]),iv=(null==eB?void 0:null===(e=eB.ndvi)||void 0===e?void 0:e.grid3x3)||[],ix=(0,n.useMemo)(()=>iv.find(e=>e.cellId===eL)||null,[iv,eL]),ih=(0,n.useMemo)(()=>ix?"P".concat(3*ix.row+ix.col+1):null,[ix]),ip="ndvi"===eF?null==eB?void 0:null===(i=eB.ndvi)||void 0===i?void 0:i.previewPng:"soil"===eF?null==eX?void 0:eX.overlayPng:null==e1?void 0:e1.overlayPng,ib=(0,n.useMemo)(()=>{var e;let i=null==eB?void 0:null===(e=eB.ndvi)||void 0===e?void 0:e.metricGrid;if(!(null==i?void 0:i.encoded)||!(null==i?void 0:i.width)||!(null==i?void 0:i.height))return null;let t=function(e,i,t){if(!e)return null;try{let l=window.atob(e),n=new Uint8Array(l.length);for(let e=0;e<l.length;e++)n[e]=l.charCodeAt(e);let a=i*t,r=new Float32Array(n.buffer,n.byteOffset,Math.min(a,Math.floor(n.byteLength/4))),s=Array(a).fill(0);for(let e=0;e<a;e++){let i=r[e];s[e]=Number.isFinite(i)?Number(i):0}return s}catch(e){return null}}(i.encoded,i.width,i.height);return t&&t.length?{values:t,width:i.width,height:i.height,min:Number.isFinite(i.min)?i.min:ic.min,max:Number.isFinite(i.max)?i.max:ic.max,source:(null==eB?void 0:eB.provider)||"NDVI",units:"NDVI",isSimulated:!1}:null},[null==eB?void 0:null===(a=eB.ndvi)||void 0===a?void 0:null===(t=a.metricGrid)||void 0===t?void 0:t.encoded,null==eB?void 0:null===(o=eB.ndvi)||void 0===o?void 0:null===(r=o.metricGrid)||void 0===r?void 0:r.width,null==eB?void 0:null===(j=eB.ndvi)||void 0===j?void 0:null===(N=j.metricGrid)||void 0===N?void 0:N.height,null==eB?void 0:null===(z=eB.ndvi)||void 0===z?void 0:null===(w=z.metricGrid)||void 0===w?void 0:w.min,null==eB?void 0:null===(C=eB.ndvi)||void 0===C?void 0:null===(M=C.metricGrid)||void 0===M?void 0:M.max,null==eB?void 0:eB.provider,ic.min,ic.max]),ig=(0,n.useMemo)(()=>"soil"===eF?(null==eX?void 0:eX.metricGrid)||null:"et"===eF?(null==e1?void 0:e1.metricGrid)||null:ib,[eF,ib,null==eX?void 0:eX.metricGrid,null==e1?void 0:e1.metricGrid]),iy=(0,n.useMemo)(()=>{if("undefined"==typeof document||!ig||!Array.isArray(ig.values)||ig.width<2||ig.height<2||ig.values.length<ig.width*ig.height)return null;try{let e=(0,G.a8)({metric:eF,grid:{values:ig.values,width:ig.width,height:ig.height,min:ig.min,max:ig.max},outputWidth:ig.width,outputHeight:ig.height,contours:!1});return(0,G.dL)(e.canvas)}catch(e){return null}},[eF,ig]),iN=iy||ip,ij=()=>{let e=eU.current,i=eq.current;if(!e||!i){eJ(null);return}let t=e.clientWidth,l=e.clientHeight,n=i.naturalWidth||0,a=i.naturalHeight||0;if(!t||!l||!n||!a){eJ(null);return}let r=Math.min(t/n,l/a),s=Math.max(1,Math.floor(n*r)),o=Math.max(1,Math.floor(a*r));eJ({left:Math.max(0,Math.round((t-s)/2)),top:Math.max(0,Math.round((l-o)/2)),width:s,height:o})};async function iw(){if(!eg||!P.I8)throw Error("Firebase Auth is not configured");try{return await (0,E.q)(P.I8)}catch(e){throw Error((0,E.x)(e))}}async function iz(){if(ef.trim()){eP(!0);try{let e=await fetch("/api/geocode?q=".concat(encodeURIComponent(ef.trim()))),i=await e.json().catch(()=>({}));if(!e.ok)throw Error((null==i?void 0:i.message)||(null==i?void 0:i.error)||"Geocoding failed");let t=Array.isArray(null==i?void 0:i.places)?i.places:[];ej(t),t.length||f.toast.warning("No matching places found.")}catch(e){f.toast.error((null==e?void 0:e.message)||"Geocoding failed")}finally{eP(!1)}}}function iS(e,i){var t,l;if(!e)return e;let n=e["soil"===i?"soilMoisture":"evapotranspiration"];if(!n||"string"!=typeof n)return e;if(n.startsWith("iVBOR"))return{...e,overlayPng:n};let a=function(e){try{return JSON.parse(window.atob(e))}catch(e){return null}}(n);if(!a||"undefined"==typeof document)return e;let r=Number(a.width||256),s=Number(a.height||256),o=Array.isArray(a.data)?a.data:[],d=Math.max(1,r*s),c=Array(d).fill(0);for(let e=0;e<d;e++){let i=Number(o[e]);c[e]=Number.isFinite(i)?i:0}let u=document.createElement("canvas");u.width=r,u.height=s;let m=u.getContext("2d");if(!m)return e;let v=m.createImageData(r,s),x=Number.POSITIVE_INFINITY,h=Number.NEGATIVE_INFINITY;for(let e of o){let i=Number(e);Number.isFinite(i)&&(x=Math.min(x,i),h=Math.max(h,i))}let p=h-x||1;for(let e=0;e<c.length;e++){let t=(Number(c[e])-x)/p,l=4*e;"soil"===i?(v.data[l]=Math.round(155-120*t),v.data[l+1]=Math.round(94+110*t),v.data[l+2]=Math.round(40+165*t)):(v.data[l]=Math.round(75+170*t),v.data[l+1]=Math.round(190-120*t),v.data[l+2]=Math.round(58+40*(1-t))),v.data[l+3]=255}m.putImageData(v,0,0);let b=u.toDataURL("image/png").replace("data:image/png;base64,","");return{...e,overlayPng:b,metricGrid:{values:c,width:r,height:s,min:Number.isFinite(Number(null==a?void 0:null===(t=a.stats)||void 0===t?void 0:t.min))?Number(a.stats.min):Number(x.toFixed(4)),max:Number.isFinite(Number(null==a?void 0:null===(l=a.stats)||void 0===l?void 0:l.max))?Number(a.stats.max):Number(h.toFixed(4)),source:String((null==e?void 0:e.source)||("soil"===i?"Soil moisture":"Evapotranspiration")),units:"soil"===i?"m3/m3":"mm/day",isSimulated:!!(null==e?void 0:e.isSimulated)}}}async function ik(){let e=V(ew);if(!e){f.toast.error("Bounding box must be in format minLon,minLat,maxLon,maxLat");return}eP(!0),ia([]),is([]),e6(null);try{var i,t,l,n,a,r,s,o,d,c,u,m,v,x,h,p,b,g,y,N,j,w,z,S,k,M,A,I,C,F,T,D,P,E,O,G;let _=await fetch("/api/ingest/fetch",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({bbox:e,date:eM,targetSize:512,policy:"balanced"})}),R=await _.json().catch(()=>({}));if(!_.ok||!(null==R?void 0:R.success))throw Error((null==R?void 0:R.message)||(null==R?void 0:R.error)||"Ingest failed");let V=R.data,L=(null==V?void 0:null===(t=V.ndvi)||void 0===t?void 0:null===(i=t.grid3x3)||void 0===i?void 0:i.some(e=>"1-1"===e.cellId))?"1-1":(null==V?void 0:null===(a=V.ndvi)||void 0===a?void 0:null===(n=a.grid3x3)||void 0===n?void 0:null===(l=n[0])||void 0===l?void 0:l.cellId)||null;eQ(V),eZ(L);let Z=Array.isArray(null==R?void 0:R.warnings)?R.warnings:[],[W,Y,U,q]=await Promise.allSettled([fetch("/api/weather",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({bbox:e})}).then(e=>e.json()),fetch("/api/soil",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({bbox:e})}).then(e=>e.json()),fetch("/api/et",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({bbox:e})}).then(e=>e.json()),fetch("/api/timeseries",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({bbox:e,interval:"weekly"})}).then(e=>e.json())]),H=[...Z],J=[];"fulfilled"===W.status?(eK(W.value),J.push(...(null===(A=W.value)||void 0===A?void 0:A.providersTried)||[]),Array.isArray(null===(I=W.value)||void 0===I?void 0:I.warnings)&&H.push(...W.value.warnings)):H.push("Weather provider unavailable."),"fulfilled"===Y.status?(e0(iS(null===(C=Y.value)||void 0===C?void 0:C.data,"soil")),J.push(...(null===(F=Y.value)||void 0===F?void 0:F.providersTried)||[]),Array.isArray(null===(T=Y.value)||void 0===T?void 0:T.warnings)&&H.push(...Y.value.warnings)):H.push("Soil provider unavailable."),"fulfilled"===U.status?(e2(iS(null===(D=U.value)||void 0===D?void 0:D.data,"et")),J.push(...(null===(P=U.value)||void 0===P?void 0:P.providersTried)||[]),Array.isArray(null===(E=U.value)||void 0===E?void 0:E.warnings)&&H.push(...U.value.warnings)):H.push("ET provider unavailable."),"fulfilled"===q.status?(e5(q.value),J.push(...(null===(O=q.value)||void 0===O?void 0:O.providersTried)||[]),Array.isArray(null===(G=q.value)||void 0===G?void 0:G.warnings)&&H.push(...q.value.warnings)):H.push("Time-series provider unavailable.");let B=await fetch("/api/gemini",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:"Generate an AI assistant field recommendation summary.",objective:eI,ndviData:{stats:null==V?void 0:null===(r=V.ndvi)||void 0===r?void 0:r.stats},weatherData:"fulfilled"===W.status?{source:null===(s=W.value)||void 0===s?void 0:s.source,isSimulated:null===(o=W.value)||void 0===o?void 0:o.isSimulated,current:(null===(c=W.value)||void 0===c?void 0:null===(d=c.data)||void 0===d?void 0:d.current)||{}}:null,soilData:"fulfilled"===Y.status?{source:null===(u=Y.value)||void 0===u?void 0:u.source,isSimulated:null===(m=Y.value)||void 0===m?void 0:m.isSimulated,stats:(null===(x=Y.value)||void 0===x?void 0:null===(v=x.data)||void 0===v?void 0:v.stats)||{}}:null,etData:"fulfilled"===U.status?{source:null===(h=U.value)||void 0===h?void 0:h.source,isSimulated:null===(p=U.value)||void 0===p?void 0:p.isSimulated,stats:(null===(g=U.value)||void 0===g?void 0:null===(b=g.data)||void 0===b?void 0:b.stats)||{}}:null,timeSeriesData:"fulfilled"===q.status?{source:null===(y=q.value)||void 0===y?void 0:y.source,isSimulated:null===(N=q.value)||void 0===N?void 0:N.isSimulated,summary:null===(w=q.value)||void 0===w?void 0:null===(j=w.data)||void 0===j?void 0:j.summary,timeSeries:((null===(S=q.value)||void 0===S?void 0:null===(z=S.data)||void 0===z?void 0:z.timeSeries)||[]).slice(-12)}:null,providersTried:J,context:{bbox:e,ndviStats:null==V?void 0:null===(k=V.ndvi)||void 0===k?void 0:k.stats,grid3x3:(null==V?void 0:null===(M=V.ndvi)||void 0===M?void 0:M.grid3x3)||[],selectedCell:L,warnings:H.slice(0,12)}})}),Q=await B.json().catch(()=>({}));if(!B.ok)throw Error((null==Q?void 0:Q.message)||"ML analysis failed");e6((null==Q?void 0:Q.inference)||null),ia(H.filter(Boolean)),is(J),f.toast.success("Analysis complete")}catch(e){f.toast.error((null==e?void 0:e.message)||"Analysis failed")}finally{eP(!1)}}async function iM(){if(eB){eO(!0);try{let e=await iw();if(!e)return;let i=await e.getIdToken(!0),t=function(e){if(!Array.isArray(e)||!e.length)return null;let i=[];for(let a of e){var t,l,n;let e=Number(null!==(t=null==a?void 0:a.lat)&&void 0!==t?t:null==a?void 0:a[0]),r=Number(null!==(n=null!==(l=null==a?void 0:a.lng)&&void 0!==l?l:null==a?void 0:a[1])&&void 0!==n?n:null==a?void 0:a[0]);Number.isFinite(e)&&Number.isFinite(r)&&i.push([r,e])}if(i.length<3)return null;let a=i[0],r=i[i.length-1];return((a[0]!==r[0]||a[1]!==r[1])&&i.push(a),i.length<4)?null:{type:"Polygon",coordinates:[i]}}(eS),l={type:"Polygon",coordinates:[[[eB.bbox[0],eB.bbox[1]],[eB.bbox[2],eB.bbox[1]],[eB.bbox[2],eB.bbox[3]],[eB.bbox[0],eB.bbox[3]],[eB.bbox[0],eB.bbox[1]]]]},n={name:"AOI ".concat(new Date().toLocaleDateString()),locationName:ef,description:"Provider: ".concat(eB.provider).concat(eB.fallbackUsed?" (fallback used)":""),ndviStats:ic,previewPng:eB.ndvi.previewPng,bbox:eB.bbox,geojson:t||l,grid3x3:eB.ndvi.grid3x3||[],inferenceSnapshot:e4||null,sourceQuality:{ingestProvider:eB.provider,fallbackUsed:eB.fallbackUsed,warnings:il,providersTried:ir}};try{await (0,O.pb)(i,n)}catch(e){if(e instanceof O.GY&&401===e.status&&(null===P.I8||void 0===P.I8?void 0:P.I8.currentUser)){let e=await P.I8.currentUser.getIdToken(!0);await (0,O.pb)(e,n)}else throw e}f.toast.success("Plot saved")}catch(e){f.toast.error((0,O.$D)(e))}finally{eO(!1)}}}async function iA(){if(!eB){f.toast.error("Run analysis before scenario simulation.");return}e7(!0);try{let e=await fetch("/api/ai/simulate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({objective:eI,scenario:e8,ndviData:{stats:eB.ndvi.stats},weatherData:function(e){var i;if(!e)return null;let t=(null==e?void 0:null===(i=e.data)||void 0===i?void 0:i.current)||(null==e?void 0:e.current)||{};return{source:(null==e?void 0:e.source)||null,isSimulated:!!(null==e?void 0:e.isSimulated),current:{temperature:Z(null==t?void 0:t.temperature),humidity:Z(null==t?void 0:t.humidity),precipitation:Z(null==t?void 0:t.precipitation),windSpeed:Z(null==t?void 0:t.windSpeed)}}}(e$),soilData:W(eX),etData:W(e1),timeSeriesData:function(e){var i,t;if(!e)return null;let l=Array.isArray(null==e?void 0:null===(i=e.data)||void 0===i?void 0:i.timeSeries)?e.data.timeSeries:Array.isArray(null==e?void 0:e.timeSeries)?e.timeSeries:[];return{source:(null==e?void 0:e.source)||null,isSimulated:!!(null==e?void 0:e.isSimulated),summary:(null==e?void 0:null===(t=e.data)||void 0===t?void 0:t.summary)||(null==e?void 0:e.summary)||null,timeSeries:l.slice(-12).map(e=>({date:String((null==e?void 0:e.date)||""),ndvi:Z(null==e?void 0:e.ndvi),cloudCover:"number"==typeof(null==e?void 0:e.cloudCover)?e.cloudCover:null,confidence:"number"==typeof(null==e?void 0:e.confidence)?e.confidence:null}))}}(e3),providersTried:ir,context:{ndviStats:eB.ndvi.stats,grid3x3:(eB.ndvi.grid3x3||[]).slice(0,9),selectedCell:eL},selectedCell:eL})}),i=await e.json().catch(()=>({}));if(!e.ok)throw Error((null==i?void 0:i.message)||(null==i?void 0:i.error)||"Simulation failed");it((null==i?void 0:i.scenario)||null),f.toast.success("Scenario simulation completed")}catch(e){f.toast.error((null==e?void 0:e.message)||"Scenario simulation failed")}finally{e7(!1)}}return(0,n.useEffect)(()=>{let e=window.localStorage.getItem("agrisense.alertThresholds.v1");if(e)try{let i=JSON.parse(e);id({criticalNdvi:Number(null==i?void 0:i.criticalNdvi)||.28,warningNdvi:Number(null==i?void 0:i.warningNdvi)||.42,highAnomaly:Number(null==i?void 0:i.highAnomaly)||.66})}catch(e){}},[]),(0,n.useEffect)(()=>{window.localStorage.setItem("agrisense.alertThresholds.v1",JSON.stringify(io))},[io]),(0,n.useEffect)(()=>{var e,i,t,l;if(!eB)return;let n=[];ic.mean<io.criticalNdvi?n.push({id:"ndvi-critical",type:"critical",message:"Critical vegetation stress risk",details:"NDVI mean is ".concat(ic.mean.toFixed(3),"."),plotName:"Current AOI"}):ic.mean<io.warningNdvi&&n.push({id:"ndvi-warning",type:"warning",message:"Moderate canopy stress detected",details:"NDVI mean is ".concat(ic.mean.toFixed(3),"."),plotName:"Current AOI"}),(Number((null==e4?void 0:null===(e=e4.anomaly)||void 0===e?void 0:e.score)||0)>=io.highAnomaly||(null==e4?void 0:null===(i=e4.anomaly)||void 0===i?void 0:i.level)==="high")&&n.push({id:"anomaly-high",type:"critical",message:"High anomaly score",details:(null==e4?void 0:null===(l=e4.anomaly)||void 0===l?void 0:null===(t=l.signals)||void 0===t?void 0:t[0])||"Unusual field behavior detected.",plotName:"Current AOI"}),window.dispatchEvent(new CustomEvent("agrisense:alerts",{detail:n}))},[eB,ic.mean,null==e4?void 0:null===(F=e4.anomaly)||void 0===F?void 0:F.level,null==e4?void 0:null===(T=e4.anomaly)||void 0===T?void 0:T.score,null==e4?void 0:null===(U=e4.anomaly)||void 0===U?void 0:U.signals,io]),(0,n.useEffect)(()=>{ij();let e=()=>ij();window.addEventListener("resize",e);let i="undefined"!=typeof ResizeObserver?new ResizeObserver(()=>ij()):null;return i&&(eU.current&&i.observe(eU.current),eq.current&&i.observe(eq.current)),()=>{window.removeEventListener("resize",e),null==i||i.disconnect()}},[iN,null==eB?void 0:null===(q=eB.bbox)||void 0===q?void 0:q.join(","),eF]),(0,l.jsxs)("div",{className:"min-h-screen",children:[(0,l.jsx)(y.Z,{}),(0,l.jsxs)("main",{className:"app-shell py-6",children:[(0,l.jsxs)(g.E.section,{className:"mb-6 grid gap-4 lg:grid-cols-[1.35fr_0.9fr]",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.28,ease:"easeOut"},children:[(0,l.jsxs)("article",{id:"pipeline",className:"surface-card p-5",children:[(0,l.jsxs)("div",{className:"mb-4 flex flex-wrap items-center justify-between gap-3",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h1",{className:"text-2xl font-semibold text-zinc-900",children:"Field Operations Workbench"}),(0,l.jsx)("p",{className:"mt-1 text-sm text-zinc-600",children:"Data pipeline, AOI controls, analysis, planning, and save flows are unified here."})]}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(I.z,{variant:"balanced"===eI?"default":"outline",onClick:()=>eC("balanced"),children:"Balanced"}),(0,l.jsx)(I.z,{variant:"yield"===eI?"default":"outline",onClick:()=>eC("yield"),children:"Yield"}),(0,l.jsx)(I.z,{variant:"water"===eI?"default":"outline",onClick:()=>eC("water"),children:"Water"})]})]}),(0,l.jsxs)("div",{className:"grid gap-3 md:grid-cols-2",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"mb-1 block text-xs font-semibold uppercase tracking-wide text-zinc-500",children:"Search location"}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)("input",{value:ef,onChange:e=>ey(e.target.value),className:"w-full rounded-xl border border-zinc-300 px-3 py-2 text-sm outline-none focus:border-emerald-800",placeholder:"Edison, New Jersey"}),(0,l.jsx)(I.z,{variant:"outline",disabled:eD,onClick:iz,children:"Find"})]}),eN.length>0&&(0,l.jsx)("div",{className:"mt-2 max-h-44 overflow-auto rounded-xl border border-zinc-200 bg-white",children:eN.map(e=>(0,l.jsx)("button",{onClick:()=>{ez(function(e){let[i,t,l,n]=e.bbox;return"".concat(l,",").concat(i,",").concat(n,",").concat(t)}(e)),ej([])},className:"block w-full border-b border-zinc-100 px-3 py-2 text-left text-sm text-zinc-700 hover:bg-zinc-50",children:e.display_name},"".concat(e.display_name,"-").concat(e.lat,"-").concat(e.lon)))})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"mb-1 block text-xs font-semibold uppercase tracking-wide text-zinc-500",children:"Date range"}),(0,l.jsx)("input",{value:eM,onChange:e=>eA(e.target.value),className:"w-full rounded-xl border border-zinc-300 px-3 py-2 text-sm outline-none focus:border-emerald-800",placeholder:"YYYY-MM-DD/YYYY-MM-DD"}),(0,l.jsx)("p",{className:"mt-1 text-[11px] text-zinc-500",children:"Policy: balanced freshness + cloud | Output: 512x512"})]})]}),(0,l.jsxs)("div",{className:"mt-3",children:[(0,l.jsx)("label",{className:"mb-1 block text-xs font-semibold uppercase tracking-wide text-zinc-500",children:"Bounding box"}),(0,l.jsx)("input",{value:ew,onChange:e=>ez(e.target.value),className:"w-full rounded-xl border border-zinc-300 px-3 py-2 text-sm outline-none focus:border-emerald-800"})]}),(0,l.jsx)("div",{className:"mt-4 h-[26rem] overflow-hidden rounded-2xl border border-zinc-200",children:(0,l.jsx)(_,{bbox:V(ew)||void 0,onBboxChange:e=>ez(e.join(",")),polygon:eS,onPolygonChange:e=>{ek(e),function(e){if(!Array.isArray(e)||!e.length)return;let i=Number.POSITIVE_INFINITY,t=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY,n=Number.NEGATIVE_INFINITY;for(let a of e){if(!Array.isArray(a)||a.length<2)continue;let e=Number(a[0]),r=Number(a[1]);Number.isFinite(e)&&Number.isFinite(r)&&(i=Math.min(i,e),t=Math.min(t,r),l=Math.max(l,e),n=Math.max(n,r))}Number.isFinite(i)&&Number.isFinite(t)&&Number.isFinite(l)&&Number.isFinite(n)&&ez("".concat(i,",").concat(t,",").concat(l,",").concat(n))}(e)},ndviPng:null==eB?void 0:null===(H=eB.ndvi)||void 0===H?void 0:H.previewPng,ndviBounds:null==eB?void 0:eB.bbox,grid3x3:null==eB?void 0:null===(J=eB.ndvi)||void 0===J?void 0:J.grid3x3,selectedCell:eL,onSelectCell:eZ,showGrid:eR})}),(0,l.jsxs)("div",{className:"mt-4 flex flex-wrap gap-2",children:[(0,l.jsxs)(I.z,{disabled:eD,onClick:ik,children:[eD?(0,l.jsx)(s.Z,{className:"mr-2 h-4 w-4 animate-spin"}):(0,l.jsx)(d,{className:"mr-2 h-4 w-4"}),"Analyze AOI"]}),(0,l.jsxs)(I.z,{variant:"outline",disabled:!eB||eE,onClick:iM,children:[eE?(0,l.jsx)(s.Z,{className:"mr-2 h-4 w-4 animate-spin"}):(0,l.jsx)(c,{className:"mr-2 h-4 w-4"}),"Save Plot"]}),(0,l.jsx)(I.z,{variant:eR?"default":"outline",onClick:()=>eV(e=>!e),children:eR?"Hide 3x3 Grid":"Show 3x3 Grid"}),(0,l.jsx)(I.z,{variant:eW?"default":"outline",onClick:()=>eY(e=>!e),children:eW?"Hide 3D Terrain":"Open 3D Terrain"}),(0,l.jsxs)(I.z,{variant:"outline",onClick:()=>e_(e=>!e),children:[(0,l.jsx)(u,{className:"mr-2 h-4 w-4"}),eG?"Hide Debug":"Show Debug"]})]})]}),(0,l.jsxs)("article",{className:"surface-card p-5",children:[(0,l.jsx)("h2",{className:"text-lg font-semibold text-zinc-900",children:"System Diagnostics"}),(0,l.jsx)("p",{className:"mt-1 text-sm text-zinc-600",children:"Source quality, fallback state, and model confidence."}),(0,l.jsxs)("div",{className:"mt-4 grid gap-3",children:[(0,l.jsxs)("div",{className:"rounded-xl border border-zinc-200 bg-zinc-50 p-3",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("p",{className:"text-xs uppercase tracking-wide text-zinc-500",children:"Satellite source"}),(null==eB?void 0:eB.fallbackUsed)?(0,l.jsx)(Y,{label:"fallback",isSimulated:!0}):(0,l.jsx)(Y,{label:"primary"})]}),(0,l.jsx)("p",{className:"mt-1 text-sm font-semibold text-zinc-900",children:(null==eB?void 0:eB.provider)||"Not analyzed"}),(0,l.jsxs)("p",{className:"text-xs text-zinc-600",children:["Scene: ",(null==eB?void 0:null===(B=eB.imagery)||void 0===B?void 0:B.date)?new Date(eB.imagery.date).toLocaleDateString():"N/A"," | Cloud: ","number"==typeof(null==eB?void 0:null===(Q=eB.imagery)||void 0===Q?void 0:Q.cloudCover)?"".concat(eB.imagery.cloudCover.toFixed(1),"%"):"N/A"]})]}),(0,l.jsxs)("div",{className:"rounded-xl border border-zinc-200 bg-zinc-50 p-3",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("p",{className:"text-xs uppercase tracking-wide text-zinc-500",children:"ML confidence"}),(0,l.jsx)(m,{className:"h-4 w-4 text-emerald-700"})]}),(0,l.jsx)("p",{className:"mt-1 text-sm font-semibold text-zinc-900",children:e4?"".concat(Math.round(100*(e4.confidence||0)),"%"):"Pending"}),(0,l.jsxs)("p",{className:"text-xs text-zinc-600",children:["Data quality: ",e4?"".concat(Math.round(100*((null==e4?void 0:null===($=e4.dataQuality)||void 0===$?void 0:$.score)||0)),"%"):"N/A"," | Objective: ",eI]})]}),(0,l.jsxs)("div",{className:"rounded-xl border border-zinc-200 bg-zinc-50 p-3",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("p",{className:"text-xs uppercase tracking-wide text-zinc-500",children:"Layer quality"}),(0,l.jsxs)("div",{className:"flex gap-1",children:[(0,l.jsx)(Y,{label:"weather",isSimulated:null==e$?void 0:e$.isSimulated}),(0,l.jsx)(Y,{label:"soil",isSimulated:null==eX?void 0:eX.isSimulated}),(0,l.jsx)(Y,{label:"et",isSimulated:null==e1?void 0:e1.isSimulated})]})]}),(0,l.jsxs)("p",{className:"mt-1 text-xs text-zinc-600",children:["Time series: ",(null==e3?void 0:e3.source)||"N/A"," ",(null==e3?void 0:e3.cacheHit)?"(cache)":""]})]})]}),il.length>0&&(0,l.jsxs)("div",{className:"mt-4 rounded-xl border border-amber-200 bg-amber-50 p-3",children:[(0,l.jsxs)("p",{className:"flex items-center gap-2 text-sm font-semibold text-amber-900",children:[(0,l.jsx)(v.Z,{className:"h-4 w-4"}),"Warnings"]}),(0,l.jsx)("ul",{className:"mt-2 list-disc space-y-1 pl-4 text-xs text-amber-800",children:il.slice(0,6).map((e,i)=>(0,l.jsx)("li",{children:e},"".concat(e,"-").concat(i)))})]}),(0,l.jsxs)("div",{className:"mt-4 rounded-xl border border-zinc-200 bg-zinc-50 p-3",children:[(0,l.jsx)("p",{className:"text-xs uppercase tracking-wide text-zinc-500",children:"Proactive Alert Thresholds"}),(0,l.jsxs)("div",{className:"mt-2 space-y-2",children:[(0,l.jsxs)("label",{className:"block text-xs text-zinc-700",children:["Critical NDVI (",io.criticalNdvi.toFixed(2),")",(0,l.jsx)("input",{type:"range",min:.12,max:.45,step:.01,value:io.criticalNdvi,onChange:e=>id(i=>({...i,criticalNdvi:Number(e.target.value)})),className:"mt-1 w-full"})]}),(0,l.jsxs)("label",{className:"block text-xs text-zinc-700",children:["Warning NDVI (",io.warningNdvi.toFixed(2),")",(0,l.jsx)("input",{type:"range",min:.2,max:.6,step:.01,value:io.warningNdvi,onChange:e=>id(i=>({...i,warningNdvi:Number(e.target.value)})),className:"mt-1 w-full"})]}),(0,l.jsxs)("label",{className:"block text-xs text-zinc-700",children:["High anomaly (",(100*io.highAnomaly).toFixed(0),"%)",(0,l.jsx)("input",{type:"range",min:.35,max:.9,step:.01,value:io.highAnomaly,onChange:e=>id(i=>({...i,highAnomaly:Number(e.target.value)})),className:"mt-1 w-full"})]})]})]}),eG&&(0,l.jsxs)("div",{className:"mt-4 rounded-xl border border-zinc-200 bg-zinc-950 p-3 text-xs text-zinc-100",children:[(0,l.jsx)("p",{className:"mb-2 font-semibold",children:"Provider Diagnostics"}),(0,l.jsxs)("div",{className:"space-y-2",children:[0===ir.length&&(0,l.jsx)("p",{className:"text-zinc-300",children:"No diagnostics available yet."}),ir.map((e,i)=>(0,l.jsxs)("div",{className:"rounded border border-zinc-700 bg-zinc-900 p-2",children:[(0,l.jsx)("p",{className:"font-semibold",children:e.provider}),(0,l.jsxs)("p",{className:"text-zinc-300",children:["status: ",e.ok?"ok":"failed"," ",e.reason?"| ".concat(e.reason):"",e.durationMs?" | ".concat(e.durationMs,"ms"):""]})]},"".concat(e.provider,"-").concat(i)))]})]})]})]}),(0,l.jsxs)(g.E.section,{className:"grid gap-4 lg:grid-cols-[1.25fr_1fr]",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3,ease:"easeOut",delay:.05},children:[(0,l.jsxs)("article",{className:"surface-card p-5",children:[(0,l.jsxs)("div",{className:"mb-3 flex items-center justify-between gap-2",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-zinc-900",children:"Layer Viewer"}),(0,l.jsx)("p",{className:"text-sm text-zinc-600",children:"Switch between NDVI, soil moisture, and ET overlays."})]}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsxs)(I.z,{variant:"ndvi"===eF?"default":"outline",onClick:()=>eT("ndvi"),children:[(0,l.jsx)(x,{className:"mr-2 h-4 w-4"}),"NDVI"]}),(0,l.jsxs)(I.z,{variant:"soil"===eF?"default":"outline",onClick:()=>eT("soil"),children:[(0,l.jsx)(h,{className:"mr-2 h-4 w-4"}),"Soil"]}),(0,l.jsxs)(I.z,{variant:"et"===eF?"default":"outline",onClick:()=>eT("et"),children:[(0,l.jsx)(p,{className:"mr-2 h-4 w-4"}),"ET"]})]})]}),iN?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{ref:eU,className:"relative overflow-hidden rounded-2xl border border-zinc-200 bg-zinc-100",children:[(0,l.jsx)("img",{ref:eq,src:"data:image/png;base64,".concat(iN),alt:"".concat(eF," preview"),className:"h-[24rem] w-full object-contain",onLoad:ij}),(0,l.jsx)(A,{cells:null==eB?void 0:null===(K=eB.ndvi)||void 0===K?void 0:K.grid3x3,selectedCell:eL,onSelectCell:eZ,visible:eR,frame:eH})]}),(0,l.jsxs)("p",{className:"mt-2 text-xs text-zinc-600",children:["Color source:"," ",iy?"Quantitative metric grid (matches 3D terrain legend).":"Provider preview image (grid values unavailable)."]})]}):(0,l.jsx)("div",{className:"rounded-2xl border border-dashed border-zinc-300 bg-zinc-50 p-8 text-center text-sm text-zinc-600",children:"Run analysis to generate layer outputs."}),(0,l.jsxs)("div",{className:"mt-4 grid gap-3 md:grid-cols-3",children:[(0,l.jsxs)("div",{className:"rounded-xl border border-zinc-200 bg-zinc-50 p-3",children:[(0,l.jsx)("p",{className:"text-xs uppercase tracking-wide text-zinc-500",children:"NDVI mean"}),(0,l.jsx)("p",{className:"mt-1 text-lg font-semibold text-zinc-900",children:ic.mean.toFixed(3)})]}),(0,l.jsxs)("div",{className:"rounded-xl border border-zinc-200 bg-zinc-50 p-3",children:[(0,l.jsx)("p",{className:"text-xs uppercase tracking-wide text-zinc-500",children:"Soil moisture mean"}),(0,l.jsx)("p",{className:"mt-1 text-lg font-semibold text-zinc-900",children:iu.mean.toFixed(3)})]}),(0,l.jsxs)("div",{className:"rounded-xl border border-zinc-200 bg-zinc-50 p-3",children:[(0,l.jsx)("p",{className:"text-xs uppercase tracking-wide text-zinc-500",children:"ET mean (mm/day)"}),(0,l.jsx)("p",{className:"mt-1 text-lg font-semibold text-zinc-900",children:im.mean.toFixed(3)})]})]}),ix&&(0,l.jsxs)("div",{className:"mt-3 rounded-xl border border-sky-200 bg-sky-50 p-3",children:[(0,l.jsxs)("p",{className:"text-xs uppercase tracking-wide text-sky-700",children:["Selected Plot Point ",ih]}),(0,l.jsxs)("p",{className:"mt-1 text-sm text-sky-900",children:["NDVI mean ",ix.mean.toFixed(3)," | stress ",ix.stressLevel," | valid pixels"," ",(100*ix.validPixelRatio).toFixed(1),"%"]})]}),eW&&(0,l.jsx)("div",{className:"mt-3",children:(0,l.jsx)(R,{open:eW,bbox:null==eB?void 0:eB.bbox,texturePng:iN||(null==eB?void 0:null===(X=eB.ndvi)||void 0===X?void 0:X.previewPng),metricGrid:ig,layer:eF,selectedCell:eL,quality:"high"})})]}),(0,l.jsxs)("article",{className:"surface-card p-5",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-zinc-900",children:"Recommendations"}),(null==e4?void 0:e4.isSimulatedInputs)&&(0,l.jsx)(D,{variant:"outline",children:"Simulated inputs"})]}),(0,l.jsx)("p",{className:"mt-1 text-sm text-zinc-600",children:"Deterministic ML guidance for field operations."}),e4?(0,l.jsxs)("div",{className:"mt-4 space-y-3",children:[ix&&(0,l.jsxs)("div",{className:"rounded-xl border border-sky-200 bg-sky-50 p-3",children:[(0,l.jsxs)("p",{className:"text-xs uppercase tracking-wide text-sky-700",children:["Plot Point focus (",ih,")"]}),(0,l.jsxs)("ul",{className:"mt-2 list-disc space-y-1 pl-4 text-xs text-sky-900",children:["high"===ix.stressLevel&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("li",{children:"Prioritize irrigation uniformity check in this cell within 24 hours."}),(0,l.jsx)("li",{children:"Scout canopy stress causes and compare emitter pressure."})]}),"moderate"===ix.stressLevel&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("li",{children:"Schedule targeted scouting and soil check in this cell this week."}),(0,l.jsx)("li",{children:"Re-check NDVI after next irrigation cycle."})]}),"low"===ix.stressLevel&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("li",{children:"Maintain baseline schedule and monitor trend drift."}),(0,l.jsx)("li",{children:"Use this cell as healthy reference for comparisons."})]}),"unknown"===ix.stressLevel&&(0,l.jsx)(l.Fragment,{children:(0,l.jsx)("li",{children:"Data quality is low in this cell; re-run analysis with cleaner scene dates."})})]})]}),(0,l.jsxs)("div",{className:"rounded-xl border border-zinc-200 bg-zinc-50 p-3",children:[(0,l.jsx)("p",{className:"text-xs uppercase tracking-wide text-zinc-500",children:"What changed"}),(0,l.jsx)("p",{className:"mt-1 text-sm text-zinc-800",children:null==e4?void 0:null===(ee=e4.summary)||void 0===ee?void 0:ee.whatChanged})]}),(0,l.jsxs)("div",{className:"rounded-xl border border-zinc-200 bg-zinc-50 p-3",children:[(0,l.jsx)("p",{className:"text-xs uppercase tracking-wide text-zinc-500",children:"Why"}),(0,l.jsx)("p",{className:"mt-1 text-sm text-zinc-800",children:null==e4?void 0:null===(ei=e4.summary)||void 0===ei?void 0:ei.why})]}),(0,l.jsxs)("div",{className:"rounded-xl border border-zinc-200 bg-zinc-50 p-3",children:[(0,l.jsx)("p",{className:"text-xs uppercase tracking-wide text-zinc-500",children:"Next actions"}),(0,l.jsx)("p",{className:"mt-1 text-sm text-zinc-800",children:null==e4?void 0:null===(et=e4.summary)||void 0===et?void 0:et.nextActions}),(0,l.jsxs)("p",{className:"mt-1 text-xs text-zinc-500",children:["Re-check in ",null==e4?void 0:null===(el=e4.summary)||void 0===el?void 0:el.recheckIn]})]}),((null==e4?void 0:e4.recommendations)||[]).map(e=>(0,l.jsxs)("div",{className:"rounded-xl border border-zinc-200 p-3",children:[(0,l.jsxs)("div",{className:"mb-1 flex items-center justify-between",children:[(0,l.jsx)("p",{className:"text-sm font-semibold text-zinc-900",children:e.title}),(0,l.jsx)(Y,{label:e.priority,isSimulated:"high"===e.priority})]}),(0,l.jsx)("p",{className:"text-xs text-zinc-600",children:e.reason}),(0,l.jsx)("ul",{className:"mt-2 list-disc space-y-1 pl-4 text-xs text-zinc-700",children:(e.actions||[]).slice(0,3).map((i,t)=>(0,l.jsx)("li",{children:i},"".concat(e.id,"-").concat(t)))})]},e.id)),(0,l.jsxs)("div",{className:"rounded-xl border border-zinc-200 bg-zinc-50 p-3",children:[(0,l.jsx)("p",{className:"text-xs uppercase tracking-wide text-zinc-500",children:"What-if Simulator"}),(0,l.jsxs)("div",{className:"mt-2 grid gap-2",children:[(0,l.jsxs)("label",{className:"text-xs text-zinc-700",children:["Irrigation delta (",e8.irrigationDelta>=0?"+":"",Math.round(100*e8.irrigationDelta),"%)"]}),(0,l.jsx)("input",{type:"range",min:-.3,max:.6,step:.05,value:e8.irrigationDelta,onChange:e=>ie(i=>({...i,irrigationDelta:Number(e.target.value)}))}),(0,l.jsxs)("label",{className:"text-xs text-zinc-700",children:["Water budget (",Math.round(100*e8.waterBudget),"%)"]}),(0,l.jsx)("input",{type:"range",min:0,max:1,step:.05,value:e8.waterBudget,onChange:e=>ie(i=>({...i,waterBudget:Number(e.target.value)}))}),(0,l.jsxs)("label",{className:"text-xs text-zinc-700",children:["Target risk (",Math.round(100*e8.targetRisk),"%)"]}),(0,l.jsx)("input",{type:"range",min:.05,max:.9,step:.05,value:e8.targetRisk,onChange:e=>ie(i=>({...i,targetRisk:Number(e.target.value)}))}),(0,l.jsxs)(I.z,{variant:"outline",disabled:e9,onClick:iA,children:[e9?(0,l.jsx)(s.Z,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Run What-if"]})]}),ii&&(0,l.jsxs)("div",{className:"mt-3 rounded-lg border border-sky-200 bg-sky-50 p-2 text-xs text-sky-900",children:[(0,l.jsxs)("p",{children:["Risk: ",(100*ii.baselineRisk7d).toFixed(1),"% -> ",(100*ii.scenarioRisk7d).toFixed(1),"%"]}),(0,l.jsxs)("p",{children:["NDVI30: ",ii.baselineNdvi30d.toFixed(3)," -> ",ii.scenarioNdvi30d.toFixed(3)]}),(0,l.jsxs)("p",{children:["Water delta: ",ii.waterUseDeltaPct.toFixed(1),"% | Yield proxy: ",ii.yieldProxyDeltaPct.toFixed(1),"%"]}),(0,l.jsx)("p",{className:"mt-1",children:ii.recommendation})]})]})]}):(0,l.jsx)("div",{className:"mt-4 rounded-xl border border-dashed border-zinc-300 bg-zinc-50 p-6 text-sm text-zinc-600",children:"Run analysis to generate recommendations."})]})]}),(0,l.jsxs)(g.E.section,{className:"mt-4 grid gap-4 lg:grid-cols-[1.4fr_0.9fr]",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.33,ease:"easeOut",delay:.1},children:[(0,l.jsxs)("article",{className:"surface-card p-5",children:[(0,l.jsxs)("div",{className:"mb-3 flex items-center justify-between",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold text-zinc-900",children:"Historical NDVI Trend"}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(Y,{label:(null==e3?void 0:e3.source)||"n/a",isSimulated:null==e3?void 0:e3.isSimulated}),(null==e3?void 0:e3.cacheHit)&&(0,l.jsx)(Y,{label:"cache"})]})]}),(0,l.jsx)(k.Z,{data:((null==e3?void 0:null===(en=e3.data)||void 0===en?void 0:en.timeSeries)||[]).map(e=>({date:e.date,ndvi:Number(e.ndvi),confidence:Number(e.confidence),cloudCover:"number"==typeof e.cloudCover?e.cloudCover:void 0})),title:"AOI NDVI timeline",showConfidence:!0,showCloudCover:!0})]}),(0,l.jsxs)("article",{className:"surface-card p-5",children:[(0,l.jsxs)("h3",{className:"flex items-center gap-2 text-lg font-semibold text-zinc-900",children:[(0,l.jsx)(b,{className:"h-5 w-5 text-emerald-700"}),"Weather Snapshot"]}),(0,l.jsxs)("p",{className:"mt-1 text-sm text-zinc-600",children:[(null==e$?void 0:e$.source)||"No weather data"," ",(null==e$?void 0:e$.isSimulated)?"(simulated)":""]}),(0,l.jsxs)("div",{className:"mt-4 grid grid-cols-2 gap-3",children:[(0,l.jsxs)("div",{className:"rounded-xl border border-zinc-200 bg-zinc-50 p-3",children:[(0,l.jsx)("p",{className:"text-xs uppercase tracking-wide text-zinc-500",children:"Temp"}),(0,l.jsxs)("p",{className:"mt-1 text-lg font-semibold text-zinc-900",children:[null!==(ex=null==e$?void 0:null===(er=e$.data)||void 0===er?void 0:null===(ea=er.current)||void 0===ea?void 0:ea.temperature)&&void 0!==ex?ex:"--","F"]})]}),(0,l.jsxs)("div",{className:"rounded-xl border border-zinc-200 bg-zinc-50 p-3",children:[(0,l.jsx)("p",{className:"text-xs uppercase tracking-wide text-zinc-500",children:"Humidity"}),(0,l.jsxs)("p",{className:"mt-1 text-lg font-semibold text-zinc-900",children:[null!==(eh=null==e$?void 0:null===(eo=e$.data)||void 0===eo?void 0:null===(es=eo.current)||void 0===es?void 0:es.humidity)&&void 0!==eh?eh:"--","%"]})]}),(0,l.jsxs)("div",{className:"rounded-xl border border-zinc-200 bg-zinc-50 p-3",children:[(0,l.jsx)("p",{className:"text-xs uppercase tracking-wide text-zinc-500",children:"Precip"}),(0,l.jsxs)("p",{className:"mt-1 text-lg font-semibold text-zinc-900",children:[null!==(ep=null==e$?void 0:null===(ec=e$.data)||void 0===ec?void 0:null===(ed=ec.current)||void 0===ed?void 0:ed.precipitation)&&void 0!==ep?ep:"--"," mm"]})]}),(0,l.jsxs)("div",{className:"rounded-xl border border-zinc-200 bg-zinc-50 p-3",children:[(0,l.jsx)("p",{className:"text-xs uppercase tracking-wide text-zinc-500",children:"Wind"}),(0,l.jsxs)("p",{className:"mt-1 text-lg font-semibold text-zinc-900",children:[null!==(eb=null==e$?void 0:null===(em=e$.data)||void 0===em?void 0:null===(eu=em.current)||void 0===eu?void 0:eu.windSpeed)&&void 0!==eb?eb:"--"," mph"]})]})]})]})]})]}),(0,l.jsx)(S,{objective:eI,context:{bbox:null==eB?void 0:eB.bbox,ndviStats:ic,grid3x3:(null==eB?void 0:null===(ev=eB.ndvi)||void 0===ev?void 0:ev.grid3x3)||[],selectedCell:eL,selectedCellData:ix,soilStats:iu,etStats:im,weather:e$||null,timeSeries:e3||null,inference:e4||null,warnings:il,providersTried:ir}})]})}}},function(e){e.O(0,[551,350,712,500,93,850,888,774,179],function(){return e(e.s=528)}),_N_E=e.O()}]);