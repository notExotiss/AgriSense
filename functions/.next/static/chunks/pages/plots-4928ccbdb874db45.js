(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[611],{7252:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/plots",function(){return r(8917)}])},3945:function(e,t,r){"use strict";r.d(t,{Z:function(){return v}});var n=r(5893),a=r(7294),i=r(1664),s=r.n(i),o=r(7716),l=r(6789),d=r(1352),c=r(7232),u=r(7497),m=r(1571),h=r(8532),x=r(250);function f(){let[e,t]=(0,a.useState)(!1),{theme:r,setTheme:i}=(0,m.F)();if((0,a.useEffect)(()=>{t(!0)},[]),!e)return(0,n.jsx)(u.z,{variant:"ghost",size:"icon","aria-label":"Toggle theme",children:(0,n.jsx)(h.Z,{className:"h-4 w-4"})});let s="dark"===r;return(0,n.jsx)(u.z,{variant:"ghost",size:"icon","aria-label":"Toggle theme",onClick:()=>i(s?"light":"dark"),children:s?(0,n.jsx)(h.Z,{className:"h-4 w-4"}):(0,n.jsx)(x.Z,{className:"h-4 w-4"})})}let p=[{href:"/",label:"Home"},{href:"/dashboard",label:"Dashboard"},{href:"/plots",label:"Plots"},{href:"/account",label:"Account"}],b=/^\/(dashboard|plots|account|ingest)(\/|$)/;function g(e){return b.test(e)?"/api/session/enter?next=".concat(encodeURIComponent(e)):e}function v(){let[e,t]=a.useState([]),[r,i]=a.useState(!1),[m,h]=a.useState(!1);a.useEffect(()=>{let e=e=>{t(Array.isArray(e.detail)?e.detail:[])};return window.addEventListener("agrisense:alerts",e),()=>window.removeEventListener("agrisense:alerts",e)},[]);let x=e.filter(e=>"critical"===e.type).length;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("header",{className:"liquid-glass sticky top-0 z-40 border-b border-border bg-background/95 backdrop-blur",children:[(0,n.jsxs)("div",{className:"mx-auto flex h-16 w-full max-w-7xl items-center justify-between px-4 sm:px-6",children:[(0,n.jsxs)(s(),{href:"/",className:"inline-flex items-center gap-2",children:[(0,n.jsx)("span",{className:"inline-flex h-9 w-9 items-center justify-center rounded-xl bg-primary text-primary-foreground",children:(0,n.jsx)(o.Z,{className:"h-5 w-5"})}),(0,n.jsxs)("span",{children:[(0,n.jsx)("span",{className:"block text-sm font-semibold leading-none text-foreground",children:"AgriSense"}),(0,n.jsx)("span",{className:"block text-[11px] uppercase tracking-[0.16em] text-muted-foreground",children:"Field Ops"})]})]}),(0,n.jsx)("nav",{className:"hidden items-center gap-5 md:flex",children:p.map(e=>(0,n.jsx)(s(),{href:g(e.href),className:"text-sm font-medium text-muted-foreground transition hover:text-primary",children:e.label},e.href))}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsxs)("button",{onClick:()=>h(e=>!e),className:"relative inline-flex h-10 w-10 items-center justify-center rounded-xl border border-border bg-card text-muted-foreground hover:border-primary/40 hover:text-foreground","aria-label":"Open alerts",children:[(0,n.jsx)(l.Z,{className:"h-4 w-4"}),e.length>0&&(0,n.jsx)("span",{className:"absolute -right-1 -top-1 rounded-full bg-rose-600 px-1.5 py-0.5 text-[10px] font-semibold text-white",children:x||e.length})]}),(0,n.jsx)(f,{}),(0,n.jsx)(u.z,{variant:"outline",size:"icon",className:"md:hidden",onClick:()=>i(e=>!e),children:r?(0,n.jsx)(d.Z,{className:"h-4 w-4"}):(0,n.jsx)(c.Z,{className:"h-4 w-4"})})]})]}),r&&(0,n.jsx)("nav",{className:"border-t border-border bg-background px-4 py-3 md:hidden",children:(0,n.jsxs)("div",{className:"space-y-2",children:[p.map(e=>(0,n.jsx)(s(),{href:g(e.href),onClick:()=>i(!1),className:"block rounded-lg px-3 py-2 text-sm font-medium text-muted-foreground hover:bg-muted hover:text-primary",children:e.label},e.href)),(0,n.jsx)("div",{className:"pt-2",children:(0,n.jsx)(f,{})})]})})]}),m&&(0,n.jsxs)("aside",{className:"liquid-glass fixed right-4 top-20 z-50 w-[min(95vw,26rem)] rounded-2xl border border-border bg-card shadow-xl",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between border-b border-border px-4 py-3",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-sm font-semibold text-foreground",children:"Alert Center"}),(0,n.jsx)("p",{className:"text-xs text-muted-foreground",children:"Active agronomy and system alerts"})]}),(0,n.jsx)("button",{onClick:()=>h(!1),className:"text-muted-foreground hover:text-foreground",children:(0,n.jsx)(d.Z,{className:"h-4 w-4"})})]}),(0,n.jsxs)("div",{className:"max-h-80 space-y-2 overflow-auto p-3",children:[!e.length&&(0,n.jsx)("p",{className:"rounded-lg bg-muted p-3 text-sm text-muted-foreground",children:"No active alerts."}),e.map((e,t)=>(0,n.jsxs)("article",{className:"critical"===e.type?"alert-card alert-card-critical":"alert-card alert-card-warning",children:[(0,n.jsx)("p",{className:"alert-title",children:e.message||"Alert"}),(0,n.jsx)("p",{className:"alert-copy",children:e.details||"No additional details provided."}),e.plotName&&(0,n.jsx)("p",{className:"alert-meta",children:e.plotName})]},"".concat(e.id||t)))]})]})]})}},7497:function(e,t,r){"use strict";r.d(t,{z:function(){return l}});var n=r(5893),a=r(7294),i=r(2003),s=r(1966);let o=(0,i.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:opacity-90",secondary:"bg-secondary text-secondary-foreground hover:opacity-90",outline:"border bg-transparent hover:bg-accent hover:text-accent-foreground",ghost:"hover:bg-accent hover:text-accent-foreground",destructive:"bg-destructive text-destructive-foreground hover:opacity-90"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),l=a.forwardRef((e,t)=>{let{className:r,variant:a,size:i,...l}=e;return(0,n.jsx)("button",{className:(0,s.cn)(o({variant:a,size:i,className:r})),ref:t,...l})});l.displayName="Button"},1966:function(e,t,r){"use strict";r.d(t,{cn:function(){return i}});var n=r(512),a=r(8388);function i(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,a.m6)((0,n.W)(t))}},8704:function(e,t,r){"use strict";r.d(t,{$D:function(){return s},GY:function(){return n},eR:function(){return d},k1:function(){return o},pb:function(){return l}});class n extends Error{constructor(e,t,r){super(e),this.name="ApiClientError",this.code=t,this.status=r}}async function a(e){try{return await e.json()}catch(e){return{}}}async function i(e,t){let r=await fetch(e,t),i=await a(r);if(!r.ok)throw new n((null==i?void 0:i.message)||(null==i?void 0:i.error)||"Request failed (".concat(r.status,")"),(null==i?void 0:i.error)||"request_failed",r.status);return i}function s(e){return e instanceof n?"invalid_auth"===e.code?"Authentication token is invalid or expired. Sign in again and retry.":401===e.status?"Sign-in expired. Please sign in again.":403===e.status?"You do not have access to this plot.":408===e.status?"Request timed out. Retry in a few seconds.":413===e.status||"plot_payload_too_large"===e.code?"Plot snapshot is too large to save. Re-run analysis and retry.":"invalid_geometry"===e.code?"Selected area geometry is invalid. Redraw the AOI and retry.":"invalid_payload"===e.code?"Plot payload contains unsupported values.":503===e.status||"firebase_admin_misconfigured"===e.code?"Server save service is misconfigured. Check Firebase Admin credentials.":"validation_failed"===e.code?"Some required fields are missing.":e.message||"Save failed. Please retry.":"Network issue. Check connection and retry."}async function o(e){let t=await i("/api/items",{method:"GET",headers:{Authorization:"Bearer ".concat(e)}});return Array.isArray(t.items)?t.items:[]}async function l(e,t){return await i("/api/items",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify(t)})}async function d(e,t){await i("/api/plots/".concat(t),{method:"DELETE",headers:{Authorization:"Bearer ".concat(e)}})}},2355:function(e,t,r){"use strict";r.d(t,{q:function(){return a},x:function(){return i}});var n=r(2370);async function a(e){if(e.currentUser)return e.currentUser;let t=new n.hJ;t.setCustomParameters({prompt:"select_account"}),await (0,n.Fb)(e,n.a$).catch(()=>{});try{return(await (0,n.rh)(e,t)).user}catch(a){var r;if("auth/popup-blocked"===(r=String((null==a?void 0:a.code)||""))||"auth/popup-closed-by-user"===r||"auth/cancelled-popup-request"===r||"auth/operation-not-supported-in-this-environment"===r)return await (0,n.F6)(e,t),null;throw a}}function i(e){let t=String((null==e?void 0:e.code)||"");return"auth/unauthorized-domain"===t?"Google sign-in failed: add this app domain to Firebase Auth Authorized domains.":"auth/configuration-not-found"===t?"Google sign-in failed: enable Google provider in Firebase Auth.":"auth/operation-not-allowed"===t?"Google sign-in failed: Google provider is disabled in Firebase Auth.":"auth/network-request-failed"===t?"Google sign-in failed due to a network error. Try again.":(null==e?void 0:e.message)||"Google sign-in failed."}},5552:function(e,t,r){"use strict";function n(e){let t=(null==e?void 0:e.geojson)||function(e){if("string"!=typeof e)return null;try{let t=JSON.parse(e);if((null==t?void 0:t.type)==="Polygon"&&Array.isArray(null==t?void 0:t.coordinates))return t}catch(e){}return null}(null==e?void 0:e.geojsonText),r=Array.isArray(null==e?void 0:e.bbox)&&4===e.bbox.length?e.bbox:function(e){var t;let r=null==e?void 0:null===(t=e.coordinates)||void 0===t?void 0:t[0];if(!Array.isArray(r)||r.length<4)return null;let n=Number.POSITIVE_INFINITY,a=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,s=Number.NEGATIVE_INFINITY;for(let e of r){if(!Array.isArray(e)||e.length<2)continue;let t=Number(e[0]),r=Number(e[1]);Number.isFinite(t)&&Number.isFinite(r)&&(n=Math.min(n,t),a=Math.min(a,r),i=Math.max(i,t),s=Math.max(s,r))}return Number.isFinite(n)?[n,a,i,s]:null}(t);return{geojson:t||null,bbox:r,grid3x3:Array.isArray(null==e?void 0:e.grid3x3)?e.grid3x3:[]}}r.d(t,{m:function(){return n}})},6394:function(e,t,r){"use strict";r.d(t,{I8:function(){return d},oy:function(){return c}});var n=r(3977),a=r(2370);let i={apiKey:"AIzaSyBkGPzwLd_hQj-yPB7mxNijPW89iDXym2A",authDomain:"brightbite-81e92.firebaseapp.com",projectId:"brightbite-81e92",storageBucket:"brightbite-81e92.firebasestorage.app",messagingSenderId:"273197668689",appId:"1:273197668689:web:fc5eee2714d4bb89365b70"},s=Object.values(i).every(e=>"string"==typeof e&&e.length>0);function o(){return s?(0,n.C6)().length?(0,n.Mq)():(0,n.ZF)(i):null}let l=null;o();let d=function(){if(!s)return null;if(l)return l;let e=o();return e?l=(0,a.v0)(e):null}(),c=s},8917:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return b}});var n=r(5893),a=r(7294),i=r(1664),s=r.n(i),o=r(2370),l=r(6316);let d=(0,r(1373).Z)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);var c=r(3945),u=r(7497),m=r(4712),h=r(6394),x=r(2355),f=r(8704),p=r(5552);function b(){let e=h.oy,[t,r]=(0,a.useState)(null),[i,b]=(0,a.useState)([]),[g,v]=(0,a.useState)(!0),[y,N]=(0,a.useState)(null),j=(0,a.useMemo)(()=>[...i].sort((e,t)=>String(t.createdAt||"").localeCompare(String(e.createdAt||""))),[i]);async function w(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t;if(e){v(!0);try{let t;let r=await e.getIdToken(!0);try{t=await (0,f.k1)(r)}catch(r){if(r instanceof f.GY&&401===r.status){let r=await e.getIdToken(!0);t=await (0,f.k1)(r)}else throw r}b(t)}catch(e){m.toast.error((0,f.$D)(e))}finally{v(!1)}}}async function z(){if(e&&h.I8)try{await (0,x.q)(h.I8)}catch(e){m.toast.error((0,x.x)(e))}}async function k(e){if(!h.I8||!t)return;let r=[...i];N(e),b(t=>t.filter(t=>t.id!==e));try{let r=await t.getIdToken(!0);await (0,f.eR)(r,e),m.toast.success("Plot deleted")}catch(e){b(r),m.toast.error((0,f.$D)(e))}finally{N(null)}}return(0,a.useEffect)(()=>{if(!e||!h.I8){v(!1);return}return(0,o.Aj)(h.I8,e=>{if(r(e),!e){b([]),v(!1);return}w(e)})},[e]),(0,n.jsxs)("div",{className:"min-h-screen",children:[(0,n.jsx)(c.Z,{}),(0,n.jsx)("main",{className:"app-shell py-6",children:(0,n.jsxs)("section",{className:"surface-card p-5",children:[(0,n.jsxs)("div",{className:"mb-4 flex items-center justify-between gap-2",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{className:"text-2xl font-semibold text-zinc-900",children:"Saved Plots"}),(0,n.jsx)("p",{className:"mt-1 text-sm text-zinc-600",children:"Persistent analysis snapshots with inference metadata."})]}),t&&(0,n.jsx)(u.z,{variant:"outline",onClick:()=>void w(),children:"Refresh"})]}),!e&&(0,n.jsx)("div",{className:"rounded-xl border border-zinc-200 bg-zinc-50 p-4 text-sm text-zinc-600",children:"Firebase Auth is not configured. Set `NEXT_PUBLIC_FIREBASE_*` values to enable plot persistence."}),e&&!t&&(0,n.jsxs)("div",{className:"rounded-xl border border-zinc-200 bg-zinc-50 p-4",children:[(0,n.jsx)("p",{className:"text-sm text-zinc-600",children:"Sign in to view and manage saved plots."}),(0,n.jsx)(u.z,{className:"mt-3",onClick:z,children:"Sign in with Google"})]}),e&&t&&g&&(0,n.jsxs)("div",{className:"flex items-center gap-2 rounded-xl border border-zinc-200 bg-zinc-50 p-4 text-sm text-zinc-600",children:[(0,n.jsx)(l.Z,{className:"h-4 w-4 animate-spin"}),"Loading plots"]}),e&&t&&!g&&0===j.length&&(0,n.jsx)("div",{className:"rounded-xl border border-dashed border-zinc-300 bg-zinc-50 p-6 text-sm text-zinc-600",children:"No plots saved yet. Run analysis from dashboard and save your first AOI."}),e&&t&&j.length>0&&(0,n.jsx)("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-3",children:j.map(e=>(0,n.jsx)("article",{className:"rounded-2xl border border-zinc-200 bg-white p-3 shadow-sm",children:(()=>{var t;let r=(0,p.m)(e);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"mb-2 flex items-start justify-between gap-2",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{className:"text-sm font-semibold text-zinc-900",children:e.name||"Untitled plot"}),(0,n.jsx)("p",{className:"text-xs text-zinc-500",children:e.locationName||"Unknown location"})]}),(0,n.jsx)("button",{onClick:()=>void k(e.id),disabled:y===e.id,className:"rounded-lg border border-zinc-200 p-1.5 text-zinc-600 hover:bg-zinc-100 disabled:opacity-50","aria-label":"Delete plot",children:y===e.id?(0,n.jsx)(l.Z,{className:"h-4 w-4 animate-spin"}):(0,n.jsx)(d,{className:"h-4 w-4"})})]}),r.bbox&&(0,n.jsxs)("p",{className:"mb-2 text-[11px] text-zinc-500",children:["AOI bbox: ",r.bbox[0].toFixed(2),", ",r.bbox[1].toFixed(2),", ",r.bbox[2].toFixed(2),", ",r.bbox[3].toFixed(2)]}),e.previewPng&&(0,n.jsx)("div",{className:"overflow-hidden rounded-xl border border-zinc-200 bg-zinc-100",children:(0,n.jsx)("img",{src:"data:image/png;base64,".concat(e.previewPng),alt:e.name||"plot preview",className:"h-44 w-full object-cover"})}),(0,n.jsxs)("div",{className:"mt-2 text-xs text-zinc-600",children:["NDVI mean: ","number"==typeof(null==e?void 0:null===(t=e.ndviStats)||void 0===t?void 0:t.mean)?e.ndviStats.mean.toFixed(3):"N/A"]}),(0,n.jsxs)("div",{className:"mt-1 text-xs text-zinc-500",children:["Created: ",e.createdAt?new Date(e.createdAt).toLocaleString():"Unknown"]}),(0,n.jsx)("div",{className:"mt-3",children:(0,n.jsx)(s(),{href:"/plots/".concat(e.id),children:(0,n.jsx)(u.z,{className:"w-full",size:"sm",children:"Open details"})})})]})})()},e.id))})]})})]})}}},function(e){e.O(0,[551,23,712,500,888,774,179],function(){return e(e.s=7252)}),_N_E=e.O()}]);