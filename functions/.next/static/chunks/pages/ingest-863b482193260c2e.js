(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[488],{8427:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/ingest",function(){return a(2818)}])},3727:function(e,t,a){"use strict";a.d(t,{Z:function(){return _}});var s=a(5893),r=a(7294),n=a(1664),l=a.n(n),o=a(1571),d=a(8532),i=a(250),c=a(7497);function u(){let{theme:e,setTheme:t}=(0,o.F)(),a="dark"===e;return(0,s.jsx)(c.z,{variant:"ghost",size:"icon","aria-label":"Toggle theme",onClick:()=>t(a?"light":"dark"),children:a?(0,s.jsx)(d.Z,{className:"h-4 w-4"}):(0,s.jsx)(i.Z,{className:"h-4 w-4"})})}var m=a(7716),x=a(6789),h=a(7232),f=a(1549),b=a(2003),p=a(1352),g=a(512),v=a(8388);function j(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,v.m6)((0,g.W)(t))}let N=f.fC,y=f.xz;f.x8;let w=f.h_,k=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(f.aV,{className:j("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...r,ref:t})});k.displayName=f.aV.displayName;let S=(0,b.j)("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500 data-[state=open]:animate-in data-[state=closed]:animate-out",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4 border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),C=r.forwardRef((e,t)=>{let{side:a="right",className:r,children:n,...l}=e;return(0,s.jsxs)(w,{children:[(0,s.jsx)(k,{}),(0,s.jsxs)(f.VY,{ref:t,className:j(S({side:a}),r),...l,children:[(0,s.jsxs)(f.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[(0,s.jsx)(p.Z,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"sr-only",children:"Close"})]}),n]})]})});C.displayName=f.VY.displayName;let A=e=>{let{className:t,...a}=e;return(0,s.jsx)("div",{className:j("flex flex-col space-y-2 text-center sm:text-left",t),...a})};A.displayName="SheetHeader";let I=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(f.Dx,{ref:t,className:j("text-lg font-semibold text-foreground",a),...r})});I.displayName=f.Dx.displayName;let z=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(f.dk,{ref:t,className:j("text-sm text-muted-foreground",a),...r})});function _(){let[e,t]=r.useState(!1),[a,n]=r.useState([]);r.useEffect(()=>{let e=e=>n(Array.isArray(e.detail)?e.detail:[]);return window.addEventListener("agrisense:alerts",e),()=>window.removeEventListener("agrisense:alerts",e)},[]);let o=a.filter(e=>"critical"===e.type).length,d=r.useMemo(()=>{let e={};for(let t of a){let a=t.plotName||t.plotId||"Current AOI";e[a]||(e[a]=[]),e[a].push(t)}return e},[JSON.stringify(a)]),[i,f]=r.useState({});return(0,s.jsxs)("nav",{className:"border-b bg-background/80 backdrop-blur-sm sticky top-0 z-50",children:[(0,s.jsx)("div",{className:"container mx-auto px-4",children:(0,s.jsxs)("div",{className:"flex items-center justify-between h-16",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(m.Z,{className:"h-6 w-6 text-blue-600"}),(0,s.jsx)(l(),{href:"/",className:"font-bold text-xl",children:"AgriSense"})]}),(0,s.jsxs)("div",{className:"hidden md:flex items-center gap-6",children:[(0,s.jsx)(l(),{href:"/dashboard",className:"text-sm font-medium hover:text-blue-600 dark:hover:text-blue-400 transition-colors",children:"Dashboard"}),(0,s.jsx)(l(),{href:"/plots",className:"text-sm font-medium hover:text-blue-600 dark:hover:text-blue-400 transition-colors",children:"Plots"}),(0,s.jsx)(l(),{href:"/account",className:"text-sm font-medium hover:text-blue-600 dark:hover:text-blue-400 transition-colors",children:"Account"}),(0,s.jsxs)("button",{className:"relative",onClick:()=>t(e=>!e),"aria-label":"Alerts",children:[(0,s.jsx)(x.Z,{className:"h-5 w-5"}),a.length>0&&(0,s.jsx)("span",{className:"absolute -top-1 -right-1 text-[10px] bg-red-600 text-white rounded-full px-1",children:o||a.length})]}),(0,s.jsx)(u,{})]}),(0,s.jsxs)(N,{children:[(0,s.jsx)(y,{asChild:!0,className:"md:hidden",children:(0,s.jsx)(c.z,{variant:"ghost",size:"sm",children:(0,s.jsx)(h.Z,{className:"h-5 w-5"})})}),(0,s.jsxs)(C,{children:[(0,s.jsxs)(A,{children:[(0,s.jsx)(I,{children:"Navigation"}),(0,s.jsx)(z,{children:"Access all AgriSense features"})]}),(0,s.jsxs)("div",{className:"flex flex-col gap-4 mt-6",children:[(0,s.jsx)(l(),{href:"/dashboard",className:"text-sm font-medium",children:"Dashboard"}),(0,s.jsx)(l(),{href:"/plots",className:"text-sm font-medium",children:"Plots"}),(0,s.jsx)(l(),{href:"/account",className:"text-sm font-medium",children:"Account"}),(0,s.jsx)(u,{})]})]})]})]})}),e&&(0,s.jsxs)("div",{className:"fixed right-4 top-16 z-50 w-80 rounded-lg border bg-background shadow",children:[(0,s.jsx)("div",{className:"p-3 border-b font-medium",children:"Alerts"}),(0,s.jsx)("div",{className:"max-h-80 overflow-auto p-2 space-y-2 text-sm",children:0===Object.keys(d).length?(0,s.jsx)("div",{className:"text-muted-foreground p-2",children:"No alerts"}):Object.entries(d).map(e=>{let[t,a]=e;return(0,s.jsxs)("div",{className:"rounded border",children:[(0,s.jsxs)("button",{className:"w-full text-left p-2 font-medium flex items-center justify-between",onClick:()=>f(e=>({...e,[t]:!e[t]})),children:[(0,s.jsx)("span",{className:"break-words",children:t}),(0,s.jsx)("span",{className:"text-xs opacity-70",children:a.length})]}),i[t]&&(0,s.jsx)("div",{className:"p-2 space-y-2",children:a.map(e=>(0,s.jsxs)("div",{className:"p-2 rounded border overflow-hidden break-words ".concat("critical"===e.type?"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800":"bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-800"),children:[(0,s.jsx)("div",{className:"font-medium break-words",children:e.message}),(0,s.jsx)("div",{className:"opacity-80 break-words",children:e.details})]},e.id))})]},t)})})]})]})}z.displayName=f.dk.displayName},7497:function(e,t,a){"use strict";a.d(t,{z:function(){return d}});var s=a(5893),r=a(7294),n=a(2003),l=a(1966);let o=(0,n.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:opacity-90",secondary:"bg-secondary text-secondary-foreground hover:opacity-90",outline:"border bg-transparent hover:bg-accent hover:text-accent-foreground",ghost:"hover:bg-accent hover:text-accent-foreground",destructive:"bg-destructive text-destructive-foreground hover:opacity-90"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),d=r.forwardRef((e,t)=>{let{className:a,variant:r,size:n,...d}=e;return(0,s.jsx)("button",{className:(0,l.cn)(o({variant:r,size:n,className:a})),ref:t,...d})});d.displayName="Button"},1966:function(e,t,a){"use strict";a.d(t,{cn:function(){return n}});var s=a(512),r=a(8388);function n(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return(0,r.m6)((0,s.W)(t))}},2818:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return u}});var s=a(5893),r=a(7294),n=a(3727),l=a(7497),o=a(5152),d=a.n(o),i=a(4712);let c=d()(()=>Promise.all([a.e(269),a.e(471),a.e(964)]).then(a.bind(a,9963)),{loadableGenerated:{webpack:()=>[9963]},ssr:!1});function u(){var e,t,a,o,d,u,m,x,h;let[f,b]=(0,r.useState)("Iowa City"),[p,g]=(0,r.useState)([]),[v,j]=(0,r.useState)(""),[N,y]=(0,r.useState)("2025-08-01/2025-08-10"),[w,k]=(0,r.useState)(null),[S,C]=(0,r.useState)(!1),[A,I]=(0,r.useState)([]);async function z(){C(!0);try{let e=await fetch("/api/geocode?q=".concat(encodeURIComponent(f)));if(!e.ok)throw Error("Geocode failed");let t=await e.json();g(t.places||[]),i.toast.success("Found places")}catch(e){i.toast.error((null==e?void 0:e.message)||"Geocoding error")}finally{C(!1)}}async function _(){if(!v)return i.toast.error("Please set a bounding box first");C(!0),k(null);try{let e=v.split(",").map(e=>Number(e.trim())),t=await fetch("/api/ingest/fetch",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({bbox:e,date:N,targetSize:1024,palette:"heatmap"})});if(!t.ok)throw Error("NDVI fetch failed");let a=await t.json();k(a),i.toast.success("NDVI fetched successfully")}catch(e){i.toast.error((null==e?void 0:e.message)||"Auto-ingest error")}finally{C(!1)}}let P=(null==w?void 0:w.ndviPng)&&(null==w?void 0:w.bbox)?[{position:[(w.bbox[1]+w.bbox[3])/2,(w.bbox[0]+w.bbox[2])/2],label:"Center of AOI"}]:[];return(0,s.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-emerald-50 to-sky-50",children:[(0,s.jsx)(n.Z,{}),(0,s.jsxs)("main",{className:"max-w-6xl mx-auto p-6",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold mb-1",children:"AgriSense — Auto Ingest"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground mb-4",children:"Search a place, draw an AOI, then click Fetch NDVI — the system will find the best Sentinel-2 scene and calculate NDVI automatically."}),(0,s.jsx)("div",{className:"rounded-lg border bg-card p-4 mb-4",children:(0,s.jsx)(c,{bbox:v?v.split(",").map(Number):void 0,onBboxChange:e=>j(e.join(",")),polygon:A,onPolygonChange:e=>{I(e),function(e){if(!e.length)return;let t=1/0,a=1/0,s=-1/0,r=-1/0;e.forEach(e=>{let[n,l]=e;n<t&&(t=n),n>s&&(s=n),l<a&&(a=l),l>r&&(r=l)}),j("".concat(t,",").concat(a,",").concat(s,",").concat(r))}(e)},ndviPng:null==w?void 0:w.ndviPng,ndviBounds:null==w?void 0:w.bbox,hotspots:P})}),(0,s.jsxs)("div",{className:"rounded-lg border bg-card p-4",children:[(0,s.jsxs)("div",{className:"grid md:grid-cols-3 gap-3 items-end",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-xs text-muted-foreground",children:"Search place"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("input",{className:"border rounded px-2 py-1 w-full",value:f,onChange:e=>b(e.target.value),placeholder:"e.g., Iowa City"}),(0,s.jsx)(l.z,{variant:"secondary",onClick:z,disabled:S,children:S?"Searching…":"Find"})]}),p.length>0&&(0,s.jsx)("div",{className:"mt-2 border rounded bg-background text-sm max-h-48 overflow-auto",children:p.map(e=>(0,s.jsx)("div",{className:"px-2 py-1 hover:bg-accent cursor-pointer",onClick:()=>(function(e){var t;if((null==e?void 0:null===(t=e.bbox)||void 0===t?void 0:t.length)===4){let[t,a,s,r]=e.bbox;j("".concat(s,",").concat(t,",").concat(r,",").concat(a))}g([])})(e),children:e.display_name},e.display_name))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-xs text-muted-foreground",children:"BBox [minx,miny,maxx,maxy]"}),(0,s.jsx)("input",{className:"border rounded px-2 py-1 w-full",value:v,onChange:e=>j(e.target.value),placeholder:"-122.52,37.70,-122.35,37.83"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-xs text-muted-foreground",children:"Date range (ISO/ISO)"}),(0,s.jsx)("input",{className:"border rounded px-2 py-1 w-full",value:N,onChange:e=>y(e.target.value),placeholder:"2025-08-01/2025-08-10"})]})]}),(0,s.jsx)("div",{className:"mt-3",children:(0,s.jsx)(l.z,{onClick:_,disabled:S||!v,children:S?"Fetching…":"Fetch NDVI"})})]}),w&&(0,s.jsxs)("div",{className:"mt-4 rounded-lg border bg-card p-4 text-sm",children:[(0,s.jsx)("div",{className:"font-medium",children:"NDVI Stats"}),(0,s.jsxs)("div",{className:"text-muted-foreground",children:["min ",null===(a=w.ndviStats)||void 0===a?void 0:null===(t=a.min)||void 0===t?void 0:null===(e=t.toFixed)||void 0===e?void 0:e.call(t,2)," • mean"," ",null===(u=w.ndviStats)||void 0===u?void 0:null===(d=u.mean)||void 0===d?void 0:null===(o=d.toFixed)||void 0===o?void 0:o.call(d,2)," • max"," ",null===(h=w.ndviStats)||void 0===h?void 0:null===(x=h.max)||void 0===x?void 0:null===(m=x.toFixed)||void 0===m?void 0:m.call(x,2)]}),w.ndviPng&&(0,s.jsx)("div",{className:"mt-3",children:(0,s.jsx)("img",{src:"data:image/png;base64,".concat(w.ndviPng),alt:"NDVI preview",className:"w-full max-w-xl rounded border"})})]})]})]})}}},function(e){e.O(0,[118,712,888,774,179],function(){return e(e.s=8427)}),_N_E=e.O()}]);