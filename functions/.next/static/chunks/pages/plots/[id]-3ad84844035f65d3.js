(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[333],{9350:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/plots/[id]",function(){return t(4201)}])},5552:function(e,n,t){"use strict";function i(e){let n=(null==e?void 0:e.geojson)||function(e){if("string"!=typeof e)return null;try{let n=JSON.parse(e);if((null==n?void 0:n.type)==="Polygon"&&Array.isArray(null==n?void 0:n.coordinates))return n}catch(e){}return null}(null==e?void 0:e.geojsonText),t=Array.isArray(null==e?void 0:e.bbox)&&4===e.bbox.length?e.bbox:function(e){var n;let t=null==e?void 0:null===(n=e.coordinates)||void 0===n?void 0:n[0];if(!Array.isArray(t)||t.length<4)return null;let i=Number.POSITIVE_INFINITY,s=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY;for(let e of t){if(!Array.isArray(e)||e.length<2)continue;let n=Number(e[0]),t=Number(e[1]);Number.isFinite(n)&&Number.isFinite(t)&&(i=Math.min(i,n),s=Math.min(s,t),r=Math.max(r,n),l=Math.max(l,t))}return Number.isFinite(i)?[i,s,r,l]:null}(n);return{geojson:n||null,bbox:t,grid3x3:Array.isArray(null==e?void 0:e.grid3x3)?e.grid3x3:[]}}t.d(n,{m:function(){return i}})},4201:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return b}});var i=t(5893),s=t(7294),r=t(1163),l=t(1664),a=t.n(l),c=t(2370),d=t(6316),o=t(3945),x=t(5133),u=t(7497),m=t(6394),h=t(8704),p=t(5552),N=t(4712);function b(){var e,n,t,l,b;let{id:f}=(0,r.useRouter)().query,v=m.oy,[g,j]=(0,s.useState)(null),[z,y]=(0,s.useState)(null),[w,I]=(0,s.useState)(null),[S,A]=(0,s.useState)(!0),_=(0,s.useMemo)(()=>(0,p.m)(z||{}),[z]),k=_.bbox;async function F(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:f;if(e&&"string"==typeof n){A(!0);try{let t=await e.getIdToken(!0),i=(await (0,h.k1)(t)).find(e=>e.id===n);if(!i){y(null),A(!1);return}y(i);let s=(0,p.m)(i).bbox;if(s){let e=await fetch("/api/timeseries",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({bbox:s,interval:"weekly"})}),n=await e.json().catch(()=>({}));e.ok&&I(n)}}catch(e){N.toast.error((0,h.$D)(e))}finally{A(!1)}}}return(0,s.useEffect)(()=>{if(!v||!m.I8){A(!1);return}return(0,c.Aj)(m.I8,e=>{if(j(e),!e){A(!1);return}f&&"string"==typeof f&&F(e,f)})},[v,f]),(0,i.jsxs)("div",{className:"min-h-screen",children:[(0,i.jsx)(o.Z,{}),(0,i.jsx)("main",{className:"app-shell py-6",children:(0,i.jsxs)("section",{className:"surface-card p-5",children:[(0,i.jsxs)("div",{className:"mb-4 flex items-center justify-between",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h1",{className:"text-2xl font-semibold text-zinc-900",children:"Plot Detail"}),(0,i.jsx)("p",{className:"mt-1 text-sm text-zinc-600",children:"Snapshot, inference, and historical performance."})]}),(0,i.jsx)(a(),{href:"/plots",children:(0,i.jsx)(u.z,{variant:"outline",children:"Back to plots"})})]}),S&&(0,i.jsxs)("div",{className:"inline-flex items-center gap-2 rounded-xl border border-zinc-200 bg-zinc-50 px-4 py-3 text-sm text-zinc-600",children:[(0,i.jsx)(d.Z,{className:"h-4 w-4 animate-spin"}),"Loading plot"]}),!S&&!v&&(0,i.jsx)("div",{className:"rounded-xl border border-zinc-200 bg-zinc-50 p-4 text-sm text-zinc-600",children:"Firebase Auth is not configured."}),!S&&v&&!g&&(0,i.jsx)("div",{className:"rounded-xl border border-zinc-200 bg-zinc-50 p-4 text-sm text-zinc-600",children:"Sign in to view this plot."}),!S&&g&&!z&&(0,i.jsx)("div",{className:"rounded-xl border border-zinc-200 bg-zinc-50 p-4 text-sm text-zinc-600",children:"Plot not found."}),!S&&z&&(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,i.jsxs)("article",{className:"rounded-2xl border border-zinc-200 bg-white p-4",children:[(0,i.jsx)("p",{className:"text-xs uppercase tracking-wide text-zinc-500",children:"Name"}),(0,i.jsx)("p",{className:"mt-1 text-lg font-semibold text-zinc-900",children:z.name||"Untitled plot"}),(0,i.jsx)("p",{className:"mt-1 text-sm text-zinc-600",children:z.locationName||"Unknown location"}),(0,i.jsxs)("p",{className:"mt-2 text-xs text-zinc-500",children:["Created: ",z.createdAt?new Date(z.createdAt).toLocaleString():"Unknown"]}),(0,i.jsxs)("p",{className:"mt-2 text-xs text-zinc-500",children:["NDVI mean: ","number"==typeof(null==z?void 0:null===(e=z.ndviStats)||void 0===e?void 0:e.mean)?z.ndviStats.mean.toFixed(3):"N/A"]})]}),(0,i.jsxs)("article",{className:"rounded-2xl border border-zinc-200 bg-white p-4",children:[(0,i.jsx)("p",{className:"text-xs uppercase tracking-wide text-zinc-500",children:"Inference summary"}),(0,i.jsx)("p",{className:"mt-1 text-sm text-zinc-700",children:(null==z?void 0:null===(t=z.inferenceSnapshot)||void 0===t?void 0:null===(n=t.summary)||void 0===n?void 0:n.whatChanged)||"No inference snapshot available."}),(0,i.jsxs)("p",{className:"mt-2 text-xs text-zinc-500",children:["Confidence:"," ","number"==typeof(null==z?void 0:null===(l=z.inferenceSnapshot)||void 0===l?void 0:l.confidence)?"".concat(Math.round(100*z.inferenceSnapshot.confidence),"%"):"N/A"]}),k&&(0,i.jsxs)("p",{className:"mt-2 text-xs text-zinc-500",children:["BBox: ",k[0].toFixed(4),", ",k[1].toFixed(4),", ",k[2].toFixed(4),", ",k[3].toFixed(4)]})]})]}),_.grid3x3.length>0&&(0,i.jsxs)("article",{className:"rounded-2xl border border-zinc-200 bg-white p-4",children:[(0,i.jsx)("p",{className:"text-xs uppercase tracking-wide text-zinc-500",children:"Saved 3x3 cell summary"}),(0,i.jsx)("div",{className:"mt-3 grid grid-cols-3 gap-2",children:_.grid3x3.map(e=>(0,i.jsxs)("div",{className:"rounded-lg border border-zinc-200 bg-zinc-50 p-2",children:[(0,i.jsx)("p",{className:"text-[11px] font-semibold text-zinc-700",children:e.cellId}),(0,i.jsxs)("p",{className:"text-xs text-zinc-600",children:["mean ",Number(e.mean||0).toFixed(3)]}),(0,i.jsx)("p",{className:"text-[11px] text-zinc-500",children:e.stressLevel})]},e.cellId))})]}),z.previewPng&&(0,i.jsx)("div",{className:"overflow-hidden rounded-2xl border border-zinc-200 bg-zinc-100",children:(0,i.jsx)("img",{src:"data:image/png;base64,".concat(z.previewPng),alt:z.name||"preview",className:"h-[22rem] w-full object-contain"})}),(0,i.jsxs)("article",{className:"rounded-2xl border border-zinc-200 bg-white p-4",children:[(0,i.jsx)("h2",{className:"text-lg font-semibold text-zinc-900",children:"Historical NDVI"}),(0,i.jsxs)("p",{className:"mt-1 text-sm text-zinc-600",children:[(null==w?void 0:w.source)||"No source"," ",(null==w?void 0:w.isSimulated)?"(simulated)":""]}),(0,i.jsx)("div",{className:"mt-3",children:(0,i.jsx)(x.Z,{data:((null==w?void 0:null===(b=w.data)||void 0===b?void 0:b.timeSeries)||[]).map(e=>({date:e.date,ndvi:Number(e.ndvi),confidence:Number(e.confidence),cloudCover:"number"==typeof e.cloudCover?e.cloudCover:void 0})),title:"Saved plot NDVI trend",showConfidence:!0,showCloudCover:!0})})]})]})]})})]})}},1163:function(e,n,t){e.exports=t(3035)}},function(e){e.O(0,[551,23,712,500,850,888,774,179],function(){return e(e.s=9350)}),_N_E=e.O()}]);