"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[99],{4246:function(e,t,n){n.r(t),n.d(t,{default:function(){return w}});var l=n(5893),r=n(9153),i=n(5715),a=n(943),o=n(2013),u=n(8798),s=n(577),c=n(2604);n(8570),n(3337),n(1787);var d=n(5243),p=n.n(d),m=n(7294),f=n(4049),g=n(9287);function h(e){let t=3*e.row+e.col+1;return"P".concat(t)}function x(e){let{bbox:t,cells:n,cellFootprints:r,selectedCell:i,onSelectCell:a,visible:o=!0}=e;if(!o||!t)return null;let s=function(e){if(Array.isArray(e)&&e.length)return e;let t=[];for(let e=0;e<3;e++)for(let n=0;n<3;n++)t.push({cellId:"".concat(e,"-").concat(n),row:e,col:n,mean:0,min:0,max:0,validPixelRatio:0,stressLevel:"unknown"});return t}(n);return(0,l.jsx)(l.Fragment,{children:s.map(e=>{var n;let o=i===e.cellId,s=Array.isArray(r)?r.find(t=>t.cellId===e.cellId):null,c=function(e){var t,n;let l=null==e?void 0:null===(n=e.polygon)||void 0===n?void 0:null===(t=n.coordinates)||void 0===t?void 0:t[0];if(!Array.isArray(l)||l.length<4)return null;let r=l.map(e=>{let t=Number(null==e?void 0:e[0]),n=Number(null==e?void 0:e[1]);return Number.isFinite(t)&&Number.isFinite(n)?[n,t]:null}).filter(e=>Array.isArray(e)&&2===e.length);return r.length>=4?r:null}(s),d={color:(n=e.stressLevel,o?"#22d3ee":"high"===n?"#dc2626":"moderate"===n?"#d97706":"low"===n?"#15803d":"#64748b"),weight:o?3.2:1.7,opacity:o?.95:.75,fill:!1,fillOpacity:0};return c?(0,l.jsx)(u.m,{positions:c,pathOptions:d,eventHandlers:{click:()=>null==a?void 0:a(e.cellId)},children:(0,l.jsxs)(f.u,{children:["Plot Point ",h(e)," | mean ",e.mean.toFixed(3)," | ",e.stressLevel,"number"==typeof(null==s?void 0:s.coverage)?" | coverage ".concat((100*s.coverage).toFixed(1),"%"):""]})},"grid-map-poly-".concat(e.cellId)):(0,l.jsx)(g.A,{bounds:function(e,t,n){let l=e[0],r=e[1],i=e[2],a=e[3],o=(i-l)/3,u=(a-r)/3;return[[a-u*(t+1),l+o*n],[a-u*t,l+o*(n+1)]]}(t,e.row,e.col),pathOptions:d,eventHandlers:{click:()=>null==a?void 0:a(e.cellId)},children:(0,l.jsxs)(f.u,{children:["Plot Point ",h(e)," | mean ",e.mean.toFixed(3)," | ",e.stressLevel]})},"grid-map-".concat(e.cellId))})})}function v(e,t,n){return Math.max(t,Math.min(n,e))}function y(e){let{enabled:t,metricGrid:n,alignmentBbox:l,onHover:i}=e;return(0,r.zV)({mousemove(e){var r,a;if(!t)return;let o=Number(null===(r=e.latlng)||void 0===r?void 0:r.lat),u=Number(null===(a=e.latlng)||void 0===a?void 0:a.lng);if(!Number.isFinite(o)||!Number.isFinite(u)){i(null);return}let s=function(e,t,n,l){if(!e||!t||!e.width||!e.height||!Array.isArray(e.values))return{pixelX:-1,pixelY:-1,value:null};let[r,i,a,o]=t,u=v((l-r)/Math.max(1e-9,a-r),0,1),s=v((o-n)/Math.max(1e-9,o-i),0,1),c=v(Math.round(u*(e.width-1)),0,e.width-1),d=v(Math.round(s*(e.height-1)),0,e.height-1),p=d*e.width+c,m=Number(e.values[p]);return{pixelX:c,pixelY:d,value:Number.isFinite(m)?m:null}}(n,l,o,u);i({lat:o,lon:u,pixelX:s.pixelX,pixelY:s.pixelY,value:s.value})},mouseout(){i(null)}}),null}function b(e){let{onReady:t}=e,n=(0,r.Sx)();return(0,m.useEffect)(()=>{t(n)},[n,t]),null}function w(e){let{bbox:t,onBboxChange:n,polygon:r,onPolygonChange:d,ndviPng:f,ndviBounds:g,hotspots:h,processedOverlayUrl:v,smoothOverlay:w=!0,overlayOpacity:j=.85,grid3x3:N,cellFootprints:F,selectedCell:A,onSelectCell:E,showGrid:L=!0,debugMode:O=!1,debugMetricGrid:k,debugAlignmentBbox:I,debugResolutionMeters:C,debugCoverage:R,clearAoiSignal:S=0}=e,B=(0,m.useRef)(null),M=(0,m.useRef)(null),z=(0,m.useRef)(null),D=(0,m.useRef)(n),P=(0,m.useRef)(d),[_,G]=(0,m.useState)(!1),[J,U]=(0,m.useState)(null);(0,m.useEffect)(()=>{D.current=n},[n]),(0,m.useEffect)(()=>{P.current=d},[d]),(0,m.useEffect)(()=>{let e=B.current;if(!e||!_||M.current||z.current)return;let t=new(p()).FeatureGroup;M.current=t,e.addLayer(t);let n=new(p()).Control.Draw({draw:{polygon:{shapeOptions:{color:"#16a34a",weight:2,opacity:.95,fill:!1,fillOpacity:0}},rectangle:{shapeOptions:{color:"#16a34a",weight:2,opacity:.95,fill:!1,fillOpacity:0}},polyline:!1,circle:!1,marker:!1,circlemarker:!1},edit:{featureGroup:t}});z.current=n,e.addControl(z.current);let l=e=>{let n=e.layer;if(t.clearLayers(),"function"==typeof(null==n?void 0:n.setStyle)&&n.setStyle({color:"#16a34a",weight:2,opacity:.95,fill:!1,fillOpacity:0}),t.addLayer(n),n.getBounds){let e=n.getBounds(),t=e.getWest(),l=e.getSouth(),r=e.getEast(),i=e.getNorth();D.current&&D.current([t,l,r,i])}if(n.getLatLngs){let e=n.getLatLngs()[0]||[];P.current&&P.current(e)}};return e.on(p().Draw.Event.CREATED,l),()=>{e.off(p().Draw.Event.CREATED,l),z.current&&e.removeControl(z.current),M.current&&e.removeLayer(M.current),z.current=null,M.current=null}},[_]),(0,m.useEffect)(()=>{_&&M.current&&(M.current.clearLayers(),P.current&&P.current([]),U(null))},[S,_]),(0,m.useEffect)(()=>{let e=B.current;if(e)try{if(g&&Array.isArray(g)&&4===g.length){let t=p().latLngBounds([g[1],g[0]],[g[3],g[2]]);e.fitBounds(t,{padding:[20,20]});return}if(t&&Array.isArray(t)&&4===t.length){let n=p().latLngBounds([t[1],t[0]],[t[3],t[2]]);e.fitBounds(n,{padding:[20,20]});return}if(r&&r.length){let t=p().latLngBounds(r);e.fitBounds(t,{padding:[20,20]})}}catch(e){}},[JSON.stringify(g),JSON.stringify(t),JSON.stringify(r)]);let X=i.h,Y=a.v,H=o.I,T=(0,m.useMemo)(()=>v&&v.length?v:f&&f.length?"data:image/png;base64,".concat(f):null,[v,f]);(0,m.useEffect)(()=>{let e="leaflet-image-overlay-css";if(document.getElementById(e))return;let t=document.createElement("style");return t.id=e,t.textContent="\n      .leaflet-image-smooth {\n        image-rendering: auto !important;\n        -ms-interpolation-mode: bicubic !important;\n        image-rendering: -webkit-optimize-contrast !important;\n        will-change: transform;\n      }\n      .leaflet-image-precision {\n        image-rendering: pixelated !important;\n        image-rendering: crisp-edges !important;\n        -ms-interpolation-mode: nearest-neighbor !important;\n        will-change: transform;\n      }\n    ",document.head.appendChild(t),()=>{}},[]);let V=g&&4===g.length?[[g[1],g[0]],[g[3],g[2]]]:null,W=T&&V?(0,l.jsx)(Y,{url:T,bounds:V,opacity:j,crossOrigin:"anonymous",className:w?"leaflet-image-smooth":"leaflet-image-precision",style:{imageRendering:w?"auto":"pixelated",transform:"translateZ(0)"}}):null,Z=(0,m.useCallback)(e=>{B.current=e,G(!0)},[]);return(0,l.jsxs)("div",{className:"relative h-full w-full",children:[(0,l.jsxs)(X,{ref:B,center:[40,-95],zoom:5,style:{height:"100%",width:"100%",borderRadius:12,overflow:"hidden",zIndex:0},children:[(0,l.jsx)(b,{onReady:Z}),(0,l.jsx)(H,{attribution:"\xa9 OpenStreetMap contributors",url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),(0,l.jsx)(y,{enabled:!!O,metricGrid:k,alignmentBbox:I||g||t||null,onHover:U}),W,(0,l.jsx)(x,{bbox:g||t,cells:N,cellFootprints:F,selectedCell:A,onSelectCell:E,visible:!!(L&&(g||t))}),r&&r.length>0&&(0,l.jsx)(u.m,{positions:r,pathOptions:{color:"#16a34a",weight:2}}),(h||[]).map((e,t)=>(0,l.jsx)(s.J,{position:e.position,children:(0,l.jsx)(c.G,{children:e.label})},t))]}),O&&(0,l.jsx)("div",{className:"pointer-events-none absolute left-3 top-3 z-[500] rounded-lg border border-zinc-300/80 bg-white/90 px-2 py-1 text-[11px] font-medium text-zinc-800 shadow-sm backdrop-blur-sm",children:J?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("p",{children:["lat/lon: ",J.lat.toFixed(6),", ",J.lon.toFixed(6)]}),(0,l.jsxs)("p",{children:["px: ",J.pixelX,", ",J.pixelY]}),(0,l.jsxs)("p",{children:["value:"," ","number"==typeof J.value&&Number.isFinite(J.value)?J.value.toFixed(4):"n/a"]}),"number"==typeof C&&Number.isFinite(C)&&(0,l.jsxs)("p",{children:["resolution: ~",C.toFixed(2),"m/pixel"]}),"number"==typeof R&&Number.isFinite(R)&&(0,l.jsxs)("p",{children:["AOI coverage: ",(100*R).toFixed(1),"%"]})]}):(0,l.jsx)("p",{children:"Move cursor to inspect raster sample"})})]})}delete p().Icon.Default.prototype._getIconUrl,p().Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png"})}}]);