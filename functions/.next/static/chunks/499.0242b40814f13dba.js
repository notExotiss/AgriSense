"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[499],{8499:function(e,t,i){i.r(t),i.d(t,{default:function(){return v}});var n=i(5893),l=i(7294),a=i(4250),o=i(9477),r=i(9365);let s=(0,i(1373).Z)("mountain",[["path",{d:"m8 3 4 8 5-5 5 15H2L8 3z",key:"otkl63"}]]);var d=i(6316),u=i(8098),c=i(8625);function h(e,t){if(!e.length)return 0;if(1===e.length)return e[0];let i=(e.length-1)*(0,u.uZ)(t,0,1),n=Math.floor(i),l=Math.ceil(i);return n===l?e[n]:(0,u.t7)(e[n],e[l],i-n)}function m(e){if(!e||!e.includes("-"))return null;let[t,i]=e.split("-"),n=Number(t),l=Number(i);return Number.isFinite(n)&&Number.isFinite(l)?{row:n,col:l}:null}function p(e,t,i,n,l){let a=(0,u.uZ)(n,0,1)*(t-1),o=(0,u.uZ)(l,0,1)*(i-1),r=Math.floor(a),s=Math.floor(o),d=Math.min(t-1,r+1),c=Math.min(i-1,s+1),h=a-r,m=(0,u.t7)(e[s*t+r],e[s*t+d],h),p=(0,u.t7)(e[c*t+r],e[c*t+d],h);return(0,u.t7)(m,p,o-s)}function f(e){return"soil"===e?"Soil Moisture":"et"===e?"Evapotranspiration":"NDVI"}function v(e){var t,i,v,g;let{open:x,bbox:w,geometry:b,alignmentBbox:y,cellFootprints:M,texturePng:S,metricGrid:N,layer:j,selectedCell:_}=e,A=(0,l.useRef)(null),[D,k]=(0,l.useState)(!1),[I,T]=(0,l.useState)(null),[F,R]=(0,l.useState)(null),[E,P]=(0,l.useState)(null),[C,W]=(0,l.useState)(null),Z=(0,l.useMemo)(()=>m(_),[_]),H=(0,l.useMemo)(()=>(function(e){let t=m(e);return t?"P".concat(3*t.row+t.col+1):null})(_),[_]),O=(0,l.useMemo)(()=>!!(N&&Array.isArray(N.values)&&N.width>1&&N.height>1&&N.values.length>=N.width*N.height),[N]),[z,K]=(0,l.useState)(()=>"undefined"!=typeof document&&document.documentElement.classList.contains("dark"));return((0,l.useEffect)(()=>{if("undefined"==typeof document)return;let e=document.documentElement,t=()=>K(e.classList.contains("dark"));t();let i=new MutationObserver(t);return i.observe(e,{attributes:!0,attributeFilter:["class"]}),()=>i.disconnect()},[]),(0,l.useEffect)(()=>{if(!x||!w)return;let e=new AbortController,t=[224,192,160,128];return async function(){k(!0),T(null),R(null);try{let c="Terrain fetch failed";for(let h of t){var i,n,l,a,o,r,s,d,u;let t=await fetch("/api/terrain/fetch",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({bbox:w,geometry:b||null,resolution:h,layer:j}),signal:e.signal}),m=await t.json().catch(()=>({}));if(!t.ok||!(null==m?void 0:m.success)){c=String((null==m?void 0:m.message)||(null==m?void 0:m.error)||"Terrain fetch failed (".concat(t.status,")"));continue}let p=!!(null==m?void 0:m.degraded),f=null==m?void 0:m.data,v=f&&Array.isArray(f.demGrid)&&f.demGrid.length>0&&Number(f.width)>1&&Number(f.height)>1;if(p||!v){c=String((null==m?void 0:null===(l=m.warnings)||void 0===l?void 0:l[0])||(null==m?void 0:m.reason)||"Terrain unavailable for the selected AOI.");continue}R({...f,demSource:(null==f?void 0:f.demSource)||(null==m?void 0:m.demSource)||(null==f?void 0:f.source)||(null==m?void 0:m.source),demDataset:(null==f?void 0:f.demDataset)||(null==m?void 0:m.demDataset),modelType:(null==f?void 0:f.modelType)||(null==m?void 0:m.modelType),verticalDatum:(null==f?void 0:f.verticalDatum)||(null==m?void 0:m.verticalDatum),sourceResolutionMeters:null!==(o=null!==(a=null==f?void 0:f.sourceResolutionMeters)&&void 0!==a?a:null==m?void 0:m.sourceResolutionMeters)&&void 0!==o?o:null==f?void 0:f.providerResolutionMeters,effectiveResolutionMeters:null!==(s=null!==(r=null==f?void 0:f.effectiveResolutionMeters)&&void 0!==r?r:null==m?void 0:m.effectiveResolutionMeters)&&void 0!==s?s:null==f?void 0:f.pixelSizeMeters,precisionClass:(null==f?void 0:f.precisionClass)||(null==m?void 0:m.precisionClass),voidFillRatio:null!==(d=null==f?void 0:f.voidFillRatio)&&void 0!==d?d:null==m?void 0:m.voidFillRatio,zStats:(null==f?void 0:f.zStats)||(null==m?void 0:m.zStats)}),P({smoothed:!!(null===(u=null==m?void 0:null===(i=m.meshMeta)||void 0===i?void 0:i.smoothed)||void 0===u||u),resolution:Number((null==m?void 0:null===(n=m.meshMeta)||void 0===n?void 0:n.resolution)||h)}),T(null);return}R(null),T(c)}catch(t){if(e.signal.aborted)return;R(null),T(String((null==t?void 0:t.message)||"Terrain fetch failed"))}finally{e.signal.aborted||k(!1)}}(),()=>e.abort()},[x,j,null==w?void 0:w.join(","),JSON.stringify(b||null)]),(0,l.useEffect)(()=>{if(!x||!A.current||!F||!Array.isArray(F.demGrid)||0===F.demGrid.length||F.width<2||F.height<2)return;let e=A.current,t=new a.xsS,i=e.clientWidth||1e3,n=e.clientHeight||420,l=new a.cPb(48,i/n,.1,1400);l.position.set(0,84,136);let s=new o.CP7({antialias:!0,alpha:!0});s.setSize(i,n),s.setPixelRatio(Math.min(2,window.devicePixelRatio||1)),s.outputColorSpace=a.KI_,s.toneMapping=a.LY2,s.toneMappingExposure=1.02,s.setClearColor(0,0),e.innerHTML="",e.appendChild(s.domElement);let d=new r.z(l,s.domElement);d.enableDamping=!0,d.dampingFactor=.08,d.maxPolarAngle=Math.PI/2.45,d.minDistance=24,d.maxDistance=520,d.minPolarAngle=.22,d.target.set(0,0,0),t.add(new a.Mig(16777215,z?.74:.66));let m=new a.Ox3(16055295,z?1.12:1.04);m.position.set(130,142,60),t.add(m);let f=new a.Ox3(z?9483519:10664920,z?.5:.42);f.position.set(-120,84,-120),t.add(f);let v=function(e){let t=e.demGrid.filter(e=>Number.isFinite(e)).sort((e,t)=>e-t);if(!t.length)throw Error("dem_no_finite_values");let i=h(t,.005),n=h(t,.995),l=Math.min(i,n),a=Math.max(i,n),o=Math.max(.25,a-l),{planeWidth:r,planeHeight:s,span:d}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:120,i=function(e){let t=Math.abs(e[2]-e[0]),i=Math.abs(e[3]-e[1]);return{xMeters:Math.max(1,t*Math.max(1,111320*Math.cos((e[1]+e[3])/2*(Math.PI/180)))),yMeters:Math.max(1,111320*i)}}(e),n=i.xMeters/Math.max(1,i.yMeters);return n>=1?{planeWidth:t,planeHeight:(0,u.uZ)(t/n,.42*t,t),span:i}:{planeWidth:(0,u.uZ)(t*n,.42*t,t),planeHeight:t,span:i}}(e.bbox,120),c=Math.max(1e-6,Math.max(d.xMeters/r,d.yMeters/s)),m=Math.min(r,s),p=Math.max(.05,o/c),f=1.12;if(p>=.18*m)f=1;else if(p>=.12*m)f=1.08;else{let e=(0,u.uZ)(.22*m,14,36);f=(0,u.uZ)(e/p,1.15,o>=1200?14:o>=400?12:o>=120?10:8)}p<.35?f=Math.max(f,6.5):p<.7&&(f=Math.max(f,4.2));let v=new Float32Array(e.width*e.height),g=0;for(let t=0;t<v.length;t++){let i=Number(e.demGrid[t]),n=Number.isFinite(i)?i:l,o=((0,u.uZ)(n,l,a)-l)/c*f;v[t]=o,o>g&&(g=o)}return{planeWidth:r,planeHeight:s,scaledHeight:v,elevationScale:Math.max(1.25,g),reliefMeters:o,exaggeration:f,clippedMin:l,clippedMax:a,metersPerUnit:c}}({demGrid:Array.from(function(e,t,i,n){let l=t*i,a=new Float32Array(l);for(let t=0;t<l;t++){let i=Number(e[t]);a[t]=Number.isFinite(i)?i:0}if(n<=0||t<3||i<3)return a;let{min:o,max:r}=function(e){let t=e.filter(e=>Number.isFinite(e)),i=t.length?Math.min(...t):0,n=t.length?Math.max(...t):1,l=Math.max(1e-6,n-i);return{min:i,max:n,range:l,apply:e=>(e-i)/l}}(Array.from(a)),s=Math.max(.5,(r-o)*.18),d=a;for(let e=0;e<n;e++){let e=new Float32Array(l),n=new Float32Array(l);for(let n=0;n<i;n++)for(let i=0;i<t;i++){let l=n*t+i,a=d[n*t+Math.max(0,i-1)],o=d[l],r=d[n*t+Math.min(t-1,i+1)];e[l]=.2*a+.6*o+.2*r}for(let l=0;l<i;l++)for(let o=0;o<t;o++){let r=l*t+o,d=.2*e[Math.max(0,l-1)*t+o]+.6*e[r]+.2*e[Math.min(i-1,l+1)*t+o],c=a[r];n[r]=(0,u.uZ)(d,c-s,c+s)}d=n}return d}(F.demGrid,F.width,F.height,0)),width:F.width,height:F.height,bbox:F.bbox}),g=v.planeWidth,w=v.planeHeight,b=v.scaledHeight,S=v.elevationScale,_=v.elevationScale,D=Math.max(g,w),k=Math.min(g,w),I=(0,u.uZ)(.3*S,2.4,34),T=(0,u.uZ)(.92*D,56,300),R=(0,u.uZ)(Math.max(.46*D,I+2.4*S),38,170);l.position.set(0,R,T),d.target.set(0,I,0),d.minDistance=(0,u.uZ)(.5*k,24,160),d.maxDistance=(0,u.uZ)(3.2*D,150,620),d.update();let E=new a._12(g,w,F.width-1,F.height-1),P=E.attributes.position;for(let e=0;e<b.length;e++)P.setZ(e,b[e]);P.needsUpdate=!0,E.computeVertexNormals();let C=new a.Wid({color:z?6254983:9674926,metalness:.03,roughness:.9}),K=new a.Kj0(E,C);K.rotation.x=-Math.PI/2,t.add(K);let L=new a.vBJ({color:16777215,transparent:!0,opacity:.96,side:a.ehD}),U=new a.Kj0(E,L);U.rotation.x=-Math.PI/2,U.position.y=.18,t.add(U);let q=new a.ejS(new a.Uk6(E),new a.nls({color:z?10072008:2768466,transparent:!0,opacity:z?.14:.1}));q.rotation.x=-Math.PI/2,t.add(q);let G=v.reliefMeters/Math.max(1e-6,v.metersPerUnit)*.08,V=-(0,u.uZ)(G,.28,1.2),Q=(e,t)=>p(b,F.width,F.height,e,t),J=new a.Wid({color:z?5796494:9216951,roughness:.92,metalness:.01,side:a.ehD,transparent:!1,opacity:1}),B=[];for(let e of["north","south","west","east"]){let i="north"===e||"south"===e?F.width-1:F.height-1,n=function(e,t,i,n,l,o){let r=[],s=[],d=[];for(let a=0;a<=t;a++){let d=a/Math.max(1,t),u=d,c=d;"north"===e?(u=d,c=0):"south"===e?(u=d,c=1):(u="west"===e?0:1,c=d);let h=-n/2+u*n,m=-l/2+c*l,p=i(u,c)+.04,f=h,v=m;"north"===e&&(v-=2.6),"south"===e&&(v+=2.6),"west"===e&&(f-=2.6),"east"===e&&(f+=2.6),r.push(h,p,m),r.push(f,o,v),s.push(u,c),s.push(u,c)}for(let e=0;e<t;e++){let t=2*e;d.push(t,t+1,t+2),d.push(t+1,t+3,t+2)}let u=new a.u9r;return u.setAttribute("position",new a.a$l(r,3)),u.setAttribute("uv",new a.a$l(s,2)),u.setIndex(d),u.computeVertexNormals(),u}(e,i,Q,g,w,V),l=new a.Kj0(n,J);t.add(l),B.push(l)}let $=new a._12(g,w),Y=new a.Wid({color:z?4679814:10335946,roughness:.94,metalness:0,side:a.ehD,transparent:!1,opacity:1}),X=new a.Kj0($,Y);X.rotation.x=-Math.PI/2,X.position.y=V,t.add(X);let ee=function(e){let t="high"===e.quality?.032:"balanced"===e.quality?.03:.028,i="high"===e.quality?18:"balanced"===e.quality?16:14;return new a.jyz({uniforms:{uMaxHeight:{value:e.maxHeight},uDensity:{value:(0,u.uZ)(i+1.2*e.reliefUnits,12,34)},uThickness:{value:t},uOpacity:{value:e.isDarkTheme?.32:.27},uLineColor:{value:new a.Ilk(e.isDarkTheme?2044745:5203839)}},vertexShader:"\n      varying float vHeight;\n      uniform float uMaxHeight;\n      void main() {\n        vHeight = max(0.0, position.z / max(uMaxHeight, 0.001));\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n      }\n    ",fragmentShader:"\n      varying float vHeight;\n      uniform float uDensity;\n      uniform float uThickness;\n      uniform float uOpacity;\n      uniform vec3 uLineColor;\n      void main() {\n        float f = fract(vHeight * uDensity);\n        float d = min(f, 1.0 - f);\n        float aa = fwidth(vHeight * uDensity) * 0.9;\n        float line = 1.0 - smoothstep(uThickness, uThickness + aa, d);\n        gl_FragColor = vec4(uLineColor, line * uOpacity);\n      }\n    ",transparent:!0,depthWrite:!1})}({maxHeight:S,reliefUnits:_,isDarkTheme:z,quality:"balanced"}),et=new a.Kj0(E,ee);et.rotation.x=-Math.PI/2,et.position.y=.26,t.add(et);let ei=[],en=!1,el=null,ea=null;O||W(null),(async()=>{if(O)try{let e=await function(e,t,i,n){if(!e)throw Error("metric_grid_missing");let l=(0,c.a8)({metric:t,grid:{values:e.values,validMask:e.validMask,width:e.width,height:e.height,min:e.min,max:e.max},outputWidth:i,outputHeight:n,contours:!1}),o=new a.ROQ(l.canvas);o.colorSpace=a.KI_,o.wrapS=a.uWy,o.wrapT=a.uWy,o.needsUpdate=!0;let r=document.createElement("canvas");r.width=l.canvas.width,r.height=l.canvas.height;let s=r.getContext("2d");if(!s)throw Error("opaque_metric_canvas_failed");s.drawImage(l.canvas,0,0);let d=s.getImageData(0,0,r.width,r.height),h=d.data,m=(0,u.TU)(t,.5);for(let e=0;e<r.height;e++){let t=m[0],i=m[1],n=m[2];for(let l=0;l<r.width;l++){let a=(e*r.width+l)*4;if(h[a+3]>0){t=h[a],i=h[a+1],n=h[a+2],h[a+3]=255;continue}h[a]=t,h[a+1]=i,h[a+2]=n,h[a+3]=255}}s.putImageData(d,0,0);let p=new a.ROQ(r);return p.colorSpace=a.KI_,p.wrapS=a.uWy,p.wrapT=a.uWy,p.needsUpdate=!0,{texture:o,opaqueTexture:p,range:l.range}}(N,j,F.width,F.height);if(en){e.texture.dispose();return}let t=s.capabilities.getMaxAnisotropy();el=e.texture,ea=e.opaqueTexture,el.anisotropy=Math.max(2,Math.min(t,16)),ea.anisotropy=Math.max(2,Math.min(t,16)),L.map=el,L.needsUpdate=!0,J.map=ea,J.needsUpdate=!0,Y.map=ea,Y.needsUpdate=!0,W(e.range)}catch(e){W(null)}})();let eo=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=-g/2+e*g,l=-w/2+t*w,o=p(b,F.width,F.height,e,t)+i;return new a.Pa4(n,o,l)},er=(e,i)=>{var n,l,o;if(!Array.isArray(e)||e.length<3)return null;let r=e.map(e=>{var t;return eo(e.u,e.v,null!==(t=null==i?void 0:i.lift)&&void 0!==t?t:.18)}),s=new a.u9r().setFromPoints(r),d=new a.nls({color:null!==(n=null==i?void 0:i.color)&&void 0!==n?n:z?14083583:2046546,transparent:!0,opacity:null!==(l=null==i?void 0:i.opacity)&&void 0!==l?l:z?.76:.6,linewidth:null!==(o=null==i?void 0:i.lineWidth)&&void 0!==o?o:1,depthTest:!1,depthWrite:!1}),u=new a.blk(s,d);return t.add(u),ei.push(()=>{s.dispose(),d.dispose()}),u},es=y||F.bbox,ed=new Map;if(Array.isArray(M)&&M.length)for(let e of M){let t=function(e,t){var i,n;let l=null==e?void 0:null===(n=e.polygon)||void 0===n?void 0:null===(i=n.coordinates)||void 0===i?void 0:i[0];if(!Array.isArray(l)||l.length<4)return[];let a=[];for(let e of l){let i=Number(null==e?void 0:e[0]),n=Number(null==e?void 0:e[1]);Number.isFinite(i)&&Number.isFinite(n)&&a.push({u:(0,u.uZ)((i-t[0])/Math.max(1e-9,t[2]-t[0]),0,1),v:(0,u.uZ)((t[3]-n)/Math.max(1e-9,t[3]-t[1]),0,1)})}return a.length>=4?a:[]}(e,es);t.length>=4&&ed.set(e.cellId,t)}let eu=(e,t)=>[{u:t/3,v:e/3},{u:(t+1)/3,v:e/3},{u:(t+1)/3,v:(e+1)/3},{u:t/3,v:(e+1)/3}],ec=new Map,eh=ed.size>0;for(let e=0;e<3;e++)for(let t=0;t<3;t++){let i="".concat(e,"-").concat(t),n=ed.get(i);if(eh){n&&n.length>=3&&ec.set(i,n);continue}ec.set(i,n||eu(e,t))}for(let e of Array.from(ec.values()))er(e,{color:z?12705279:2576498,opacity:z?.74:.62,lift:.26});if(Z){let e="".concat(Z.row,"-").concat(Z.col),i=ec.get(e);if(!i||i.length<3);else{for(let e of(er(i,{color:9434367,opacity:1,lift:.38}),er(i,{color:16773772,opacity:.86,lift:.48}),i.length>8?i.filter((e,t)=>t%Math.ceil(i.length/8)==0):i)){let i=eo(e.u,e.v,.4),n=i.clone();n.y+=2.8;let l=new a.fHI(.09,.09,2.8,10),o=new a.Wid({color:10875900,emissive:947344,emissiveIntensity:.6,roughness:.35}),r=new a.Kj0(l,o);r.position.set(i.x,(i.y+n.y)/2,i.z),t.add(r);let s=function(e){let t=document.createElement("canvas");t.width=64,t.height=64;let i=t.getContext("2d");if(!i)return null;i.clearRect(0,0,64,64),i.fillStyle=e,i.beginPath(),i.arc(32,32,11,0,2*Math.PI),i.fill(),i.strokeStyle="rgba(255,255,255,0.96)",i.lineWidth=4,i.stroke();let n=new a.ROQ(t);n.colorSpace=a.KI_;let l=new a.xeV({map:n,transparent:!0,depthTest:!1,depthWrite:!1}),o=new a.jyi(l);return o.scale.set(1.6,1.6,1),{sprite:o,texture:n,material:l}}("#67e8f9");s&&(s.sprite.position.set(n.x,n.y,n.z),t.add(s.sprite),ei.push(()=>{s.texture.dispose(),s.material.dispose()})),ei.push(()=>{l.dispose(),o.dispose()})}if(H){let e=eo(i.reduce((e,t)=>e+t.u,0)/Math.max(1,i.length),i.reduce((e,t)=>e+t.v,0)/Math.max(1,i.length),4.2),n=function(e){let t=document.createElement("canvas");t.width=256,t.height=80;let i=t.getContext("2d");if(!i)return null;i.clearRect(0,0,t.width,t.height),i.fillStyle="rgba(6, 11, 24, 0.82)",i.fillRect(8,12,240,56),i.strokeStyle="rgba(56, 189, 248, 0.95)",i.lineWidth=3,i.strokeRect(8,12,240,56),i.fillStyle="#e2f5ff",i.font='600 34px "IBM Plex Sans", sans-serif',i.textAlign="center",i.textBaseline="middle",i.fillText(e,t.width/2,t.height/2);let n=new a.ROQ(t);n.colorSpace=a.KI_;let l=new a.xeV({map:n,transparent:!0,depthTest:!1,depthWrite:!1}),o=new a.jyi(l);return o.scale.set(14,4.4,1),{sprite:o,texture:n,material:l}}(H);n&&(n.sprite.position.set(e.x,e.y,e.z),t.add(n.sprite),ei.push(()=>{n.texture.dispose(),n.material.dispose()}))}}}let em=!0,ep=()=>{em&&(d.update(),s.render(t,l),requestAnimationFrame(ep))};ep();let ef=()=>{let t=e.clientWidth||1e3,i=e.clientHeight||420;l.aspect=t/i,l.updateProjectionMatrix(),s.setSize(t,i)};return window.addEventListener("resize",ef),()=>{en=!0,em=!1,window.removeEventListener("resize",ef),d.dispose(),E.dispose(),q.geometry.dispose(),q.material.dispose(),C.dispose(),L.dispose(),ee.dispose(),B.forEach(e=>e.geometry.dispose()),J.dispose(),$.dispose(),Y.dispose(),null==el||el.dispose(),null==ea||ea.dispose(),ei.forEach(e=>e()),s.dispose(),s.domElement.parentNode===e&&e.removeChild(s.domElement)}},[x,F,N,_,j,H,z,O,null==y?void 0:y.join(","),JSON.stringify(M||[])]),x)?(0,n.jsxs)("div",{className:"rounded-2xl border border-border bg-card p-3 text-foreground",children:[(0,n.jsxs)("div",{className:"mb-2 flex items-center justify-between",children:[(0,n.jsxs)("p",{className:"flex items-center gap-2 text-sm font-semibold",children:[(0,n.jsx)(s,{className:"h-4 w-4 text-sky-300"}),"3D Terrain Viewer"]}),(0,n.jsxs)("div",{className:"text-right text-xs text-muted-foreground",children:[(0,n.jsxs)("p",{children:["Metric: ",f(j)," | ",(null==F?void 0:F.demSource)||(null==F?void 0:F.source)||"loading terrain"]}),(0,n.jsxs)("p",{children:[(null==F?void 0:F.modelType)||"n/a"," | ",(null==F?void 0:F.demDataset)||"n/a",(null==F?void 0:F.effectiveResolutionMeters)?" | ~".concat(F.effectiveResolutionMeters.toFixed(1),"m/pixel"):""]})]})]}),(null==F?void 0:F.precisionClass)==="low"&&(0,n.jsx)("div",{className:"mb-2 rounded-lg border border-amber-700/60 bg-amber-500/10 px-2 py-1 text-xs text-amber-800 dark:text-amber-300",children:"Precision warning: DEM resolution is coarse for strict plot-level relief certainty in this AOI."}),D&&(0,n.jsxs)("div",{className:"mb-2 inline-flex items-center gap-2 rounded-lg border border-border px-2 py-1 text-xs text-muted-foreground",children:[(0,n.jsx)(d.Z,{className:"h-3.5 w-3.5 animate-spin"}),"Loading DEM for selected AOI"]}),I&&(0,n.jsx)("div",{className:"mb-2 rounded-lg border border-rose-700/60 bg-rose-500/10 px-2 py-1 text-xs text-rose-700 dark:text-rose-300",children:I}),!O&&(0,n.jsxs)("div",{className:"mb-2 rounded-lg border border-amber-700/50 bg-amber-500/10 px-2 py-1 text-xs text-amber-800 dark:text-amber-300",children:["Quantitative ",f(j)," grid is unavailable for this run, so numeric color overlay is disabled."]}),(0,n.jsx)("div",{ref:A,className:"h-[24rem] w-full overflow-hidden rounded-xl border border-border/70 ".concat(z?"bg-[radial-gradient(120%_100%_at_20%_0%,rgba(22,101,139,0.35)_0%,rgba(6,24,44,0.92)_52%,rgba(4,13,27,0.98)_100%)]":"bg-[radial-gradient(120%_100%_at_15%_0%,rgba(186,230,253,0.9)_0%,rgba(224,242,254,0.76)_45%,rgba(214,226,236,0.94)_100%)]")}),(0,n.jsxs)("div",{className:"mt-2 rounded-lg border border-border/80 bg-muted/35 p-2",children:[(0,n.jsxs)("p",{className:"text-[11px] uppercase tracking-[0.14em] text-muted-foreground",children:[f(j)," scale ",O?(null==N?void 0:N.isSimulated)?"(simulated)":"(measured)":"(unavailable)"]}),(0,n.jsx)("div",{className:"mt-1 h-3 w-full rounded",style:{backgroundImage:(0,u.G5)(j)}}),(0,n.jsxs)("div",{className:"mt-1 flex items-center justify-between text-[11px] text-muted-foreground",children:[(0,n.jsx)("span",{children:O?(null!==(i=null!==(t=null==C?void 0:C.min)&&void 0!==t?t:null==N?void 0:N.min)&&void 0!==i?i:0).toFixed(3):"N/A"}),(0,n.jsx)("span",{children:(null==N?void 0:N.units)?N.units:"soil"===j?"m3/m3":"et"===j?"mm/day":"NDVI"}),(0,n.jsx)("span",{children:O?(null!==(g=null!==(v=null==C?void 0:C.max)&&void 0!==v?v:null==N?void 0:N.max)&&void 0!==g?g:1).toFixed(3):"N/A"})]})]}),(0,n.jsx)("p",{className:"mt-2 text-[11px] text-muted-foreground",children:F?"Topographic surface uses ".concat(F.modelType||"DTM"," elevation from ").concat(F.demSource||F.source).concat(F.demDataset?" (".concat(F.demDataset,")"):""," with ").concat(f(j)," color mapping from ").concat(O?"quantitative grid data":"neutral fallback shading",". Selected plot point: ").concat(H||"none").concat(E?" | mesh ".concat(E.resolution,"px").concat(E.smoothed?", smoothed":""):"").concat(F.sourceResolutionMeters?" | source ~".concat(F.sourceResolutionMeters.toFixed(1),"m"):"").concat(F.effectiveResolutionMeters?" | effective ~".concat(F.effectiveResolutionMeters.toFixed(1),"m"):"").concat(F.verticalDatum?" | datum ".concat(F.verticalDatum):"").concat("number"==typeof F.coverage?" | AOI cover ".concat((100*F.coverage).toFixed(1),"%"):"").concat("number"==typeof F.voidFillRatio?" | void fill ".concat((100*F.voidFillRatio).toFixed(1),"%"):"","."):"Terrain will appear when providers return valid DEM coverage for this AOI."})]}):null}}}]);