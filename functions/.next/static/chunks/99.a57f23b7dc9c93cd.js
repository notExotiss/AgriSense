"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[99],{4246:function(e,t,n){n.r(t),n.d(t,{default:function(){return p}});var r=n(5893),l=n(5715),o=n(943),a=n(2013),i=n(8798),s=n(577),c=n(2604);n(8570),n(3337),n(1787);var u=n(5243),d=n.n(u),g=n(7294),m=n(9287),f=n(4049);function h(e){let{bbox:t,cells:n,selectedCell:l,onSelectCell:o,visible:a=!0}=e;if(!a||!t)return null;let i=function(e){if(Array.isArray(e)&&e.length)return e;let t=[];for(let e=0;e<3;e++)for(let n=0;n<3;n++)t.push({cellId:"".concat(e,"-").concat(n),row:e,col:n,mean:0,min:0,max:0,validPixelRatio:0,stressLevel:"unknown"});return t}(n);return(0,r.jsx)(r.Fragment,{children:i.map(e=>{var n;let a=l===e.cellId;return(0,r.jsx)(m.A,{bounds:function(e,t,n){let r=e[0],l=e[1],o=e[2],a=e[3],i=(o-r)/3,s=(a-l)/3;return[[a-s*(t+1),r+i*n],[a-s*t,r+i*(n+1)]]}(t,e.row,e.col),pathOptions:{color:(n=e.stressLevel,a?"#22d3ee":"high"===n?"#dc2626":"moderate"===n?"#d97706":"low"===n?"#15803d":"#64748b"),weight:a?3.2:1.7,opacity:a?.95:.75,fillOpacity:a?.24:.1},eventHandlers:{click:()=>null==o?void 0:o(e.cellId)},children:(0,r.jsxs)(f.u,{children:["Plot Point ",function(e){let t=3*e.row+e.col+1;return"P".concat(t)}(e)," | mean ",e.mean.toFixed(3)," | ",e.stressLevel]})},"grid-map-".concat(e.cellId))})})}function p(e){let{bbox:t,onBboxChange:n,polygon:u,onPolygonChange:m,ndviPng:f,ndviBounds:p,hotspots:y,processedOverlayUrl:x,smoothOverlay:b=!0,overlayOpacity:w=.85,grid3x3:j,selectedCell:v,onSelectCell:k,showGrid:L=!0}=e,E=(0,g.useRef)(null);(0,g.useEffect)(()=>{let e=E.current;if(!e)return;let t=new(d()).FeatureGroup;e.addLayer(t);let r=new(d()).Control.Draw({draw:{polygon:!0,rectangle:!0,polyline:!1,circle:!1,marker:!1,circlemarker:!1},edit:{featureGroup:t}});return e.addControl(r),e.on(d().Draw.Event.CREATED,e=>{let r=e.layer;if(t.addLayer(r),r.getBounds){let e=r.getBounds(),t=e.getWest(),l=e.getSouth(),o=e.getEast(),a=e.getNorth();n&&n([t,l,o,a])}if(r.getLatLngs){let e=r.getLatLngs()[0]||[];m&&m(e)}}),()=>{e.removeControl(r),e.removeLayer(t)}},[E.current]),(0,g.useEffect)(()=>{let e=E.current;if(e)try{if(p&&Array.isArray(p)&&4===p.length){let t=d().latLngBounds([p[1],p[0]],[p[3],p[2]]);e.fitBounds(t,{padding:[20,20]});return}if(t&&Array.isArray(t)&&4===t.length){let n=d().latLngBounds([t[1],t[0]],[t[3],t[2]]);e.fitBounds(n,{padding:[20,20]});return}if(u&&u.length){let t=d().latLngBounds(u);e.fitBounds(t,{padding:[20,20]})}}catch(e){}},[JSON.stringify(p),JSON.stringify(t),JSON.stringify(u)]);let I=l.h,C=o.v,B=a.I,O=(0,g.useMemo)(()=>x&&x.length?x:f&&f.length?"data:image/png;base64,".concat(f):null,[x,f]);(0,g.useEffect)(()=>{if(!b)return;let e="leaflet-image-smooth-css";if(document.getElementById(e))return;let t=document.createElement("style");return t.id=e,t.textContent="\n      .leaflet-image-smooth {\n        image-rendering: auto !important;\n        -ms-interpolation-mode: bicubic !important; /* IE */\n        image-rendering: -webkit-optimize-contrast !important;\n        will-change: transform;\n      }\n      .leaflet-image-smooth.smooth-filter {\n        filter: blur(0.7px) contrast(0.98) saturate(1.05);\n        /* slight blur to remove thin spiky lines, small contrast/saturation tweak */\n      }\n    ",document.head.appendChild(t),()=>{}},[b]);let A=p&&4===p.length?[[p[1],p[0]],[p[3],p[2]]]:null,N=O&&A?(0,r.jsx)(C,{url:O,bounds:A,opacity:w,crossOrigin:"anonymous",className:"leaflet-image-smooth ".concat(b?"smooth-filter":""),style:{imageRendering:"auto",transform:"translateZ(0)"}}):null;return(0,r.jsxs)(I,{ref:E,center:[40,-95],zoom:5,style:{height:"100%",width:"100%",borderRadius:12,overflow:"hidden",zIndex:0},children:[(0,r.jsx)(B,{attribution:"\xa9 OpenStreetMap contributors",url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),N,(0,r.jsx)(h,{bbox:p||t,cells:j,selectedCell:v,onSelectCell:k,visible:!!(L&&(p||t))}),u&&u.length>0&&(0,r.jsx)(i.m,{positions:u,pathOptions:{color:"#16a34a",weight:2}}),(y||[]).map((e,t)=>(0,r.jsx)(s.J,{position:e.position,children:(0,r.jsx)(c.G,{children:e.label})},t))]})}delete d().Icon.Default.prototype._getIconUrl,d().Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png"})}}]);